import{h as c,c as G,K as H,L as J,t as p,o as W,a as Y,C as u,R as f,J as l,F as a,E as o,P as _,aY as X,Q as h,$ as Z,S as L,T as A,U as ee,D as O,V as te,I as m,at as V,O as ae,M as se,W as le}from"./index.763dfb58.js";import{e as oe,a as g,b as I,Q as T}from"./QSelect.ec76e317.js";import{Q as ne}from"./QBtnGroup.65ac437f.js";import{Q as P}from"./QList.46a313f0.js";import{Q as ie}from"./QTooltip.75b1fa3d.js";import{Q as re}from"./QBadge.4ee823eb.js";import{u as ce}from"./format.d713a360.js";import{api_web as Q}from"./axios.bf65fac6.js";import{_ as de}from"./customerView.fc27f4bd.js";import"./use-dialog-plugin-component.e21c35d4.js";const ue=[c("circle",{cx:"15",cy:"15",r:"15"},[c("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),c("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"})]),c("circle",{cx:"60",cy:"15",r:"9","fill-opacity":".3"},[c("animate",{attributeName:"r",from:"9",to:"9",begin:"0s",dur:"0.8s",values:"9;15;9",calcMode:"linear",repeatCount:"indefinite"}),c("animate",{attributeName:"fill-opacity",from:".5",to:".5",begin:"0s",dur:"0.8s",values:".5;1;.5",calcMode:"linear",repeatCount:"indefinite"})]),c("circle",{cx:"105",cy:"15",r:"15"},[c("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),c("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"})])];var me=G({name:"QSpinnerDots",props:H,setup(k){const{cSize:d,classes:y}=J(k);return()=>c("svg",{class:y.value,fill:"currentColor",width:d.value,height:d.value,viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg"},ue)}});const ve={class:"q-pa-md"},pe=l("div",{class:"row q-pb-md"},[l("div",{class:"col"},[l("span",{class:"text-h4"},"POS")]),l("div",{class:"col text-right"})],-1),_e={class:"row bg-grey q-pa-md full-width",style:{height:"86vh"}},fe={class:"col-4 q-pa-xs"},he={class:"row bg-white"},ge={class:"col",style:{height:"50vh",overflow:"auto","font-size":"10px"}},ye={class:"row q-pt-xs",style:{height:"30vh"}},Ce={class:"col bg-white vertical-middle"},Me={class:"row"},Se={class:"col q-pa-sm",style:{height:"20vh"}},we={class:"text-h6 text-bold"},Ie={class:"row",style:{height:"10vh"}},be={class:"col-sm-6 col-12 q-pa-sm"},Te={class:"col-sm-6 col-12 q-pa-sm"},Qe={class:"col q-pa-xs q-gutter-sm"},ke={class:"row bg-white"},xe={class:"col"},Ne={class:"row bg-white"},qe={class:"col"},Le={class:"col"},Ae={class:"row q-col-gutter-sm"},Oe={class:"text-center"},Ve={class:"row items-center"},Pe={class:"col text-bold ellipsis"},Ue={key:0,class:"row justify-center q-my-md"},Re={key:1,class:"row justify-center q-my-md"},Je={__name:"posSalesIndex",setup(k){const d=ce(),y=p(""),M=p([]),x=p([]),n=p([]),r=p(!1),C=p(0),N=p(""),b=p(0);W(()=>{S(""),w("")});const U=Y(()=>n.value.length>0?n.value.reduce((s,t)=>s+parseFloat(t.LATEST_PRC)*parseInt(t.sellQty),0):0),S=async s=>{r.value=!0,M.value.length>0&&(C.value=C.value+1),await Q.post("item/searchAPIStockAndPriceOnly",{searchValue:s,page:s?C.value:1}).then(t=>{r.value=!1,t.data.data.data.map(e=>{n.value.findIndex(v=>v.MITM_ITMNM===e.MITM_ITMNM)===-1&&M.value.push(e)})}).catch(()=>{r.value=!1})},w=async(s,t="MCUS_CUSNM")=>{r.value=!0,await Q.post("customer/searchAPI",{searchValue:s,searchCol:t}).then(e=>{r.value=!1,x.value=e.data.data}).catch(()=>{r.value=!1})},R=(s,t)=>{d.dialog({dark:!0,title:"Prompt",message:"How many qty?",prompt:{model:0,type:"number",isValid:e=>e>0&&e<=M.value[t].STOCK},cancel:!0,persistent:!0}).onOk(e=>{b.value=b.value+1;const i=n.value.findIndex(v=>v.MITM_ITMNM===s.MITM_ITMNM);i!==-1?n.value[i].sellQty=e:n.value.push({...s,sellQty:e})}).onCancel(()=>{}).onDismiss(()=>{})},D=()=>{d.dialog({component:de}).onOk(async s=>{await w(""),y.value=s.MCUS_CUSCD})},$=async(s,t)=>{await S(""),t()},E=s=>{C.value=0,S(s)},B=(s,t,e,i)=>{t(async()=>{i==="cust"&&(internalSrv.value==1?await w("connect_jos","MCUS_CGCON"):await w(s)),i==="item"&&await S(s)})},F=s=>{d.dialog({dark:!0,title:"Prompt",message:"How many qty?",prompt:{model:n.value[s].sellQty,type:"number",isValid:t=>t>0&&t<=n.value[s].STOCK},cancel:!0,persistent:!0}).onOk(t=>{n.value[s].sellQty=t})},K=s=>{d.dialog({title:"Confirmation",message:"Are you sure want to delete this line ??",cancel:!0,persistent:!0}).onOk(async()=>{n.value.splice(s,1)})},q=s=>{let t=n.value.findIndex(e=>e.MITM_ITMNM===s);return t!==-1&&n.value[t].sellQty?n.value[t].sellQty:0},z=()=>{d.dialog({title:"Confirmation",message:"Are you sure want to cancel sales ??",cancel:!0,persistent:!0}).onOk(async()=>{n.value=[]})},j=()=>{d.dialog({title:"Confirmation",message:"Are you sure want to process this sales ??",cancel:!0,persistent:!0}).onOk(async()=>{await Q.post("pos",{searchValue:val,page:C.value}).then(s=>{r.value=!1,n.value=[]}).catch(()=>{r.value=!1})})};return(s,t)=>(u(),f("div",ve,[pe,l("div",_e,[l("div",fe,[l("div",he,[l("div",ge,[a(P,{bordered:"",loading:r.value},{default:o(()=>[n.value.length>0?(u(!0),f(L,{key:0},A(n.value,(e,i)=>ee((u(),O(T,{key:e.id,class:"q-my-sm"},{default:o(()=>[a(g,{avatar:""},{default:o(()=>[a(te,{color:"primary","text-color":"white",icon:"category"})]),_:1}),a(g,null,{default:o(()=>[a(I,null,{default:o(()=>[m(_(e.MITM_ITMNMREAL),1)]),_:2},1024),a(I,{lines:"1"},{default:o(()=>[m(" Rp "+_(e.LATEST_PRC.toLocaleString())+" x "+_(e.sellQty.toLocaleString())+" = ",1),l("b",null,_((e.LATEST_PRC*e.sellQty).toLocaleString()),1)]),_:2},1024)]),_:2},1024),a(g,{side:""},{default:o(()=>[a(ne,{flat:""},{default:o(()=>[a(h,{icon:"edit",color:"orange",onClick:v=>F(i),dense:""},null,8,["onClick"]),a(h,{icon:"delete",color:"red",onClick:v=>K(i),dense:""},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)),[[le]])),128)):(u(),O(T,{key:1},{default:o(()=>[a(g,null,{default:o(()=>[m(" No item selected!! ")]),_:1})]),_:1}))]),_:1},8,["loading"])])]),l("div",ye,[l("div",Ce,[l("div",Me,[l("div",Se,[l("div",we," Total : Rp. "+_(U.value.toLocaleString()),1)])]),a(X),l("div",Ie,[l("div",be,[a(h,{color:"primary",class:"full-width",onClick:t[0]||(t[0]=e=>j())},{default:o(()=>[m(" Submit ")]),_:1})]),l("div",Te,[a(h,{color:"red",class:"full-width",onClick:t[1]||(t[1]=e=>z())},{default:o(()=>[m(" Cancel ")]),_:1})])])])])]),l("div",Qe,[l("div",ke,[l("div",xe,[a(Z,{filled:"",modelValue:N.value,"onUpdate:modelValue":[t[2]||(t[2]=e=>N.value=e),t[3]||(t[3]=e=>E(e))],label:"Search Item",dense:"",debounce:1e3},null,8,["modelValue"])])]),l("div",Ne,[l("div",qe,[a(oe,{dense:"",filled:"",label:"Customer Choose",modelValue:y.value,"onUpdate:modelValue":t[5]||(t[5]=e=>y.value=e),"use-input":"","input-debounce":"500",options:x.value,onFilter:t[6]||(t[6]=(e,i,v)=>B(e,i,v,"cust")),behavior:"dialog","option-label":"MCUS_CUSNM","option-value":"MCUS_CUSCD","emit-value":"","map-options":"",loading:r.value},{after:o(()=>[a(h,{round:"",dense:"",flat:"",icon:"person_add",onClick:t[4]||(t[4]=e=>D()),color:"cyan"},{default:o(()=>[a(ie,null,{default:o(()=>[m("Add new customer")]),_:1})]),_:1})]),_:1},8,["modelValue","options","loading"])])]),(u(),f("div",{class:"row bg-white",style:{height:"66vh",overflow:"auto"},key:b.value},[l("div",Le,[l("div",Ae,[(u(!0),f(L,null,A(M.value,(e,i)=>(u(),f("div",{class:"col-6 q-pa-sm",key:`sm-${i}`},[a(se,{flat:"",bordered:""},{default:o(()=>[a(re,{color:"orange",floating:""},{default:o(()=>[m(_((parseInt(e.STOCK)-q(e.MITM_ITMNM)).toLocaleString()),1)]),_:2},1024),l("div",Oe,[a(V,{name:"category",size:"8em"})]),a(ae,null,{default:o(()=>[l("div",Ve,[l("div",Pe,_(e.MITM_ITMNMREAL),1)])]),_:2},1024),a(P,null,{default:o(()=>[a(T,{clickable:"",onClick:v=>R(e,i),disable:e.STOCK-q(e.MITM_ITMNM)===0},{default:o(()=>[a(g,{avatar:""},{default:o(()=>[a(V,{color:"primary",name:"add"})]),_:1}),a(g,null,{default:o(()=>[a(I,null,{default:o(()=>[m("Add Item")]),_:1}),a(I,{caption:"",lines:"2"},{default:o(()=>[m(" Rp. "+_(parseInt(e.LATEST_PRC).toLocaleString()),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick","disable"])]),_:2},1024)]),_:2},1024)]))),128))]),r.value?(u(),f("div",Ue,[a(me,{color:"primary",size:"40px"})])):(u(),f("div",Re,[a(h,{color:"primary",label:"Load more",onClick:$})]))])]))])])]))}};export{Je as default};
