import{Q as k}from"./QTooltip.087d5555.js";import{t as p,o as K,C,D as y,E as t,F as a,M as re,O as H,J as d,$ as h,an as z,U as q,Q as f,R as g,S as Q,T as N,V as ce,I as T,P as A,W as me,X as pe,Y as $,Z as Ce,aY as ve}from"./index.50e2c7ab.js";import{a as G,u as _e,l as O,Q as Ve,b as x,c as S,d as M,k as De,m as B}from"./QTable.f8551172.js";import{Q as Y,a as j}from"./QTd.5bd41ca8.js";import{api_web as R}from"./axios.58a00810.js";import{Q as Te,a as fe}from"./QInnerLoading.3dd4ad23.js";import{Q as ge,a as Re,C as be}from"./ClosePopup.322a3c22.js";import{Q as Se}from"./QBtnToggle.92b5f0af.js";import"./use-render-cache.3aae9b27.js";import"./date.bfb0da31.js";import"./QBtnGroup.275eec21.js";const he=d("div",{class:"text-h6"},"Create Incoming",-1),Oe={style:{border:"1px black solid","border-radius":"10px"}},Ue=d("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[d("b",null,"Header")],-1),Pe={class:"row q-col-gutter-md"},ye={class:"col-12 col-sm-6"},we={class:"col-12 col-sm-6"},Ie={class:"row items-center justify-end"},ke={class:"row q-col-gutter-md q-pt-md"},Me={key:0,class:"col-12 col-sm-6"},Qe={key:1,class:"col-12 col-sm-6"},Ne={key:2,class:"col-12 col-sm-6"},Ae={key:3,class:"col-12 col-sm-6"},Le={class:"row q-col-gutter-md q-pt-md"},Ee={class:"col"},Fe={class:"row q-py-md"},He={class:"col"},qe={style:{border:"1px black solid","border-radius":"10px",height:"35vh",overflow:"auto"}},$e=d("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[d("b",null,"List Of Items")],-1),xe={class:"row q-pb-sm"},Be={class:"col text-right"},J={__name:"incomingCreate",props:{dataHeader:Array},setup(L){const b=G(),v=L,n=p({TRCV_RCVCD:"",TRCV_SUPCD:"",TRCV_ISSUDT:"",TRCV_REFFNO:"",TRCV_DOCNO:""}),_=p(1),c=p([]),o=p(!1),w=p([]),U=p([]),P=p([]),I=p([]),u=p([]);K(async()=>{await D(""),await E(""),await F(""),v.dataHeader&&Object.values(v.dataHeader).length>0&&(n.value={TRCV_RCVCD:v.dataHeader.TRCV_RCVCD,TRCV_SUPCD:v.dataHeader.MSUP_SUPCD,TRCV_ISSUDT:v.dataHeader.TRCV_ISSUDT,TRCV_REFFNO:v.dataHeader.TRCV_REFFNO,TRCV_DOCNO:v.dataHeader.TRCV_DOCNO},_.value=v.dataHeader.RCV_STATE,v.dataHeader.det.map(s=>{c.value.push({item_code:s.item_code,quantity:s.quantity,unit_price:s.unit_price})}))});const V=()=>{n.value={TRCV_RCVCD:"",TRCV_SUPCD:"",TRCV_ISSUDT:"",TRCV_REFFNO:"",TRCV_DOCNO:""},c.value=[]},i=(s,l,e,r)=>{l(async()=>{r==="supp"&&await E(s),r==="cust"&&await F(s),r==="item"&&await D(s),r==="po"&&await W(s),r==="inv"&&await ee(s)})},D=async s=>{o.value=!0,await R.post("item/searchAPI",{searchValue:s,isITMCD:1}).then(l=>{o.value=!1,I.value=l.data.data}).catch(()=>{o.value=!1})},E=async(s,l="MSUP_SUPNM")=>{o.value=!0,await R.post("supplier/searchAPI",{searchValue:s,searchCol:l}).then(e=>{o.value=!1,w.value=e.data.data}).catch(()=>{o.value=!1})},F=async(s,l="MCUS_CUSNM")=>{o.value=!0,await R.post("customer/searchAPI",{searchValue:s,searchCol:l}).then(e=>{o.value=!1,U.value=e.data.data}).catch(()=>{o.value=!1})},W=async(s,l="TPCHORD_PCHCD")=>{o.value=!0,await R.post("purchase-order/searchApprovedPO",{searchValue:s,searchCol:l}).then(e=>{o.value=!1,P.value=e.data.data}).catch(()=>{o.value=!1})},X=s=>{b.dialog({title:"Confirmation",message:`Do you want to delete this lines no ${s+1} ?`,cancel:!0,persistent:!0}).onOk(async()=>{c.value.splice(s,1)})},Z=()=>{c.value.push({item_code:"",quantity:"",unit_price:""})},ee=async(s,l="TDLVORD_DLVCD")=>{o.value=!0,await R.post("invoices/search",{searchBy:l,searchValue:s}).then(e=>{o.value=!1,u.value=e.data.data}).catch(e=>{o.value=!1})},le=s=>{let l=P.value.filter(e=>e.TPCHORD_PCHCD==s);c.value=[],l.length>0&&(n.value.TRCV_SUPCD=l[0].TPCHORD_SUPCD,l[0].det.map(e=>{c.value.push({item_code:e.TPCHORDDETA_ITMCD,quantity:e.TPCHORDDETA_ITMQT,unit_price:e.TPCHORDDETA_ITMPRC_PER})}))},ae=s=>{let l=u.value.filter(e=>e.TDLVORD_DLVCD==s);c.value=[],l.length>0&&(n.value.TRCV_SUPCD=l[0].TDLVORD_CUSCD,l[0].dlvacc.map(e=>{c.value.push({item_code:e.TDLVACCESSORY_ITMCD,quantity:e.TDLVACCESSORY_ITMQT,unit_price:0})}),l[0].dlvdet.map(e=>{c.value.push({item_code:e.TDLVORDDETA_ITMCD,quantity:e.TDLVORDDETA_ITMQT,unit_price:e.TDLVORDDETA_PRC})}))},te=()=>{b.dialog({title:"Confirmation",message:"Are you sure want to save this Incoming ?",cancel:!0,persistent:!0}).onOk(async()=>{o.value=!0,await R.post("receive/saveAPI",{...n.value,det:c.value}).then(s=>{o.value=!1,b.notify({color:"green",message:`${s.data.msg}`}),ne()}).catch(()=>{o.value=!1})})},{dialogRef:oe,onDialogHide:se,onDialogOK:ne,onDialogCancel:ie}=_e();return(s,l)=>(C(),y(Ce,{ref_key:"dialogRef",ref:oe,onHide:$(se),"transition-show":"slide-up","transition-hide":"slide-down","full-width":"",persistent:""},{default:t(()=>[a(re,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:t(()=>[a(H,null,{default:t(()=>[he]),_:1}),a(H,{class:"q-pa-sm"},{default:t(()=>[d("fieldset",Oe,[Ue,a(Te,{showing:o.value,dark:""},{default:t(()=>[a(fe,{size:"50px",color:"primary"})]),_:1},8,["showing"]),d("div",Pe,[d("div",ye,[a(h,{label:"Code",readonly:"",dense:"",filled:"",modelValue:n.value.TRCV_RCVCD,"onUpdate:modelValue":l[0]||(l[0]=e=>n.value.TRCV_RCVCD=e)},null,8,["modelValue"])]),d("div",we,[a(h,{filled:"",modelValue:n.value.TRCV_ISSUDT,"onUpdate:modelValue":l[2]||(l[2]=e=>n.value.TRCV_ISSUDT=e),dense:"",label:"Receive Date"},{append:t(()=>[a(z,{name:"event",class:"cursor-pointer"},{default:t(()=>[a(ge,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[a(Re,{modelValue:n.value.TRCV_ISSUDT,"onUpdate:modelValue":l[1]||(l[1]=e=>n.value.TRCV_ISSUDT=e),mask:"YYYY-MM-DD"},{default:t(()=>[d("div",Ie,[q(a(f,{label:"Close",color:"primary",flat:""},null,512),[[be]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),d("div",ke,[_.value==1?(C(),g("div",Me,[a(O,{dense:"",filled:"",label:"Supplier Name",modelValue:n.value.TRCV_SUPCD,"onUpdate:modelValue":l[3]||(l[3]=e=>n.value.TRCV_SUPCD=e),"use-input":"","input-debounce":"500",options:w.value,onFilter:l[4]||(l[4]=(e,r,m)=>i(e,r,m,"supp")),behavior:"dialog","option-label":"MSUP_SUPNM","option-value":"MSUP_SUPCD","emit-value":"","map-options":"",loading:o.value,disable:n.value.TRCV_RCVCD!==""||_.value==1},null,8,["modelValue","options","loading","disable"])])):(C(),g("div",Qe,[a(O,{dense:"",filled:"",label:"Customer Name",modelValue:n.value.TRCV_SUPCD,"onUpdate:modelValue":l[5]||(l[5]=e=>n.value.TRCV_SUPCD=e),"use-input":"","input-debounce":"500",options:U.value,onFilter:l[6]||(l[6]=(e,r,m)=>i(e,r,m,"cust")),behavior:"dialog","option-label":"MCUS_CUSNM","option-value":"MCUS_CUSCD","emit-value":"","map-options":"",loading:o.value,disable:n.value.TRCV_RCVCD!==""||_.value==1},null,8,["modelValue","options","loading","disable"])])),_.value==1?(C(),g("div",Ne,[a(O,{dense:"",filled:"",label:"PO Number",modelValue:n.value.TRCV_REFFNO,"onUpdate:modelValue":[l[7]||(l[7]=e=>n.value.TRCV_REFFNO=e),l[9]||(l[9]=e=>le(e))],"use-input":"","input-debounce":"500",options:P.value,onFilter:l[8]||(l[8]=(e,r,m)=>i(e,r,m,"po")),behavior:"dialog","option-label":"PO_CUSTDESC","option-value":"TPCHORD_PCHCD","emit-value":"","map-options":"",loading:o.value,disable:n.value.TRCV_RCVCD!==""},null,8,["modelValue","options","loading","disable"])])):(C(),g("div",Ae,[a(O,{dense:"",filled:"",label:"JAT Invoice No",modelValue:n.value.TRCV_REFFNO,"onUpdate:modelValue":[l[10]||(l[10]=e=>n.value.TRCV_REFFNO=e),l[12]||(l[12]=e=>ae(e))],"use-input":"","input-debounce":"500",options:u.value,onFilter:l[11]||(l[11]=(e,r,m)=>i(e,r,m,"inv")),behavior:"dialog","option-label":"LABEL","option-value":"TDLVORD_DLVCD","emit-value":"","map-options":"",loading:o.value,disable:n.value.TRCV_RCVCD!==""},null,8,["modelValue","options","loading","disable"])]))]),d("div",Le,[d("div",Ee,[a(h,{label:"Doc Supplier No",dense:"",filled:"",modelValue:n.value.TRCV_DOCNO,"onUpdate:modelValue":l[13]||(l[13]=e=>n.value.TRCV_DOCNO=e)},null,8,["modelValue"])])])]),d("div",Fe,[d("div",He,[a(Se,{modelValue:_.value,"onUpdate:modelValue":[l[14]||(l[14]=e=>_.value=e),l[15]||(l[15]=e=>V())],spread:"","no-caps":"","toggle-color":"purple",color:"white","text-color":"black",options:[{label:"From PO",value:1},{label:"Return",value:2}],disable:n.value.TRCV_RCVCD!==""},null,8,["modelValue","disable"])])]),d("fieldset",qe,[$e,d("div",xe,[d("div",Be,[a(f,{flat:"",icon:"add",color:"blue",label:"Add Lines",onClick:Z,loading:o.value},null,8,["loading"])])]),a(Ve,{bordered:"",dense:""},{default:t(()=>[c.value.length>0?(C(!0),g(Q,{key:0},N(c.value,(e,r)=>(C(),y(x,{key:r,class:"q-my-sm",dense:"",loading:o.value},{default:t(()=>[a(S,{avatar:""},{default:t(()=>[a(ce,{"text-color":"blue"},{default:t(()=>[T(A(r+1),1)]),_:2},1024)]),_:2},1024),a(S,null,{default:t(()=>[a(M,null,{default:t(()=>[a(O,{dense:"",filled:"",label:"Item Code",modelValue:e.item_code,"onUpdate:modelValue":m=>e.item_code=m,"use-input":"","input-debounce":"500",options:I.value,onFilter:l[16]||(l[16]=(m,de,ue)=>i(m,de,ue,"item")),behavior:"dialog","option-label":"MITM_ITMNMREAL","option-value":"MITM_ITMNM","emit-value":"","map-options":"",loading:o.value,disable:n.value.TRCV_RCVCD!==""},null,8,["modelValue","onUpdate:modelValue","options","loading","disable"])]),_:2},1024)]),_:2},1024),a(S,null,{default:t(()=>[a(M,null,{default:t(()=>[a(h,{dense:"",label:"Qty",filled:"",modelValue:e.quantity,"onUpdate:modelValue":m=>e.quantity=m},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),a(S,null,{default:t(()=>[a(M,null,{default:t(()=>[a(h,{dense:"",label:"Price",filled:"",modelValue:e.unit_price,"onUpdate:modelValue":m=>e.unit_price=m},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),a(S,{side:""},{default:t(()=>[a(f,{icon:"delete",color:"red",flat:"",onClick:m=>X(r)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["loading"]))),128)):q((C(),y(x,{key:1,class:"q-my-sm",clickable:""},{default:t(()=>[a(S,null,{default:t(()=>[a(M,null,{default:t(()=>[T(" Choose sales order first to access item list ")]),_:1})]),_:1})]),_:1})),[[me]])]),_:1})])]),_:1}),a(pe,{align:"right"},{default:t(()=>[a(f,{label:"OK",color:"primary",onClick:l[17]||(l[17]=e=>te()),disable:s.stateSubmit,loading:o.value},null,8,["disable","loading"]),a(f,{flat:"",label:"Cancel",color:"red",onClick:$(ie)},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}},Ye={class:"q-pa-md"},je={class:"row q-pb-md"},Je=d("div",{class:"col"},[d("span",{class:"text-h4"},"Incoming")],-1),Ke={class:"col text-right"},ze={class:"row q-pt-md"},Ge={class:"col"},dl={__name:"incomingIndex",setup(L){const b=G(),v=p([]),n=p([{name:"TRCV_RCVCD",label:"Receive ID",field:"TRCV_RCVCD",sortable:!0,align:"left"},{name:"MSUP_SUPNM",label:"Supplier Name",field:"MSUP_SUPNM",sortable:!0,align:"left"},{name:"TOT_RCV",label:"Total Qty",field:"TOT_RCV",sortable:!0,align:"left",format:u=>`${u.toLocaleString()}`},{name:"MSUP_CURCD",label:"Currency",field:"MSUP_CURCD",sortable:!0,align:"left"},{name:"TOT_AMT",label:"Total Amount",field:"TOT_AMT",sortable:!0,align:"left",format:u=>`${u.toLocaleString()}`}]),_=p(!1),c=p(""),o=p("");K(()=>{w()});const w=async()=>{_.value=!0,await R.post("receive/searchAPI",{searchBy:c.value,searchValue:o.value}).then(u=>{_.value=!1,v.value=u.data.data}).catch(u=>{_.value=!1})},U=(u=[])=>{b.dialog({component:J,componentProps:{dataHeader:u}}).onOk(async V=>{getOutgoingData()})},P=()=>{b.dialog({component:J,componentProps:{dataHeader:data}}).onOk(async u=>{getOutgoingData()})},I=u=>{};return(u,V)=>(C(),g("div",Ye,[d("div",je,[Je,d("div",Ke,[a(f,{icon:"add",color:"blue",onClick:V[0]||(V[0]=i=>U())},{default:t(()=>[a(k,null,{default:t(()=>[T("Create New Delivery")]),_:1})]),_:1})])]),a(ve),d("div",ze,[d("div",Ge,[a(De,{title:"Outgoing List",rows:v.value,columns:n.value,"row-key":"TDLVORD_DLVCD",loading:_.value,dense:"",pagination:{rowsPerPage:20},class:"my-sticky-header-column-table"},{"top-right":t(()=>[a(O,{outlined:"",modelValue:c.value,"onUpdate:modelValue":V[1]||(V[1]=i=>c.value=i),options:u.columns,label:"Search Columns","option-value":"name","option-label":"label","emit-value":"",dense:"","map-options":""},null,8,["modelValue","options"]),a(h,{borderless:"",dense:"",modelValue:o.value,"onUpdate:modelValue":[V[2]||(V[2]=i=>o.value=i),V[3]||(V[3]=i=>u.getOutgoingData())],placeholder:"Search",outlined:"",debounce:"1000"},{append:t(()=>[a(z,{name:"search"})]),_:1},8,["modelValue"])]),header:t(i=>[a(Y,{props:i},{default:t(()=>[a(B,{"auto-width":""},{default:t(()=>[T("Action")]),_:1}),(C(!0),g(Q,null,N(i.cols,D=>(C(),y(B,{key:D.name,props:i},{default:t(()=>[T(A(D.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:t(i=>[a(Y,{props:i},{default:t(()=>[a(j,{"auto-width":""},{default:t(()=>[a(f,{flat:"",color:"orange",icon:"edit",onClick:D=>U(i.row),dense:"",disable:i.row.TRCV_SUBMITTED_AT},{default:t(()=>[a(k,null,{default:t(()=>[T("Edit Data")]),_:1})]),_:2},1032,["onClick","disable"]),a(f,{flat:"",color:"red",icon:"delete",onClick:D=>I(i.row.id),dense:"",disable:i.row.TRCV_SUBMITTED_AT},{default:t(()=>[a(k,null,{default:t(()=>[T("Delete Data")]),_:1})]),_:2},1032,["onClick","disable"]),a(f,{flat:"",color:"indigo",icon:"check",onClick:D=>P(i.row),dense:""},{default:t(()=>[a(k,null,{default:t(()=>[T("Confirm Data")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),(C(!0),g(Q,null,N(i.cols,D=>(C(),y(j,{key:D.name,props:i},{default:t(()=>[T(A(D.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])])])]))}};export{dl as default};
