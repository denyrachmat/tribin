import{Q as h}from"./QTooltip.2e534a66.js";import{t as T,o as J,C as f,D as P,E as l,F as e,M as ue,O as F,J as o,$ as v,an as Q,U as I,Q as c,P as g,R as k,S as N,T as Y,V as re,I as _,W as _e,X as Te,Y as x,Z as me,aY as ce}from"./index.b02f3437.js";import{a as W,u as De,l as M,Q as Se,b as B,c as p,d as m,k as Oe,m as H}from"./QTable.8639a515.js";import{Q as G,a as j}from"./QTd.3ceef052.js";import{api_web as L,api as ve}from"./axios.869e4563.js";import{Q as R,a as w,C as y}from"./ClosePopup.06a8dfd9.js";import{Q as pe}from"./QBtnToggle.a551a537.js";import{d as K}from"./date.9ddadd76.js";import"./use-render-cache.3aae9b27.js";import"./QBtnGroup.5d70ede9.js";const fe=o("div",{class:"text-h6"},"RO Maintenance",-1),Ce={style:{border:"1px black solid","border-radius":"10px"}},Le=o("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[o("b",null,"Header")],-1),ge={class:"row"},Ue={class:"col"},Ve={class:"col q-pl-md"},Ee={class:"row items-center justify-end"},Ae={class:"col q-pl-md"},be={class:"row items-center justify-end"},Ie={class:"row"},Qe={class:"col"},Pe={class:"col q-pl-md"},he={class:"col q-pl-md"},Re={class:"row"},we={class:"col"},ye={style:{border:"1px black solid","border-radius":"10px",height:"35vh",overflow:"auto"},class:"q-pa-md"},ke=o("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[o("b",null,"Detail Items")],-1),Me={class:"row q-pb-md"},Ne={class:"col"},Ye={class:"text-h6"},$e={class:"col text-right"},qe={class:"row"},Fe={class:"col"},xe={class:"row items-center justify-end"},Be={class:"row items-center justify-end"},He={__name:"salesOrderCreate",props:{sloHeader:String},setup($){const U=W(),V=$,d=T({TSLO_SLOCD:"",TSLO_ISSUDT:K.formatDate(Date.now(),"YYYY-MM-DD"),TSLO_PLAN_DLVDT:"",TSLO_QUOCD:"",TSLO_POCD:"",TSLO_CUSCD:"",TSLO_ATTN:"",TSLO_TYPE:1,TSLO_ADDRESS_NAME:"",TSLO_ADDRESS_DESCRIPTION:"",TSLO_SERVTRANS_COST:0});T(""),T("");const E=T([]),A=T([]),C=T([]),s=T(!1),b=T(1),r=T([]);J(()=>{V.sloHeader&&Z(),q()});const S=(n,a,t,D)=>{a(async()=>{D==="quotation"&&await u(n),D==="item"&&await O(n),D==="cust"&&await q(n)})},u=async(n="")=>{s.value=!0,await L.post("quotation/search",{searchBy:"MCUS_CUSNM",searchValue:n}).then(a=>{s.value=!1,E.value=a.data.data}).catch(a=>{s.value=!1})},O=async n=>{s.value=!0,await L.post("item/searchAPI",{searchValue:n}).then(a=>{s.value=!1,A.value=a.data.data}).catch(()=>{s.value=!1})},X=()=>b.value===1?"Rental":b.value===2?"Sales":"Service",q=async n=>{s.value=!0,await L.post("customer/searchAPI",{searchValue:n}).then(a=>{s.value=!1,C.value=a.data.data}).catch(()=>{s.value=!1})},Z=async n=>{s.value=!0,await L.get(`receive-order/getData/${btoa(n)}`).then(a=>{s.value=!1,d.value={TSLO_SLOCD:a.data.data,TSLO_ISSUDT:K.formatDate(Date.now(),"YYYY-MM-DD"),TSLO_PLAN_DLVDT:"",TSLO_QUOCD:"",TSLO_POCD:"",TSLO_CUSCD:"",TSLO_ATTN:"",TSLO_TYPE:1,TSLO_ADDRESS_NAME:"",TSLO_ADDRESS_DESCRIPTION:"",TSLO_SERVTRANS_COST:0}}).catch(()=>{s.value=!1})},z=async n=>{console.log(n),s.value=!0,await ve.get(`transaction/quotation/view/${btoa(n)}`).then(a=>{s.value=!1,d.value.TSLO_CUSCD=a.data.data.TQUO_CUSCD,d.value.TSLO_ADDRESS_NAME=a.data.data.cust.MCUS_CUSNM,d.value.TSLO_ADDRESS_DESCRIPTION=a.data.data.cust.MCUS_ADDR1,d.value.TSLO_ATTN=a.data.data.TQUO_ATTN,a.data.data.det.map(t=>{r.value.push({TSLODETA_ITMCD:t.TQUODETA_ITMCD,TSLODETA_ITMQT:t.TQUODETA_ITMQT,TSLODETA_USAGE_DESCRIPTION:t.TQUODETA_USAGE,TSLODETA_PRC:t.TQUODETA_PRC,TSLODETA_PERIOD_FR:t.TQUODETA_PERIOD_FR,TSLODETA_PERIOD_TO:t.TQUODETA_PERIOD_TO})})}).catch(a=>{s.value=!1})},ee=()=>{r.value.push({TSLODETA_ITMCD:"",TSLODETA_ITMQT:"",TSLODETA_USAGE_DESCRIPTION:"",TSLODETA_PRC:0,TSLODETA_PERIOD_FR:"",TSLODETA_PERIOD_TO:""})},le=n=>{U.dialog({title:"Confirmation",message:`Do you want to delete this lines no ${n+1} ?`,cancel:!0,persistent:!0}).onOk(async()=>{r.value.splice(n,1)})},ae=()=>{U.dialog({title:"Confirmation",message:"Are you sure want to save this RO ?",cancel:!0,persistent:!0}).onOk(async()=>{s.value=!0,await L.post("receive-order/saveAPI",{...d.value,det:r.value}).then(n=>{s.value=!1,U.notify({color:"green",message:`${n.data.msg}`}),se()}).catch(()=>{s.value=!1})})},{dialogRef:te,onDialogHide:oe,onDialogOK:se,onDialogCancel:ne}=De();return(n,a)=>(f(),P(me,{ref_key:"dialogRef",ref:te,onHide:x(oe),"transition-show":"slide-up","transition-hide":"slide-down","full-width":""},{default:l(()=>[e(ue,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:l(()=>[e(F,null,{default:l(()=>[fe]),_:1}),e(F,{class:"q-pa-sm"},{default:l(()=>[o("fieldset",Ce,[Le,o("div",ge,[o("div",Ue,[e(v,{label:"RO Code",dense:"",filled:"",modelValue:d.value.TSLO_SLOCD,"onUpdate:modelValue":a[0]||(a[0]=t=>d.value.TSLO_SLOCD=t),disable:"",loading:s.value},null,8,["modelValue","loading"])]),o("div",Ve,[e(v,{filled:"",modelValue:d.value.TSLO_ISSUDT,"onUpdate:modelValue":a[2]||(a[2]=t=>d.value.TSLO_ISSUDT=t),dense:"",label:"Issue Date",loading:s.value,onClick:a[3]||(a[3]=t=>n.quotationIssueDate.qDateProxy.show()),mask:"####-##-##","fill-mask":"",hint:"Mask: YYYY-MM-DD"},{append:l(()=>[e(Q,{name:"event",class:"cursor-pointer"},{default:l(()=>[e(R,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(w,{modelValue:d.value.TSLO_ISSUDT,"onUpdate:modelValue":a[1]||(a[1]=t=>d.value.TSLO_ISSUDT=t),mask:"YYYY-MM-DD"},{default:l(()=>[o("div",Ee,[I(e(c,{label:"Close",color:"primary",flat:""},null,512),[[y]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","loading"])]),o("div",Ae,[e(v,{filled:"",modelValue:d.value.TSLO_PLAN_DLVDT,"onUpdate:modelValue":a[5]||(a[5]=t=>d.value.TSLO_PLAN_DLVDT=t),dense:"",label:"Delivery Date",loading:s.value,onClick:a[6]||(a[6]=t=>n.quotationIssueDate.qDateProxy.show()),mask:"####-##-##","fill-mask":"",hint:"Mask: YYYY-MM-DD"},{append:l(()=>[e(Q,{name:"event",class:"cursor-pointer"},{default:l(()=>[e(R,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(w,{modelValue:d.value.TSLO_PLAN_DLVDT,"onUpdate:modelValue":a[4]||(a[4]=t=>d.value.TSLO_PLAN_DLVDT=t),mask:"YYYY-MM-DD"},{default:l(()=>[o("div",be,[I(e(c,{label:"Close",color:"primary",flat:""},null,512),[[y]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","loading"])])]),o("div",Ie,[o("div",Qe,[e(M,{dense:"",filled:"",label:"Sales Quotation Code",modelValue:d.value.TSLO_QUOCD,"onUpdate:modelValue":[a[7]||(a[7]=t=>d.value.TSLO_QUOCD=t),z],"use-input":"","input-debounce":"500",options:E.value,onFilter:a[8]||(a[8]=(t,D,i)=>S(t,D,i,"quotation")),behavior:"dialog","option-label":"DESCSEL","option-value":"TQUO_QUOCD","emit-value":"","map-options":"",loading:s.value},null,8,["modelValue","options","loading"])]),o("div",Pe,[e(v,{label:"PO Number",dense:"",filled:"",modelValue:d.value.TSLO_POCD,"onUpdate:modelValue":a[9]||(a[9]=t=>d.value.TSLO_POCD=t),loading:s.value},null,8,["modelValue","loading"])]),o("div",he,[e(M,{dense:"",filled:"",label:"Customer Name",modelValue:d.value.TSLO_CUSCD,"onUpdate:modelValue":a[10]||(a[10]=t=>d.value.TSLO_CUSCD=t),"use-input":"","input-debounce":"500",options:C.value,onFilter:a[11]||(a[11]=(t,D,i)=>S(t,D,i,"cust")),behavior:"dialog","option-label":"MCUS_CUSNM","option-value":"MCUS_CUSCD","emit-value":"","map-options":"",loading:s.value,readonly:b.value===3},null,8,["modelValue","options","loading","readonly"])])])]),o("div",Re,[o("div",we,[e(pe,{modelValue:n.model,"onUpdate:modelValue":a[12]||(a[12]=t=>n.model=t),spread:"","no-caps":"","toggle-color":"purple",color:"white","text-color":"black",options:[{label:"Rental",value:1},{label:"Sales",value:2},{label:"Service",value:3}]},null,8,["modelValue"])])]),o("fieldset",ye,[ke,o("div",Me,[o("div",Ne,[o("span",Ye,g(X()),1)]),o("div",$e,[e(c,{flat:"",icon:"add",color:"blue",label:"Add Lines",onClick:ee,loading:s.value},null,8,["loading"])])]),o("div",qe,[o("div",Fe,[e(Se,{bordered:"",dense:""},{default:l(()=>[r.value.length>0?(f(!0),k(N,{key:0},Y(r.value,(t,D)=>(f(),P(B,{key:D,class:"q-my-sm",dense:""},{default:l(()=>[e(p,{avatar:""},{default:l(()=>[e(re,{"text-color":"blue"},{default:l(()=>[_(g(D+1),1)]),_:2},1024)]),_:2},1024),e(p,null,{default:l(()=>[e(m,{class:"text-center"},{default:l(()=>[e(M,{dense:"",filled:"",label:"Item Name",modelValue:t.TSLODETA_ITMCD,"onUpdate:modelValue":i=>t.TSLODETA_ITMCD=i,"use-input":"","input-debounce":"500",options:A.value,onFilter:a[13]||(a[13]=(i,de,ie)=>S(i,de,ie,"item")),behavior:"dialog","option-label":"MITM_ITMNM","option-value":"MITM_ITMNM","emit-value":"","map-options":"",loading:s.value},null,8,["modelValue","onUpdate:modelValue","options","loading"])]),_:2},1024),e(m,{caption:""},{default:l(()=>[_(" Item Name ")]),_:1})]),_:2},1024),e(p,null,{default:l(()=>[e(m,null,{default:l(()=>[e(v,{modelValue:t.TSLODETA_ITMQT,"onUpdate:modelValue":i=>t.TSLODETA_ITMQT=i,dense:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(m,{caption:""},{default:l(()=>[_(" Qty ")]),_:1})]),_:2},1024),e(p,null,{default:l(()=>[e(m,null,{default:l(()=>[e(v,{modelValue:t.TSLODETA_USAGE_DESCRIPTION,"onUpdate:modelValue":i=>t.TSLODETA_USAGE_DESCRIPTION=i,dense:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(m,{caption:""},{default:l(()=>[_(" Usage ")]),_:1})]),_:2},1024),e(p,null,{default:l(()=>[e(m,null,{default:l(()=>[e(v,{modelValue:t.TSLODETA_PRC,"onUpdate:modelValue":i=>t.TSLODETA_PRC=i,dense:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(m,{caption:""},{default:l(()=>[_(" Price ")]),_:1})]),_:2},1024),e(p,null,{default:l(()=>[e(m,null,{default:l(()=>[e(v,{filled:"",modelValue:t.TSLODETA_PERIOD_FROM,"onUpdate:modelValue":i=>t.TSLODETA_PERIOD_FROM=i,dense:"",loading:s.value,onClick:a[14]||(a[14]=i=>n.quotationIssueDate.qDateProxy.show()),mask:"####-##-##","fill-mask":""},{append:l(()=>[e(Q,{name:"event",class:"cursor-pointer"},{default:l(()=>[e(R,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(w,{modelValue:t.TSLODETA_PERIOD_FROM,"onUpdate:modelValue":i=>t.TSLODETA_PERIOD_FROM=i,mask:"YYYY-MM-DD"},{default:l(()=>[o("div",xe,[I(e(c,{label:"Close",color:"primary",flat:""},null,512),[[y]])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","loading"])]),_:2},1024),e(m,{caption:""},{default:l(()=>[_(" Period From ")]),_:1})]),_:2},1024),e(p,null,{default:l(()=>[e(m,null,{default:l(()=>[e(v,{filled:"",modelValue:t.TSLODETA_PERIOD_TO,"onUpdate:modelValue":i=>t.TSLODETA_PERIOD_TO=i,dense:"",loading:s.value,onClick:a[15]||(a[15]=i=>n.quotationIssueDate.qDateProxy.show()),mask:"####-##-##","fill-mask":""},{append:l(()=>[e(Q,{name:"event",class:"cursor-pointer"},{default:l(()=>[e(R,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(w,{modelValue:t.TSLODETA_PERIOD_TO,"onUpdate:modelValue":i=>t.TSLODETA_PERIOD_TO=i,mask:"YYYY-MM-DD"},{default:l(()=>[o("div",Be,[I(e(c,{label:"Close",color:"primary",flat:""},null,512),[[y]])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","loading"])]),_:2},1024),e(m,{caption:""},{default:l(()=>[_(" Period To ")]),_:1})]),_:2},1024),e(p,{side:""},{default:l(()=>[e(c,{icon:"delete",color:"red",flat:"",onClick:i=>le(D)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)):I((f(),P(B,{key:1,class:"q-my-sm",clickable:""},{default:l(()=>[e(p,null,{default:l(()=>[e(m,null,{default:l(()=>[_(" No Items Added ")]),_:1})]),_:1})]),_:1})),[[_e]])]),_:1})])])])]),_:1}),e(Te,{align:"right"},{default:l(()=>[e(c,{label:"OK",color:"primary",onClick:a[16]||(a[16]=t=>ae()),disable:n.stateSubmit,loading:s.value},null,8,["disable","loading"]),e(c,{flat:"",label:"Cancel",color:"red",onClick:x(ne)},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}};const Ge={class:"q-pa-md"},je={class:"row q-pb-md"},Ke=o("div",{class:"col"},[o("span",{class:"text-h4"},"Sales Order / Receive Order")],-1),Je={class:"col text-right"},We={class:"row q-pt-md"},Xe={class:"col"},il={__name:"salesOrderView",setup($){const U=W(),V=T("TSLO_SLOCD"),d=T(""),E=T([]),A=T([{name:"TSLO_SLOCD",label:"RO. Code",field:"TSLO_SLOCD",sortable:!0,align:"left"},{name:"MCUS_CUSNM",label:"Customer Name",field:"MCUS_CUSNM",sortable:!0,align:"left"},{name:"TSLO_ADDRESS_NAME",label:"Customer Addr.",field:"TSLO_ADDRESS_NAME",sortable:!0,align:"left"},{name:"TSLO_CUSCD",label:"Customer Code",field:"TSLO_CUSCD",sortable:!0,align:"left"},{name:"TSLO_ISSUDT",label:"Issue Date",field:"TSLO_ISSUDT",sortable:!0,align:"left"},{name:"TSLO_QUOCD",label:"Quot. Code",field:"TSLO_QUOCD",sortable:!0,align:"left"}]),C=T(!1);J(()=>{s()});const s=async()=>{C.value=!0,await L.post("receive-order/searchAPI",{searchBy:V.value,searchValue:d.value}).then(r=>{C.value=!1,E.value=r.data.data}).catch(r=>{C.value=!1})},b=()=>{U.dialog({component:He}).onOk(async r=>{s()})};return(r,S)=>(f(),k("div",Ge,[o("div",je,[Ke,o("div",Je,[e(c,{icon:"add",color:"blue",onClick:b},{default:l(()=>[e(h,null,{default:l(()=>[_("Create New RO")]),_:1})]),_:1})])]),e(ce),o("div",We,[o("div",Xe,[e(Oe,{title:"Created RO",rows:E.value,columns:A.value,"row-key":"name",loading:C.value,dense:"",pagination:{rowsPerPage:20},class:"my-sticky-header-column-table"},{"top-right":l(()=>[e(M,{outlined:"",modelValue:V.value,"onUpdate:modelValue":S[0]||(S[0]=u=>V.value=u),options:A.value,label:"Search Columns","option-value":"name","option-label":"label","emit-value":"",dense:"","map-options":""},null,8,["modelValue","options"]),e(v,{borderless:"",dense:"",modelValue:d.value,"onUpdate:modelValue":[S[1]||(S[1]=u=>d.value=u),S[2]||(S[2]=u=>r.dataQuo())],placeholder:"Search",outlined:"",debounce:"1000"},{append:l(()=>[e(Q,{name:"search"})]),_:1},8,["modelValue"])]),header:l(u=>[e(G,{props:u},{default:l(()=>[e(H,{"auto-width":""},{default:l(()=>[_("Action")]),_:1}),(f(!0),k(N,null,Y(u.cols,O=>(f(),P(H,{key:O.name,props:u},{default:l(()=>[_(g(O.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:l(u=>[e(G,{props:u},{default:l(()=>[e(j,{"auto-width":""},{default:l(()=>[e(c,{flat:"",color:u.row.TQUO_APPRVDT!==null?"grey":"orange",icon:"edit",onClick:O=>r.onClickEdit(u.row.TQUO_QUOCD),dense:""},{default:l(()=>[e(h,null,{default:l(()=>[_(g(u.row.TQUO_APPRVDT?"Quotation already approved, cannot edit !":"Edit this quotation"),1)]),_:2},1024)]),_:2},1032,["color","onClick"]),e(c,{flat:"",color:u.row.TQUO_APPRVDT!==null?"grey":"red",icon:"delete",onClick:O=>r.onClickDelete(u.row.TQUO_QUOCD),dense:"",disable:u.row.TQUO_APPRVDT!==null},{default:l(()=>[e(h,null,{default:l(()=>[_(g(u.row.TQUO_APPRVDT?"Quotation already approved, cannot delete !":"Delete this quotation"),1)]),_:2},1024)]),_:2},1032,["color","onClick","disable"]),e(c,{flat:"",color:"indigo",icon:"print",onClick:O=>r.onClickPrint(u.row.TQUO_QUOCD),dense:""},{default:l(()=>[e(h,null,{default:l(()=>[_("Print this quotation")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),(f(!0),k(N,null,Y(u.cols,O=>(f(),P(j,{key:O.name,props:u},{default:l(()=>[_(g(O.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])])])]))}};export{il as default};
