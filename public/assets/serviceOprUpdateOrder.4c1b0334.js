import{o as H,s as V,B as o,C as f,D as e,E as a,L as K,M as A,I as R,P as h,Q as S,a$ as T,T as N,H as n,V as P,R as B,S as Y,U as z,O as k,Z as q,W as E,X as v,Y as G,bc as ee,bd as ae}from"./index.1a4eedb7.js";import{u as j,a as W,Q as X,b as Q,c as u,d as _,l as te}from"./QTable.5f44d6ad.js";import{Q as le,a as oe}from"./QPopupEdit.61c61623.js";import{Q as b}from"./QTooltip.78c92850.js";import{Q as ne}from"./QBadge.deece6a0.js";import{api_web as w}from"./axios.7fbcee53.js";import{d as ie}from"./date.836b75e7.js";const de={class:"row"},se=R("div",{class:"col"},[R("div",{class:"text-h6"},"Update Used Item")],-1),re={key:0,class:"col text-right"},ue={key:0},ce={key:0},_e={key:0},fe={class:"text-h5 text-bold"},me={__name:"serviceOprItemAdd",props:{mode:String,dataItem:Array},setup(D){const{dialogRef:L,onDialogHide:O,onDialogOK:y,onDialogCancel:I}=j(),c=W(),i=D;H(async()=>{i.dataItem.listFixDet&&(s.value=i.dataItem.listFixDet,await F())});const C=V([]),s=V([]),d=V(!1),M=()=>{s.value.push({TSRVD_ID:i.dataItem.id,TSRVF_ITMCD:"",TSRVF_PRC:0,TSRVF_QTY:1})},$=(r,t,l,m)=>{t(async()=>{m==="item"&&await F(r)})},F=async r=>{d.value=!0,await w.post("item/searchAPITBL",{searchValue:r}).then(t=>{d.value=!1,C.value=t.data.data}).catch(()=>{d.value=!1})},U=()=>{i.mode==="view"?I():c.dialog({title:"Confirmation",message:"Are you sure want to save this items ?",cancel:!0,persistent:!0}).onOk(async()=>{y(s.value)})},x=r=>{c.dialog({title:"Confirmation",message:`Do you want to delete this lines no ${r+1} ?`,cancel:!0,persistent:!0}).onOk(async()=>{s.value.splice(r,1)})},p=r=>{let t=0;return r.map(l=>{t+=parseInt(l.TSRVF_PRC)*parseInt(l.TSRVF_QTY)}),t.toLocaleString()};return(r,t)=>(o(),f(G,{ref_key:"dialogRef",ref:L,onHide:v(O),"transition-show":"slide-up","transition-hide":"slide-down","full-width":""},{default:e(()=>[a(K,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:e(()=>[a(A,null,{default:e(()=>[R("div",de,[se,i.mode!=="view"?(o(),h("div",re,[a(S,{icon:"add",outline:"",color:"blue",onClick:M})])):T("",!0)])]),_:1}),a(A,{class:"q-pa-sm",style:{"max-height":"50vh"}},{default:e(()=>[a(X,{bordered:""},{default:e(()=>[s.value.length===0?N((o(),f(Q,{key:0,class:"q-my-sm",clickable:""},{default:e(()=>[a(u,null,{default:e(()=>[n(" No items added ")]),_:1})]),_:1})),[[P]]):T("",!0),(o(!0),h(B,null,Y(s.value,(l,m)=>N((o(),f(Q,{key:m,class:"q-my-sm",clickable:""},{default:e(()=>[a(u,{avatar:""},{default:e(()=>[a(z,{color:"primary","text-color":"white"},{default:e(()=>[n(k(m+1),1)]),_:2},1024)]),_:2},1024),a(u,null,{default:e(()=>[a(_,null,{default:e(()=>[i.mode==="view"?(o(),h("div",ue,[a(_,null,{default:e(()=>[n(k(l.MITM_ITMNM?l.MITM_ITMNM:C.value.filter(g=>g.MITM_ITMCD==l.TSRVF_ITMCD)[0].MITM_ITMNM),1)]),_:2},1024),a(_,{caption:""},{default:e(()=>[n(" Item ")]),_:1})])):(o(),f(te,{key:1,dense:"",filled:"",label:"Item Name",modelValue:l.TSRVF_ITMCD,"onUpdate:modelValue":g=>l.TSRVF_ITMCD=g,"use-input":"","input-debounce":"500",options:C.value,onFilter:t[0]||(t[0]=(g,Z,J)=>$(g,Z,J,"item")),behavior:"dialog","option-label":"MITM_ITMNM","option-value":"MITM_ITMCD","emit-value":"","map-options":"",loading:d.value,readonly:i.mode==="view"},null,8,["modelValue","onUpdate:modelValue","options","loading","readonly"]))]),_:2},1024)]),_:2},1024),a(u,null,{default:e(()=>[i.mode==="view"?(o(),h("div",ce,[a(_,null,{default:e(()=>[n(k(l.TSRVF_PRC.toLocaleString()),1)]),_:2},1024),a(_,{caption:""},{default:e(()=>[n(" Price ")]),_:1})])):(o(),f(q,{key:1,label:"Price",modelValue:l.TSRVF_PRC,"onUpdate:modelValue":g=>l.TSRVF_PRC=g,filled:"",dense:"",readonly:i.mode==="view"},null,8,["modelValue","onUpdate:modelValue","readonly"]))]),_:2},1024),a(u,null,{default:e(()=>[i.mode==="view"?(o(),h("div",_e,[a(_,null,{default:e(()=>[n(k(l.TSRVF_QTY.toLocaleString()),1)]),_:2},1024),a(_,{caption:""},{default:e(()=>[n(" Qty ")]),_:1})])):(o(),f(q,{key:1,label:"Qty",modelValue:l.TSRVF_QTY,"onUpdate:modelValue":g=>l.TSRVF_QTY=g,filled:"",dense:"",readonly:i.mode==="view"},null,8,["modelValue","onUpdate:modelValue","readonly"]))]),_:2},1024),i.mode==="view"?(o(),f(u,{key:0},{default:e(()=>[a(_,null,{default:e(()=>[n(" Rp "+k((parseInt(l.TSRVF_PRC)*parseInt(l.TSRVF_QTY)).toLocaleString()),1)]),_:2},1024),a(_,{caption:""},{default:e(()=>[n(" Total Price ")]),_:1})]),_:2},1024)):T("",!0),D.mode!=="view"?(o(),f(u,{key:1,side:""},{default:e(()=>[a(S,{icon:"delete",flat:"",color:"red",onClick:g=>x(m)},null,8,["onClick"])]),_:2},1024)):T("",!0)]),_:2},1024)),[[P]])),128)),D.mode==="view"?N((o(),f(Q,{key:1,class:"q-my-sm",clickable:""},{default:e(()=>[a(u),a(u),a(u),a(u,null,{default:e(()=>[a(_,null,{default:e(()=>[R("span",fe," Rp "+k(p(s.value)),1)]),_:1}),a(_,{caption:""},{default:e(()=>[n(" Total Price ")]),_:1})]),_:1})]),_:1})),[[P]]):T("",!0)]),_:1})]),_:1}),a(E,{align:"right"},{default:e(()=>[a(S,{label:"OK",color:"primary",onClick:t[1]||(t[1]=l=>U()),disable:d.value,loading:d.value},null,8,["disable","loading"]),a(S,{flat:"",label:"Cancel",color:"red",onClick:v(I),loading:d.value},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}},pe={class:"text-h6"},ve={class:"cursor-pointer"},ge={key:0},Se={key:1},Te=["innerHTML"],be={__name:"serviceOprUpdateOrder",props:{header:Array,detail:Array,mode:String},setup(D){const{dialogRef:L,onDialogHide:O,onDialogOK:y,onDialogCancel:I}=j(),c=W(),i=D,C=V({SRVH_DOCNO:"",SRVH_ISSDT:ie.formatDate(Date.now(),"YYYY-MM-DD"),SRVH_CUSCD:""}),s=V([]),d=V(!1);H(async()=>{i.header&&(C.value=i.header,s.value=i.detail)});const M=(p,r="add")=>{c.dialog({component:me,componentProps:{mode:r,dataItem:s.value[p]}}).onOk(async t=>{s.value[p].TSRVD_FLGSTS=5,s.value[p].listFixDet=t})},$=()=>{i.mode!=="edit"?y():c.dialog({title:"Confirmation",message:"Do you want to submit this data ?",cancel:!0,persistent:!0}).onOk(async()=>{d.value=!0,await w.post("servicesOPR",{data:s.value}).then(p=>{d.value=!1,y()})})},F=p=>{console.log(s.value[p]),c.dialog({title:"Confirmation",message:"Do you want to approve this price ?",cancel:!0,persistent:!0}).onOk(async()=>{d.value=!0,await w.put(`servicesAdmin/updateByDet/${btoa(s.value[p].id)}`,{TSRVD_FLGSTS:2}).then(r=>{d.value=!1,y()}).catch(r=>{d.value=!1})})},U=p=>{c.dialog({title:"Confirmation",message:"Do you want to reject this price ?",cancel:!0,persistent:!0}).onOk(async()=>{d.value=!0,await w.put(`servicesAdmin/updateByDet/${btoa(s.value[p].id)}`,{TSRVD_FLGSTS:0}).then(r=>{d.value=!1,y()}).catch(r=>{d.value=!1})})},x=p=>{c.dialog({title:"Confirmation",message:"Do you want to mark this problem as done ?",cancel:!0,persistent:!0}).onOk(async()=>{d.value=!0,await w.put(`servicesAdmin/updateByDet/${btoa(s.value[p].id)}`,{TSRVD_FLGSTS:3}).then(r=>{d.value=!1,y()}).catch(r=>{d.value=!1})})};return(p,r)=>(o(),f(G,{ref_key:"dialogRef",ref:L,onHide:v(O),"transition-show":"slide-up","transition-hide":"slide-down","full-width":""},{default:e(()=>[a(K,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:e(()=>[a(A,null,{default:e(()=>[R("div",pe,"Update Order "+k(C.value.SRVH_DOCNO),1)]),_:1}),a(A,{class:"q-pa-sm"},{default:e(()=>[a(X,{bordered:""},{default:e(()=>[(o(!0),h(B,null,Y(s.value,(t,l)=>(o(),f(Q,{key:l,class:ee("q-my-sm")},{default:e(()=>[a(u,{avatar:""},{default:e(()=>[a(z,{color:t.TSRVD_FLGSTS===0?"red":"primary","text-color":"white"},{default:e(()=>[n(k(t.TSRVD_LINE),1)]),_:2},1032,["color"])]),_:2},1024),a(u,null,{default:e(()=>[a(_,null,{default:e(()=>[n(k(t.TSRVD_ITMCD),1)]),_:2},1024),a(_,{caption:"",lines:"1"},{default:e(()=>[n("Item")]),_:1})]),_:2},1024),a(u,null,{default:e(()=>[a(_,null,{default:e(()=>[n(k(t.TSRVD_CUSTRMK),1)]),_:2},1024),a(_,{caption:"",lines:"1"},{default:e(()=>[n("Customer Remarks")]),_:1})]),_:2},1024),a(u,null,{default:e(()=>[a(_,null,{default:e(()=>[R("div",ve,[t.TSRVD_REMARK?(o(),h("span",Se,[R("div",{innerHTML:t.TSRVD_REMARK},null,8,Te)])):(o(),h("span",ge," No comment yet !, Click here to add comment. ")),i.mode!=="view"?(o(),f(le,{key:2,modelValue:t.TSRVD_REMARK,"onUpdate:modelValue":m=>t.TSRVD_REMARK=m,"auto-save":""},{default:e(m=>[a(oe,{onKeyup:ae(m.set,["enter"]),modelValue:m.value,"onUpdate:modelValue":g=>m.value=g,dense:v(c).screen.lt.md,toolbar:[[{label:v(c).lang.editor.align,icon:v(c).iconSet.editor.align,fixedLabel:!0,options:["left","center","right","justify"]}],["bold","italic","strike","underline","subscript","superscript"],["token","hr","link","custom_btn"],["print","fullscreen"],[{label:v(c).lang.editor.formatting,icon:v(c).iconSet.editor.formatting,list:"no-icons",options:["p","h1","h2","h3","h4","h5","h6","code"]},{label:v(c).lang.editor.fontSize,icon:v(c).iconSet.editor.fontSize,fixedLabel:!0,fixedIcon:!0,list:"no-icons",options:["size-1","size-2","size-3","size-4","size-5","size-6","size-7"]},{label:v(c).lang.editor.defaultFont,icon:v(c).iconSet.editor.font,fixedIcon:!0,list:"no-icons",options:["default_font","arial","arial_black","comic_sans","courier_new","impact","lucida_grande","times_new_roman","verdana"]},"removeFormat"],["quote","unordered","ordered","outdent","indent"],["undo","redo"],["viewsource"]],fonts:{arial:"Arial",arial_black:"Arial Black",comic_sans:"Comic Sans MS",courier_new:"Courier New",impact:"Impact",lucida_grande:"Lucida Grande",times_new_roman:"Times New Roman",verdana:"Verdana"}},null,8,["onKeyup","modelValue","onUpdate:modelValue","dense","toolbar"])]),_:2},1032,["modelValue","onUpdate:modelValue"])):T("",!0)])]),_:2},1024),a(_,{caption:"",lines:"1"},{default:e(()=>[n("Operator Remarks")]),_:1})]),_:2},1024),i.mode==="edit"&&t.TSRVD_FLGSTS<2?(o(),f(u,{key:0,side:""},{default:e(()=>[a(S,{icon:"construction",color:"green",flat:"",onClick:m=>M(l,"add")},{default:e(()=>[a(b,null,{default:e(()=>[n("Update Fix Data")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):T("",!0),a(u,{side:""},{default:e(()=>[a(S,{icon:"visibility",color:"cyan",flat:"",onClick:m=>M(l,"view"),disable:!t.listFixDet},{default:e(()=>[a(b,null,{default:e(()=>[n("View Added Item")]),_:1}),t.listFixDet.length>0?(o(),f(ne,{key:0,color:"red",floating:""},{default:e(()=>[n(k(t.listFixDet.length),1)]),_:2},1024)):T("",!0)]),_:2},1032,["onClick","disable"])]),_:2},1024),i.mode==="approvecust"?(o(),f(u,{key:1,side:""},{default:e(()=>[a(S,{icon:"how_to_reg",color:"green",outline:"",onClick:m=>F(l)},{default:e(()=>[a(b,null,{default:e(()=>[n("Approve this as customer")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):T("",!0),i.mode==="approvecust"?(o(),f(u,{key:2,side:""},{default:e(()=>[a(S,{icon:"cancel",color:"red",outline:"",onClick:m=>U(l)},{default:e(()=>[a(b,null,{default:e(()=>[n("Reject this as customer")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):T("",!0),i.mode==="edit"&&t.TSRVD_FLGSTS===2?(o(),f(u,{key:3,side:""},{default:e(()=>[a(S,{icon:"task",color:"indigo",outline:"",onClick:m=>x(l)},{default:e(()=>[a(b,null,{default:e(()=>[n("Mark this problem as done")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):T("",!0)]),_:2},1024))),128))]),_:1})]),_:1}),a(E,{align:"right"},{default:e(()=>[a(S,{label:"OK",color:"primary",onClick:r[0]||(r[0]=t=>$()),disable:d.value||s.value.filter(t=>t.listFixDet).length===0||s.value.filter(t=>t.TSRVD_REMARK).length===0,loading:d.value},null,8,["disable","loading"]),a(S,{flat:"",label:"Cancel",color:"red",onClick:v(I),loading:d.value},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}};export{be as _};
