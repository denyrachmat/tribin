import{t as v,o as Q,C as p,D as A,E as o,F as e,M as J,O as k,J as a,$ as S,at as $,U as K,Q as T,R as g,S as G,T as V,a_ as X,P as y,X as Z,Y as w,Z as z,aM as W,I as b}from"./index.0adca304.js";import{e as R}from"./QSelect.819c6d65.js";import{u as ee,a as le,b as M}from"./QTable.0dbaf8d5.js";import{Q as F,a as U}from"./QTd.c05a4dcb.js";import{Q as P}from"./QTooltip.bb46925f.js";import{u as Y}from"./format.dd594675.js";import{api_web as L}from"./axios.21efb282.js";import{Q as ae,a as oe,C as te}from"./ClosePopup.5e33245c.js";import{Q as se}from"./QBtnToggle.2d7b2828.js";import"./use-render-cache.3aae9b27.js";import"./date.79d1dc85.js";import"./QBtnGroup.65722e90.js";const ne=a("div",{class:"text-h6"},"Closing Period",-1),de={style:{border:"1px black solid","border-radius":"10px"}},ie=a("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[a("b",null,"Header")],-1),ue={class:"row q-col-gutter-sm q-pt-sm"},re={class:"col-12 col-sm-6"},ce={class:"col-12 col-sm-6"},_e={class:"row items-center justify-end"},me={style:{border:"1px black solid","border-radius":"10px"}},pe=a("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[a("b",null,"Detail")],-1),Ce={class:"row q-col-gutter-sm q-pt-sm"},ve={class:"col-12 col-sm-12 text-right"},Te={class:"col-12 col-sm-3"},fe={class:"col-12 col-sm-2"},ge={class:"col-12 col-sm-2"},Ie={class:"col-12 col-sm-2"},he={class:"col-12 col-sm-2"},Se={key:0,class:"col-12 col-sm-1"},De={key:1,class:"row q-col-gutter-sm q-pt-sm"},be={class:"col-12 text-center"},He={__name:"journalInputCreate",props:{header:String},setup(E){const I=Y(),t=v({GLHIST_DOC:"",GLHIST_EFFDT:"",MCOA_TYPE:"INC"}),u=v([]),m=v(!1),h=v([]),r=E;Q(async()=>{r.header&&r.header!==""&&(await s(""),t.value.GLHIST_DOC=r.header.GLHIST_DOC,t.value.GLHIST_EFFDT=r.header.GLHIST_EFFDT,t.value.MCOA_TYPE=r.header.MCOA_TYPE,u.value=r.header.det)});const{dialogRef:D,onDialogHide:O,onDialogOK:H,onDialogCancel:c}=ee(),d=(_,n,l,f)=>{n(async()=>{f==="coa"&&await s(_)})},s=async(_,n="MCOA_COACD")=>{m.value=!0,await L.post("coa/searchAPI",{searchValue:_,searchCol:n}).then(l=>{m.value=!1,h.value=l.data.data}).catch(()=>{m.value=!1})},C=()=>{u.value.push({GLHIST_ACC:"",GLHIST_DOC:t.value.GLHIST_DOC,GLHIST_AMT:0,GLHIST_DESC:"",GLHIST_EFFDT:t.value.GLHIST_EFFDT,MCOA_TYPE:"OUT"}),u.value.push({GLHIST_ACC:"",GLHIST_DOC:t.value.GLHIST_DOC,GLHIST_AMT:0,GLHIST_DESC:"",GLHIST_EFFDT:t.value.GLHIST_EFFDT,MCOA_TYPE:"INC"})},q=_=>{I.dialog({title:"Confirmation",message:`Do you want to delete this lines no ${_+1} ?`,cancel:!0,persistent:!0}).onOk(async()=>{u.value.splice(_,1)})},x=(_,n)=>{let l=h.value.filter(f=>f.MCOA_COACD===_);l.length>0&&(u.value[n].GLHIST_CURR=l[0].MCOA_CURR,u.value[n].MCOA_TYPE=l[0].MCOA_TYPE&&l[0].MCOA_TYPE!==""?l[0].MCOA_TYPE:"INC")},N=()=>{I.dialog({title:"Confirmation",message:"Are you sure want to save this journal ?",cancel:!0,persistent:!0}).onOk(async()=>{m.value=!0,await L.post(`${t.value.GLHIST_DOC?`acc/journal/${btoa(t.value.GLHIST_DOC)}`:"acc/journal"}`,{...t.value,det:u.value}).then(_=>{m.value=!1,I.notify({color:"green",message:`${_.data.msg}`}),H()}).catch(_=>{m.value=!1})})};return(_,n)=>(p(),A(z,{ref_key:"dialogRef",ref:D,onHide:w(O),"transition-show":"slide-up","transition-hide":"slide-down","full-width":""},{default:o(()=>[e(J,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:o(()=>[e(k,null,{default:o(()=>[ne]),_:1}),e(k,{class:"q-pa-sm"},{default:o(()=>[a("fieldset",de,[ie,a("div",ue,[a("div",re,[e(S,{filled:"",label:"Doc Reference",modelValue:t.value.GLHIST_DOC,"onUpdate:modelValue":n[0]||(n[0]=l=>t.value.GLHIST_DOC=l),readonly:"",dense:""},null,8,["modelValue"])]),a("div",ce,[e(S,{filled:"",modelValue:t.value.GLHIST_EFFDT,"onUpdate:modelValue":n[2]||(n[2]=l=>t.value.GLHIST_EFFDT=l),label:"Eff Date",dense:""},{prepend:o(()=>[e($,{name:"event",class:"cursor-pointer"},{default:o(()=>[e(ae,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:o(()=>[e(oe,{modelValue:t.value.GLHIST_EFFDT,"onUpdate:modelValue":n[1]||(n[1]=l=>t.value.GLHIST_EFFDT=l),mask:"YYYY-MM-DD"},{default:o(()=>[a("div",_e,[K(e(T,{label:"Close",color:"primary",flat:""},null,512),[[te]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])])]),a("fieldset",me,[pe,a("div",Ce,[a("div",ve,[e(T,{flat:"",color:"primary",icon:"add",onClick:C})])]),u.value.length>0?(p(!0),g(G,{key:0},V(u.value,(l,f)=>(p(),g("div",{class:"row q-col-gutter-sm q-pt-sm",key:f},[a("div",Te,[e(se,{modelValue:l.MCOA_TYPE,"onUpdate:modelValue":i=>l.MCOA_TYPE=i,spread:"",class:"my-custom-toggle","no-caps":"",rounded:"",unelevated:"","toggle-color":"primary",color:"white","text-color":"primary",options:[{label:"Income",value:"INC"},{label:"Expense",value:"OUT"}],disable:t.value.GLHIST_DOC!==""},null,8,["modelValue","onUpdate:modelValue","disable"])]),a("div",fe,[e(R,{filled:"",label:"Account Code",modelValue:l.GLHIST_ACC,"onUpdate:modelValue":[i=>l.GLHIST_ACC=i,i=>x(i,f)],"use-input":"","input-debounce":"500",options:h.value,onFilter:n[3]||(n[3]=(i,j,B)=>d(i,j,B,"coa")),behavior:"dialog","option-label":"MCOA_COANM","option-value":"MCOA_COACD","emit-value":"","map-options":"",loading:m.value,dense:""},null,8,["modelValue","onUpdate:modelValue","options","loading"])]),a("div",ge,[e(S,{filled:"",label:"Valuta",modelValue:l.GLHIST_CURR,"onUpdate:modelValue":i=>l.GLHIST_CURR=i,dense:""},null,8,["modelValue","onUpdate:modelValue"])]),a("div",Ie,[e(S,{filled:"",label:"Description",modelValue:l.GLHIST_DESC,"onUpdate:modelValue":i=>l.GLHIST_DESC=i,dense:""},null,8,["modelValue","onUpdate:modelValue"])]),a("div",he,[e(S,{filled:"",label:"Amount",modelValue:l.GLHIST_AMT,"onUpdate:modelValue":i=>l.GLHIST_AMT=i,dense:""},null,8,["modelValue","onUpdate:modelValue"])]),l.MCOA_TYPE==="OUT"?(p(),g("div",Se,[e(T,{icon:"delete",onClick:i=>q(f),flat:"",color:"red"},null,8,["onClick"])])):X("",!0)]))),128)):(p(),g("div",De,[a("div",be," Click + button to add "+y(t.value.MCOA_TYPE==="INC"?"Income":"Expense"),1)]))])]),_:1}),e(Z,{align:"right"},{default:o(()=>[e(T,{label:"OK",color:"primary",onClick:n[4]||(n[4]=l=>N()),disable:_.stateSubmit,loading:m.value},null,8,["disable","loading"]),e(T,{flat:"",label:"Cancel",color:"red",onClick:w(c)},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}},Le={class:"q-pa-md"},Oe={class:"row q-pb-md"},Ae=a("div",{class:"col"},[a("span",{class:"text-h4"},"Journal Input")],-1),Ge={class:"col text-right"},Ve={class:"row q-pt-md"},ye={class:"col"},xe={__name:"journalInputIndex",setup(E){const I=Y(),t=v("GLHIST_DOC"),u=v(""),m=v([]),h=v([{name:"GLHIST_DOC",label:"Journal Doc",field:"GLHIST_DOC",sortable:!0,align:"left"},{name:"GLHIST_CURR",label:"Valuta",field:"GLHIST_CURR",sortable:!0,align:"left"},{name:"GLHIST_AMT_DB",label:"Debit",field:"GLHIST_AMT_DB",sortable:!0,format:c=>c.toLocaleString(),align:"left"},{name:"GLHIST_AMT_CR",label:"Credit",field:"GLHIST_AMT_CR",sortable:!0,format:c=>c.toLocaleString(),align:"left"}]),r=v(!1);Q(()=>{D()});const D=async()=>{r.value=!0,await L.post("acc/journal/searchAPI",{searchBy:t.value,searchValue:u.value}).then(c=>{r.value=!1,m.value=c.data.data}).catch(c=>{r.value=!1})},O=c=>{I.dialog({title:"Confirmation",message:"Are you sure want to delete this journal doc ?",cancel:!0,persistent:!0}).onOk(async()=>{L.delete(`acc/journal/${btoa(c)}`).then(d=>{r.value=!1,m.value=d.data.data}).catch(d=>{r.value=!1})})},H=(c=null)=>{I.dialog({component:He,componentProps:{header:c}}).onOk(async d=>{D()})};return(c,d)=>(p(),g("div",Le,[a("div",Oe,[Ae,a("div",Ge,[e(T,{icon:"add",color:"primary",onClick:d[0]||(d[0]=s=>H())})])]),e(W),a("div",Ve,[a("div",ye,[e(le,{title:"Journal History",rows:m.value,columns:h.value,"row-key":"name",loading:r.value,dense:"",pagination:{rowsPerPage:20},class:"my-sticky-header-column-table"},{"top-right":o(()=>[e(R,{outlined:"",modelValue:t.value,"onUpdate:modelValue":d[1]||(d[1]=s=>t.value=s),options:h.value,label:"Search Columns","option-value":"name","option-label":"label","emit-value":"",dense:"","map-options":""},null,8,["modelValue","options"]),e(S,{borderless:"",dense:"",modelValue:u.value,"onUpdate:modelValue":[d[2]||(d[2]=s=>u.value=s),d[3]||(d[3]=s=>D())],placeholder:"Search",outlined:"",debounce:"1000"},{append:o(()=>[e($,{name:"search"})]),_:1},8,["modelValue"])]),header:o(s=>[e(F,{props:s},{default:o(()=>[e(M,{"auto-width":""},{default:o(()=>[b("Action")]),_:1}),(p(!0),g(G,null,V(s.cols,C=>(p(),A(M,{key:C.name,props:s},{default:o(()=>[b(y(C.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:o(s=>[e(F,{props:s},{default:o(()=>[e(U,{"auto-width":""},{default:o(()=>[e(T,{flat:"",color:"orange",icon:"edit",onClick:C=>H(s.row),dense:""},{default:o(()=>[e(P,null,{default:o(()=>[b("Journal Edit")]),_:1})]),_:2},1032,["onClick"]),e(T,{flat:"",color:"red",icon:"delete",onClick:C=>O(s.row.GLHIST_DOC),dense:""},{default:o(()=>[e(P,null,{default:o(()=>[b("Journal Delete")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),(p(!0),g(G,null,V(s.cols,C=>(p(),A(U,{key:C.name,props:s},{default:o(()=>[b(y(C.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])])])]))}};export{xe as default};
