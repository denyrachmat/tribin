import{Q as Y}from"./QTooltip.6c137418.js";import{t as r,o as W,C as f,D as y,E as l,F as e,M as re,O as F,J as n,$ as O,an as w,U as h,Q as v,R,a_ as _e,a0 as ce,P as E,S as $,T as x,V as me,I as _,W as Te,X as ve,Y as H,Z as Se,aY as Oe}from"./index.b7551821.js";import{a as X,u as De,l as M,Q as pe,b as B,c as L,d as c,k as fe,m as G}from"./QTable.17081737.js";import{Q as j,a as K}from"./QTd.dff28dfe.js";import{api_web as b,api as Ce}from"./axios.0334a194.js";import{Q as P,a as Q,C as k}from"./ClosePopup.135560a9.js";import{Q as Le}from"./QBtnToggle.5d7a0302.js";import{d as ge}from"./date.f7375919.js";import"./use-render-cache.3aae9b27.js";import"./QBtnGroup.2874b638.js";const Ve=n("div",{class:"text-h6"},"RO Maintenance",-1),be={style:{border:"1px black solid","border-radius":"10px"}},Ee=n("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[n("b",null,"Header")],-1),Ue={class:"row"},Ae={class:"col"},Ie={class:"col q-pl-md"},he={class:"row items-center justify-end"},we={class:"col q-pl-md"},ye={class:"row items-center justify-end"},Re={class:"row"},Pe={class:"col"},Qe={class:"col q-pl-md"},ke={class:"col q-pl-md"},Me={class:"row q-py-md"},Ne={class:"col"},Ye={key:0,class:"row"},$e={class:"col"},xe={class:"row"},qe={class:"col"},Fe={style:{border:"1px black solid","border-radius":"10px",height:"35vh",overflow:"auto"},class:"q-pa-md"},He=n("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[n("b",null,"Detail Items")],-1),Be={class:"row q-pb-md"},Ge={class:"col"},je={class:"text-h6"},Ke={class:"col text-right"},Je={class:"row"},We={class:"col"},Xe={class:"row items-center justify-end"},Ze={class:"row items-center justify-end"},J={__name:"salesOrderCreate",props:{sloHeader:String},setup(q){const g=X(),V=q,o=r({TSLO_SLOCD:"",TSLO_ISSUDT:ge.formatDate(Date.now(),"YYYY-MM-DD"),TSLO_PLAN_DLVDT:"",TSLO_QUOCD:"",TSLO_POCD:"",TSLO_CUSCD:"",TSLO_ATTN:"",TSLO_TYPE:1,TSLO_ADDRESS_NAME:"",TSLO_ADDRESS_DESCRIPTION:"",TSLO_SERVTRANS_COST:0,TSLO_ISCON:!1});r(""),r("");const U=r([]),A=r([]),C=r([]),s=r(!1),N=r(1),D=r([]);W(async()=>{V.sloHeader&&V.sloHeader!==""&&(await Z(V.sloHeader),console.log(o.value),await m(o.value.TSLO_QUOCD)),p()});const I=(d,a,t,S)=>{a(async()=>{S==="quotation"&&await m(d),S==="item"&&await T(d),S==="cust"&&await p(d)})},m=async(d="")=>{s.value=!0,await b.post("quotation/search",{searchBy:"MCUS_CUSNM",searchValue:d,approval:1}).then(a=>{s.value=!1,U.value=a.data.data}).catch(a=>{s.value=!1})},T=async d=>{s.value=!0,await b.post("item/searchAPI",{searchValue:d}).then(a=>{s.value=!1,A.value=a.data.data}).catch(()=>{s.value=!1})},u=()=>o.value.TSLO_TYPE===1?"Rental":o.value.TSLO_TYPE===2?"Sales":"Service",p=async d=>{s.value=!0,await b.post("customer/searchAPI",{searchValue:d}).then(a=>{s.value=!1,C.value=a.data.data}).catch(()=>{s.value=!1})},Z=async d=>{s.value=!0,await b.get(`receive-order/getData/${btoa(d)}`).then(a=>{s.value=!1,console.log(a.data.det),o.value=a.data,D.value=a.data.det}).catch(()=>{s.value=!1})},z=async d=>{console.log(d),s.value=!0,await Ce.get(`transaction/quotation/view/${btoa(d)}`).then(a=>{s.value=!1,o.value.TSLO_CUSCD=a.data.data.TQUO_CUSCD,o.value.TSLO_ADDRESS_NAME=a.data.data.cust.MCUS_CUSNM,o.value.TSLO_ADDRESS_DESCRIPTION=a.data.data.cust.MCUS_ADDR1,o.value.TSLO_ATTN=a.data.data.TQUO_ATTN,D.value=[],a.data.data.det.map(t=>{D.value.push({TSLODETA_ITMCD:t.TQUODETA_ITMCD,TSLODETA_ITMQT:t.TQUODETA_ITMQT,TSLODETA_USAGE_DESCRIPTION:t.TQUODETA_USAGE,TSLODETA_PRC:t.TQUODETA_PRC,TSLODETA_PERIOD_FR:t.TQUODETA_PERIOD_FR,TSLODETA_PERIOD_TO:t.TQUODETA_PERIOD_TO})})}).catch(a=>{s.value=!1})},ee=()=>{D.value.push({TSLODETA_ITMCD:"",TSLODETA_ITMQT:"",TSLODETA_USAGE_DESCRIPTION:"",TSLODETA_PRC:0,TSLODETA_PERIOD_FR:"",TSLODETA_PERIOD_TO:""})},le=d=>{g.dialog({title:"Confirmation",message:`Do you want to delete this lines no ${d+1} ?`,cancel:!0,persistent:!0}).onOk(async()=>{D.value.splice(d,1)})},ae=()=>{g.dialog({title:"Confirmation",message:"Are you sure want to save this RO ?",cancel:!0,persistent:!0}).onOk(async()=>{s.value=!0,await b.post("receive-order/saveAPI",{...o.value,det:D.value}).then(d=>{s.value=!1,g.notify({color:"green",message:`${d.data.msg}`}),ne()}).catch(()=>{s.value=!1})})},te=()=>{},{dialogRef:oe,onDialogHide:se,onDialogOK:ne,onDialogCancel:de}=De();return(d,a)=>(f(),y(Se,{ref_key:"dialogRef",ref:oe,onHide:H(se),"transition-show":"slide-up","transition-hide":"slide-down","full-width":""},{default:l(()=>[e(re,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:l(()=>[e(F,null,{default:l(()=>[Ve]),_:1}),e(F,{class:"q-pa-sm"},{default:l(()=>[n("fieldset",be,[Ee,n("div",Ue,[n("div",Ae,[e(O,{label:"RO Code",dense:"",filled:"",modelValue:o.value.TSLO_SLOCD,"onUpdate:modelValue":a[0]||(a[0]=t=>o.value.TSLO_SLOCD=t),disable:"",loading:s.value},null,8,["modelValue","loading"])]),n("div",Ie,[e(O,{filled:"",modelValue:o.value.TSLO_ISSUDT,"onUpdate:modelValue":a[2]||(a[2]=t=>o.value.TSLO_ISSUDT=t),dense:"",label:"Issue Date",loading:s.value,onClick:a[3]||(a[3]=t=>d.quotationIssueDate.qDateProxy.show()),mask:"####-##-##","fill-mask":"",hint:"Mask: YYYY-MM-DD"},{append:l(()=>[e(w,{name:"event",class:"cursor-pointer"},{default:l(()=>[e(P,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(Q,{modelValue:o.value.TSLO_ISSUDT,"onUpdate:modelValue":a[1]||(a[1]=t=>o.value.TSLO_ISSUDT=t),mask:"YYYY-MM-DD"},{default:l(()=>[n("div",he,[h(e(v,{label:"Close",color:"primary",flat:""},null,512),[[k]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","loading"])]),n("div",we,[e(O,{filled:"",modelValue:o.value.TSLO_PLAN_DLVDT,"onUpdate:modelValue":a[5]||(a[5]=t=>o.value.TSLO_PLAN_DLVDT=t),dense:"",label:"Delivery Date",loading:s.value,onClick:a[6]||(a[6]=t=>d.quotationIssueDate.qDateProxy.show()),mask:"####-##-##","fill-mask":"",hint:"Mask: YYYY-MM-DD"},{append:l(()=>[e(w,{name:"event",class:"cursor-pointer"},{default:l(()=>[e(P,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(Q,{modelValue:o.value.TSLO_PLAN_DLVDT,"onUpdate:modelValue":a[4]||(a[4]=t=>o.value.TSLO_PLAN_DLVDT=t),mask:"YYYY-MM-DD"},{default:l(()=>[n("div",ye,[h(e(v,{label:"Close",color:"primary",flat:""},null,512),[[k]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","loading"])])]),n("div",Re,[n("div",Pe,[e(M,{dense:"",filled:"",label:"Sales Quotation Code",modelValue:o.value.TSLO_QUOCD,"onUpdate:modelValue":[a[7]||(a[7]=t=>o.value.TSLO_QUOCD=t),z],"use-input":"","input-debounce":"500",options:U.value,onFilter:a[8]||(a[8]=(t,S,i)=>I(t,S,i,"quotation")),behavior:"dialog","option-label":"DESCSEL","option-value":"TQUO_QUOCD","emit-value":"","map-options":"",loading:s.value},null,8,["modelValue","options","loading"])]),n("div",Qe,[e(O,{label:"PO Number",dense:"",filled:"",modelValue:o.value.TSLO_POCD,"onUpdate:modelValue":a[9]||(a[9]=t=>o.value.TSLO_POCD=t),loading:s.value},null,8,["modelValue","loading"])]),n("div",ke,[e(M,{dense:"",filled:"",label:"Customer Name",modelValue:o.value.TSLO_CUSCD,"onUpdate:modelValue":a[10]||(a[10]=t=>o.value.TSLO_CUSCD=t),"use-input":"","input-debounce":"500",options:C.value,onFilter:a[11]||(a[11]=(t,S,i)=>I(t,S,i,"cust")),behavior:"dialog","option-label":"MCUS_CUSNM","option-value":"MCUS_CUSCD","emit-value":"","map-options":"",loading:s.value,readonly:N.value===3},null,8,["modelValue","options","loading","readonly"])])])]),n("div",Me,[n("div",Ne,[e(Le,{modelValue:o.value.TSLO_TYPE,"onUpdate:modelValue":a[12]||(a[12]=t=>o.value.TSLO_TYPE=t),spread:"","no-caps":"","toggle-color":"purple",color:"white","text-color":"black",options:[{label:"Rental",value:1},{label:"Sales",value:2},{label:"Service",value:3}]},null,8,["modelValue"])])]),o.value.TSLO_TYPE!=1?(f(),R("div",Ye,[n("div",$e,[e(O,{prefix:"Rp",label:"Service & Transportation Price",modelValue:o.value.TSLO_SERVTRANS_COST,"onUpdate:modelValue":a[13]||(a[13]=t=>o.value.TSLO_SERVTRANS_COST=t),filled:"",dense:""},null,8,["modelValue"])])])):_e("",!0),n("div",xe,[n("div",qe,[e(ce,{modelValue:o.value.TSLO_ISCON,"onUpdate:modelValue":a[14]||(a[14]=t=>o.value.TSLO_ISCON=t),label:"Is Contract ?",color:"teal","toggle-indeterminate":!1,"true-value":1,"false-value":0,"indeterminate-value":0,disable:s.value},null,8,["modelValue","disable"])])]),n("fieldset",Fe,[He,n("div",Be,[n("div",Ge,[n("span",je,E(u()),1)]),n("div",Ke,[e(v,{flat:"",icon:"add",color:"blue",label:"Add Lines",onClick:ee,loading:s.value},null,8,["loading"]),e(v,{flat:"",icon:"person",color:"indigo",label:"Customer",onClick:te,loading:s.value},null,8,["loading"])])]),n("div",Je,[n("div",We,[e(pe,{bordered:"",dense:""},{default:l(()=>[D.value.length>0?(f(!0),R($,{key:0},x(D.value,(t,S)=>(f(),y(B,{key:S,class:"q-my-sm",dense:""},{default:l(()=>[e(L,{avatar:""},{default:l(()=>[e(me,{"text-color":"blue"},{default:l(()=>[_(E(S+1),1)]),_:2},1024)]),_:2},1024),e(L,null,{default:l(()=>[e(c,{class:"text-center"},{default:l(()=>[e(M,{dense:"",filled:"",label:"Item Name",modelValue:t.TSLODETA_ITMCD,"onUpdate:modelValue":i=>t.TSLODETA_ITMCD=i,"use-input":"","input-debounce":"500",options:A.value,onFilter:a[15]||(a[15]=(i,ie,ue)=>I(i,ie,ue,"item")),behavior:"dialog","option-label":"MITM_ITMNM","option-value":"MITM_ITMNM","emit-value":"","map-options":"",loading:s.value},null,8,["modelValue","onUpdate:modelValue","options","loading"])]),_:2},1024),e(c,{caption:""},{default:l(()=>[_(" Item Name ")]),_:1})]),_:2},1024),e(L,null,{default:l(()=>[e(c,null,{default:l(()=>[e(O,{modelValue:t.TSLODETA_ITMQT,"onUpdate:modelValue":i=>t.TSLODETA_ITMQT=i,dense:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(c,{caption:""},{default:l(()=>[_(" Qty ")]),_:1})]),_:2},1024),e(L,null,{default:l(()=>[e(c,null,{default:l(()=>[e(O,{modelValue:t.TSLODETA_USAGE_DESCRIPTION,"onUpdate:modelValue":i=>t.TSLODETA_USAGE_DESCRIPTION=i,dense:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(c,{caption:""},{default:l(()=>[_(" Usage ")]),_:1})]),_:2},1024),e(L,null,{default:l(()=>[e(c,null,{default:l(()=>[e(O,{modelValue:t.TSLODETA_PRC,"onUpdate:modelValue":i=>t.TSLODETA_PRC=i,dense:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(c,{caption:""},{default:l(()=>[_(" Price ")]),_:1})]),_:2},1024),e(L,null,{default:l(()=>[e(c,null,{default:l(()=>[e(O,{filled:"",modelValue:t.TSLODETA_PERIOD_FR,"onUpdate:modelValue":i=>t.TSLODETA_PERIOD_FR=i,dense:"",loading:s.value,onClick:a[16]||(a[16]=i=>d.quotationIssueDate.qDateProxy.show()),mask:"####-##-##","fill-mask":""},{append:l(()=>[e(w,{name:"event",class:"cursor-pointer"},{default:l(()=>[e(P,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(Q,{modelValue:t.TSLODETA_PERIOD_FR,"onUpdate:modelValue":i=>t.TSLODETA_PERIOD_FR=i,mask:"YYYY-MM-DD"},{default:l(()=>[n("div",Xe,[h(e(v,{label:"Close",color:"primary",flat:""},null,512),[[k]])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","loading"])]),_:2},1024),e(c,{caption:""},{default:l(()=>[_(" Period From ")]),_:1})]),_:2},1024),e(L,null,{default:l(()=>[e(c,null,{default:l(()=>[e(O,{filled:"",modelValue:t.TSLODETA_PERIOD_TO,"onUpdate:modelValue":i=>t.TSLODETA_PERIOD_TO=i,dense:"",loading:s.value,onClick:a[17]||(a[17]=i=>d.quotationIssueDate.qDateProxy.show()),mask:"####-##-##","fill-mask":""},{append:l(()=>[e(w,{name:"event",class:"cursor-pointer"},{default:l(()=>[e(P,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(Q,{modelValue:t.TSLODETA_PERIOD_TO,"onUpdate:modelValue":i=>t.TSLODETA_PERIOD_TO=i,mask:"YYYY-MM-DD"},{default:l(()=>[n("div",Ze,[h(e(v,{label:"Close",color:"primary",flat:""},null,512),[[k]])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","loading"])]),_:2},1024),e(c,{caption:""},{default:l(()=>[_(" Period To ")]),_:1})]),_:2},1024),e(L,{side:""},{default:l(()=>[e(v,{icon:"delete",color:"red",flat:"",onClick:i=>le(S)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)):h((f(),y(B,{key:1,class:"q-my-sm",clickable:""},{default:l(()=>[e(L,null,{default:l(()=>[e(c,null,{default:l(()=>[_(" No Items Added ")]),_:1})]),_:1})]),_:1})),[[Te]])]),_:1})])])])]),_:1}),e(ve,{align:"right"},{default:l(()=>[e(v,{label:"OK",color:"primary",onClick:a[18]||(a[18]=t=>ae()),disable:d.stateSubmit,loading:s.value},null,8,["disable","loading"]),e(v,{flat:"",label:"Cancel",color:"red",onClick:H(de)},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}};const ze={class:"q-pa-md"},el={class:"row q-pb-md"},ll=n("div",{class:"col"},[n("span",{class:"text-h4"},"Sales Order / Receive Order")],-1),al={class:"col text-right"},tl={class:"row q-pt-md"},ol={class:"col"},vl={__name:"salesOrderView",setup(q){const g=X(),V=r("TSLO_SLOCD"),o=r(""),U=r([]),A=r([{name:"TSLO_SLOCD",label:"RO. Code",field:"TSLO_SLOCD",sortable:!0,align:"left"},{name:"MCUS_CUSNM",label:"Customer Name",field:"MCUS_CUSNM",sortable:!0,align:"left"},{name:"TSLO_ADDRESS_NAME",label:"Customer Addr.",field:"TSLO_ADDRESS_NAME",sortable:!0,align:"left"},{name:"TSLO_CUSCD",label:"Customer Code",field:"TSLO_CUSCD",sortable:!0,align:"left"},{name:"TSLO_ISSUDT",label:"Issue Date",field:"TSLO_ISSUDT",sortable:!0,align:"left"},{name:"TSLO_QUOCD",label:"Quot. Code",field:"TSLO_QUOCD",sortable:!0,align:"left"}]),C=r(!1);W(()=>{s()});const s=async()=>{C.value=!0,await b.post("receive-order/searchAPI",{searchBy:V.value,searchValue:o.value}).then(m=>{C.value=!1,U.value=m.data.data}).catch(m=>{C.value=!1})},N=()=>{g.dialog({component:J}).onOk(async m=>{s()})},D=m=>{console.log(m),g.dialog({component:J,componentProps:{sloHeader:m}}).onOk(async T=>{s()})},I=m=>{g.dialog({title:"Confirmation",message:"Are you sure want to delete this data ?",cancel:!0,persistent:!0}).onOk(async()=>{C.value=!0,await b.delete(`receive-order/itemsAPI/${btoa(m)}`).then(T=>{C.value=!1,s()})})};return(m,T)=>(f(),R("div",ze,[n("div",el,[ll,n("div",al,[e(v,{icon:"add",color:"blue",onClick:T[0]||(T[0]=u=>N())},{default:l(()=>[e(Y,null,{default:l(()=>[_("Create New RO")]),_:1})]),_:1})])]),e(Oe),n("div",tl,[n("div",ol,[e(fe,{title:"Created RO",rows:U.value,columns:A.value,"row-key":"name",loading:C.value,dense:"",pagination:{rowsPerPage:20},class:"my-sticky-header-column-table"},{"top-right":l(()=>[e(M,{outlined:"",modelValue:V.value,"onUpdate:modelValue":T[1]||(T[1]=u=>V.value=u),options:A.value,label:"Search Columns","option-value":"name","option-label":"label","emit-value":"",dense:"","map-options":""},null,8,["modelValue","options"]),e(O,{borderless:"",dense:"",modelValue:o.value,"onUpdate:modelValue":[T[2]||(T[2]=u=>o.value=u),T[3]||(T[3]=u=>s())],placeholder:"Search",outlined:"",debounce:"1000"},{append:l(()=>[e(w,{name:"search"})]),_:1},8,["modelValue"])]),header:l(u=>[e(j,{props:u},{default:l(()=>[e(G,{"auto-width":""},{default:l(()=>[_("Action")]),_:1}),(f(!0),R($,null,x(u.cols,p=>(f(),y(G,{key:p.name,props:u},{default:l(()=>[_(E(p.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:l(u=>[e(j,{props:u},{default:l(()=>[e(K,{"auto-width":""},{default:l(()=>[e(v,{flat:"",color:u.row.dlv.length>0?"grey":"orange",icon:"edit",onClick:p=>D(u.row.TSLO_SLOCD),dense:""},{default:l(()=>[e(Y,null,{default:l(()=>[_(E(u.row.dlv.length>0?"RO already used for delivery, cannot edit !":"Edit this RO"),1)]),_:2},1024)]),_:2},1032,["color","onClick"]),e(v,{flat:"",color:u.row.dlv.length>0?"grey":"red",icon:"delete",onClick:p=>I(u.row.TSLO_SLOCD),dense:"",disable:u.row.dlv.length>0},{default:l(()=>[e(Y,null,{default:l(()=>[_(E(u.row.dlv.length>0?"RO already used for delivery, cannot delete !":"Delete this RO"),1)]),_:2},1024)]),_:2},1032,["color","onClick","disable"])]),_:2},1024),(f(!0),R($,null,x(u.cols,p=>(f(),y(K,{key:p.name,props:u},{default:l(()=>[_(E(p.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])])])]))}};export{vl as default};
