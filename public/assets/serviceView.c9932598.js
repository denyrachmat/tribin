import{Q as P}from"./QTooltip.083141ee.js";import{t as T,o as Z,C as _,D as C,E as l,F as e,M as le,O as Y,J as s,$ as U,aZ as k,X as te,Q as I,Y as K,Z as ae,a as F,c as ge,a5 as se,u as Ce,h as q,ab as Te,d as he,a_ as Me,w as De,bd as oe,g as pe,aI as ve,I as R,a0 as Ve,av as Se,U as de,R as x,S as ne,T as ie,V as ye,P as j,W as Ie}from"./index.c3fcab2b.js";import{Q as z,b as be}from"./QSelect.0bf83c69.js";import{Q as we,a as re}from"./QTable.2527897b.js";import{Q as ue,a as ce}from"./QTd.32f41fb9.js";import{u as X}from"./use-quasar.afa8d24b.js";import{d as ee}from"./date.c4a65f56.js";import{api_web as H}from"./axios.7588d587.js";import{Q as Re,a as ke,C as Oe}from"./ClosePopup.9fbae94c.js";import{Q as me,a as E,b as _e}from"./QItemLabel.c8959246.js";import{Q as Ue}from"./QList.c956f2e6.js";import{u as W}from"./use-dialog-plugin-component.13d98c33.js";import{Q as Ne}from"./QUploader.28492570.js";import{_ as $e}from"./serviceOprUpdateOrder.3adb013d.js";import"./format.fb659b30.js";import"./use-render-cache.3aae9b27.js";import"./QBtnGroup.31f20f7e.js";import"./QBadge.09998151.js";import"./serviceOprItemAdd.55978e59.js";import"./QInnerLoading.89bc5bcd.js";const Ae=s("div",{class:"text-h6"},"Create Item Master",-1),Pe={class:"row"},He={class:"col"},Le={class:"col q-pl-md"},Qe={class:"row q-pt-md"},qe={class:"col"},Ee={class:"col q-pl-md"},Ye={class:"row q-pt-md"},Fe={class:"col"},xe={class:"col q-pl-md"},Ke={class:"row q-pt-md"},Be={class:"col"},Ge={__name:"itemCreate",props:{ItemCat:String,ItemType:String,isAutoCD:Boolean,listOpenField:Array},setup(n){const{dialogRef:D,onDialogHide:p,onDialogOK:O,onDialogCancel:N}=W(),V=X(),o=T({MITM_ITMCD:"",MITM_ITMNM:"",MITM_STKUOM:"",MITM_ITMTYPE:1,MITM_BRAND:"",MITM_MODEL:"",MITM_SPEC:"",MITM_ITMCAT:"",MITM_COACD:"",MITM_ITMCAT:""}),f=T(!1),w=T([]),y=T([]),u=n;Z(()=>{M(),o.value.MITM_ITMCAT=u.ItemCat,o.value.MITM_ITMTYPE=u.ItemType});const m=(h,t,c,i)=>{t(async()=>{await H.post("item/getListCoasAPI",{search:h}).then(a=>{y.value=a.data})})},S=()=>{V.dialog({title:"Confirmation",message:"Do you want to save this item ?",cancel:!0,persistent:!0}).onOk(async()=>{await H.post("item",o.value).then(h=>{O(h.data.data)})})},M=async()=>{f.value=!0,await H.get("item/formAPI").then(h=>{f.value=!1,w.value=h.data.uoms,y.value=h.data.coas}).catch(()=>{f.value=!1})},b=h=>u.listOpenField.length===0||u.listOpenField.includes(h);return(h,t)=>(_(),C(ae,{ref_key:"dialogRef",ref:D,onHide:K(p),"transition-show":"slide-up","transition-hide":"slide-down","full-width":"",persistent:""},{default:l(()=>[e(le,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:l(()=>[e(Y,null,{default:l(()=>[Ae]),_:1}),e(Y,{class:"q-pa-sm"},{default:l(()=>[s("div",Pe,[s("div",He,[b("MITM_ITMCD")?(_(),C(U,{key:0,label:"Item Code",dense:"",modelValue:o.value.MITM_ITMCD,"onUpdate:modelValue":t[0]||(t[0]=c=>o.value.MITM_ITMCD=c),filled:"",readonly:u.isAutoCD},null,8,["modelValue","readonly"])):k("",!0)]),s("div",Le,[b("MITM_ITMNM")?(_(),C(U,{key:0,label:"Item Name",dense:"",modelValue:o.value.MITM_ITMNM,"onUpdate:modelValue":t[1]||(t[1]=c=>o.value.MITM_ITMNM=c),filled:""},null,8,["modelValue"])):k("",!0)])]),s("div",Qe,[s("div",qe,[b("MITM_STKUOM")?(_(),C(z,{key:0,dense:"",filled:"",label:"UOM",modelValue:o.value.MITM_STKUOM,"onUpdate:modelValue":t[2]||(t[2]=c=>o.value.MITM_STKUOM=c),options:w.value,behavior:"dialog","option-label":"MUOM_UOMNM","option-value":"MUOM_UOMCD","emit-value":"","map-options":"",loading:f.value},null,8,["modelValue","options","loading"])):k("",!0)]),s("div",Ee,[b("MITM_BRAND")?(_(),C(U,{key:0,label:"Item Brand",dense:"",modelValue:o.value.MITM_BRAND,"onUpdate:modelValue":t[3]||(t[3]=c=>o.value.MITM_BRAND=c),filled:""},null,8,["modelValue"])):k("",!0)])]),s("div",Ye,[s("div",Fe,[b("MITM_MODEL")?(_(),C(U,{key:0,label:"Item Model",dense:"",modelValue:o.value.MITM_MODEL,"onUpdate:modelValue":t[4]||(t[4]=c=>o.value.MITM_MODEL=c),filled:""},null,8,["modelValue"])):k("",!0)]),s("div",xe,[b("MITM_SPEC")?(_(),C(U,{key:0,label:"Item Specification",dense:"",modelValue:o.value.MITM_SPEC,"onUpdate:modelValue":t[5]||(t[5]=c=>o.value.MITM_SPEC=c),filled:""},null,8,["modelValue"])):k("",!0)])]),s("div",Ke,[s("div",Be,[b("MITM_COACD")?(_(),C(z,{key:0,dense:"",filled:"",label:"COA",modelValue:o.value.MITM_COACD,"onUpdate:modelValue":t[6]||(t[6]=c=>o.value.MITM_COACD=c),options:y.value,"use-input":"",behavior:"dialog","option-label":"MCOA_COANM","option-value":"MCOA_COACD",onFilter:t[7]||(t[7]=(c,i,a)=>m(c,i,a)),"emit-value":"","map-options":"",loading:f.value},null,8,["modelValue","options","loading"])):k("",!0)])])]),_:1}),e(te,{align:"right"},{default:l(()=>[e(I,{label:"OK",color:"primary",onClick:t[8]||(t[8]=c=>S())}),e(I,{flat:"",label:"Cancel",color:"red",onClick:K(N)},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}},je=s("div",{class:"text-h6"},"Create New Customer Data",-1),ze={class:"row q-pb-md"},We={class:"col"},Ze={class:"row q-pb-md"},Xe={class:"col"},Je={class:"col q-pl-md"},el={class:"row"},ll={class:"col"},tl={__name:"customerView",setup(n){const{dialogRef:D,onDialogHide:p,onDialogOK:O,onDialogCancel:N}=W(),V=X(),o=T({MCUS_CUSCD:"",MCUS_CUSNM:"",MCUS_CURCD:"IDR",MCUS_TAXREG:"-",MCUS_ADDR1:"",MCUS_TELNO:"",MCUS_PIC_NAME:"-",MCUS_PIC_TELNO:"-",MCUS_TYPE:1,MCUS_GROUP:"SERVICE",MCUS_EMAIL:""}),f=T(!1),w=()=>{V.dialog({title:"Confirmation",message:"Do you want to save this customer ?",cancel:!0,persistent:!0}).onOk(async()=>{f.value=!0,await H.post("customer",o.value).then(y=>{f.value=!1,O(y.data)}).catch(y=>{f.value=!1})})};return(y,u)=>(_(),C(ae,{ref_key:"dialogRef",ref:D,onHide:K(p),"transition-show":"slide-up","transition-hide":"slide-down","full-width":""},{default:l(()=>[e(le,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:l(()=>[e(Y,null,{default:l(()=>[je]),_:1}),e(Y,{class:"q-pa-sm"},{default:l(()=>[s("div",ze,[s("div",We,[e(U,{label:"Customer Name",dense:"",modelValue:o.value.MCUS_CUSNM,"onUpdate:modelValue":u[0]||(u[0]=m=>o.value.MCUS_CUSNM=m),filled:""},null,8,["modelValue"])])]),s("div",Ze,[s("div",Xe,[e(U,{label:"Customer Email",dense:"",modelValue:o.value.MCUS_EMAIL,"onUpdate:modelValue":u[1]||(u[1]=m=>o.value.MCUS_EMAIL=m),filled:""},null,8,["modelValue"])]),s("div",Je,[e(U,{label:"Customer Phone",dense:"",modelValue:o.value.MCUS_TELNO,"onUpdate:modelValue":u[2]||(u[2]=m=>o.value.MCUS_TELNO=m),filled:"",mask:"####-####-####"},null,8,["modelValue"])])]),s("div",el,[s("div",ll,[e(U,{label:"Customer Address",dense:"",modelValue:o.value.MCUS_ADDR1,"onUpdate:modelValue":u[3]||(u[3]=m=>o.value.MCUS_ADDR1=m),filled:"",type:"textarea"},null,8,["modelValue"])])])]),_:1}),e(te,{align:"right"},{default:l(()=>[e(I,{label:"OK",color:"primary",onClick:u[4]||(u[4]=m=>w()),loading:f.value},null,8,["loading"]),e(I,{flat:"",label:"Cancel",color:"red",onClick:K(N),loading:f.value},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}},al={ratio:[String,Number]};function ol(n,D){return F(()=>{const p=Number(n.ratio||(D!==void 0?D.value:void 0));return isNaN(p)!==!0&&p>0?{paddingBottom:`${100/p}%`}:null})}const nl=1.7778;var il=ge({name:"QImg",props:{...al,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},loadingShowDelay:{type:[Number,String],default:0},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:nl},placeholderSrc:String,errorSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(n,{slots:D,emit:p}){const O=T(n.initialRatio),N=ol(n,O),V=pe(),{registerTimeout:o,removeTimeout:f}=se(),{registerTimeout:w,removeTimeout:y}=se(),u=F(()=>n.placeholderSrc!==void 0?{src:n.placeholderSrc}:null),m=F(()=>n.errorSrc!==void 0?{src:n.errorSrc,__qerror:!0}:null),S=[T(null),T(u.value)],M=T(0),b=T(!1),h=T(!1),t=F(()=>`q-img q-img--${n.noNativeMenu===!0?"no-":""}menu`),c=F(()=>({width:n.width,height:n.height})),i=F(()=>`q-img__image ${n.imgClass!==void 0?n.imgClass+" ":""}q-img__image--with${n.noTransition===!0?"out":""}-transition q-img__image--`),a=F(()=>({...n.imgStyle,objectFit:n.fit,objectPosition:n.position}));function B(){if(y(),n.loadingShowDelay===0){b.value=!0;return}w(()=>{b.value=!0},n.loadingShowDelay)}function Q(){y(),b.value=!1}function $({target:r}){oe(V)===!1&&(f(),O.value=r.naturalHeight===0?.5:r.naturalWidth/r.naturalHeight,J(r,1))}function J(r,L){L===1e3||oe(V)===!0||(r.complete===!0?g(r):o(()=>{J(r,L+1)},50))}function g(r){oe(V)!==!0&&(M.value=M.value^1,S[M.value].value=null,Q(),r.getAttribute("__qerror")!=="true"&&(h.value=!1),p("load",r.currentSrc||r.src))}function d(r){f(),Q(),h.value=!0,S[M.value].value=m.value,S[M.value^1].value=u.value,p("error",r)}function v(r){const L=S[r].value,G={key:"img_"+r,class:i.value,style:a.value,alt:n.alt,crossorigin:n.crossorigin,decoding:n.decoding,referrerpolicy:n.referrerpolicy,height:n.height,width:n.width,loading:n.loading,fetchpriority:n.fetchpriority,"aria-hidden":"true",draggable:n.draggable,...L};return M.value===r?Object.assign(G,{class:G.class+"current",onLoad:$,onError:d}):G.class+="loaded",q("div",{class:"q-img__container absolute-full",key:"img"+r},q("img",G))}function A(){return b.value===!1?q("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},he(D[h.value===!0?"error":"default"])):q("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},D.loading!==void 0?D.loading():n.noSpinner===!0?void 0:[q(Me,{color:n.spinnerColor,size:n.spinnerSize})])}{let r=function(){De(()=>n.src||n.srcset||n.sizes?{src:n.src,srcset:n.srcset,sizes:n.sizes}:null,L=>{f(),h.value=!1,L===null?(Q(),S[M.value^1].value=u.value):B(),S[M.value].value=L},{immediate:!0})};Ce.value===!0?Z(r):r()}return()=>{const r=[];return N.value!==null&&r.push(q("div",{key:"filler",style:N.value})),S[0].value!==null&&r.push(v(0)),S[1].value!==null&&r.push(v(1)),r.push(q(Te,{name:"q-transition--fade"},A)),q("div",{key:"main",class:t.value,style:c.value,role:"img","aria-label":n.alt},r)}}});const sl={class:"bg-white"},dl={class:"row",style:{"min-height":"50vh","max-width":"90vh"}},rl={class:"col"},ul=s("div",{class:"text-h6"},"Preview Photo",-1),cl={__name:"uploadPhoto",props:{photo:String},emits:[...W.emits],setup(n){const D=X(),p=T(""),O=n;Z(()=>{O.photo!==""&&(p.value=O.photo)});const N=()=>{D.dialog({title:"Confirmation",message:"Do you want to remove this photo ?",cancel:!0,persistent:!0}).onOk(async()=>{y("")})},V=async m=>{const S=await o(m[0]);S&&(console.log(S),y(S))};function o(m){var S=new FileReader;return m&&S.readAsDataURL(m),new Promise((M,b)=>{S.onload=function(h){M(h.target.result)}})}const{dialogRef:f,onDialogHide:w,onDialogOK:y,onDialogCancel:u}=W();return(m,S)=>(_(),C(ae,{ref_key:"dialogRef",ref:f,onHide:K(w)},{default:l(()=>[s("div",sl,[s("div",dl,[s("div",rl,[p.value?(_(),C(le,{key:0},{default:l(()=>[e(Y,null,{default:l(()=>[ul]),_:1}),e(ve),e(Y,null,{default:l(()=>[e(il,{src:p.value,style:{width:"80vh"}},null,8,["src"])]),_:1}),e(te,{vertical:""},{default:l(()=>[e(I,{flat:"",onClick:S[0]||(S[0]=M=>N())},{default:l(()=>[R("Change Photo")]),_:1})]),_:1})]),_:1})):(_(),C(Ne,{key:1,class:"full-height",url:M=>V(M),label:"Upload Photo",color:"amber","text-color":"black",accept:"image/*",style:{"min-width":"500px"},"max-files":1,"auto-upload":"","send-raw":""},null,8,["url"]))])])])]),_:1},8,["onHide"]))}},ml=s("div",{class:"text-h6"},"Create Order",-1),_l={class:"row q-pb-md"},fl={class:"col"},vl={style:{border:"1px black solid","border-radius":"10px"}},Sl=s("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[s("b",null,"Header")],-1),gl={class:"row"},Cl={class:"col"},Tl={class:"col q-pl-md"},hl={class:"row items-center justify-end"},Ml={class:"row"},Dl={class:"col"},pl=s("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[s("b",null,"Detail Items")],-1),Vl={key:0,class:"row q-pb-sm"},yl={class:"col text-right"},fe={__name:"serviceCreateOrder",props:{header:Array,detail:Array,mode:String},setup(n){const{dialogRef:D,onDialogHide:p,onDialogOK:O,onDialogCancel:N}=W(),V=X(),o=n;Z(async()=>{o.header&&(await h(),await t(),f.value=o.header,u.value=o.detail,S.value=parseInt(o.header.SRVH_ISINT))});const f=T({SRVH_DOCNO:"",SRVH_ISSDT:ee.formatDate(Date.now(),"YYYY-MM-DD"),SRVH_CUSCD:""}),w=T([]),y=T([]),u=T([]),m=T(!1),S=T(0),M=T(0),b=(g,d,v,A)=>{d(async()=>{A==="cust"&&(S.value==1?await h("connect_jos","MCUS_CGCON"):await h(g)),A==="item"&&await t(g)})},h=async(g,d="MCUS_CUSNM")=>{m.value=!0,await H.post("customer/searchAPI",{searchValue:g,searchCol:d}).then(v=>{m.value=!1,y.value=v.data.data}).catch(()=>{m.value=!1})},t=async g=>{m.value=!0,await H.post("item/searchAPI",{searchValue:g,isForServ:S.value==1?0:1,isITMCD:1,useCustomer:f.value.SRVH_CUSCD}).then(d=>{m.value=!1,w.value=d.data.data}).catch(()=>{m.value=!1})},c=()=>{u.value.push({TSRVD_ITMCD:"",TSRVD_LINE:u.value.length+1,TSRVD_QTY:1,TSRVD_CUSTRMK:"",TSRVD_PHOTO:""})},i=g=>{V.dialog({title:"Confirmation",message:`Do you want to delete this lines no ${g+1} ?`,cancel:!0,persistent:!0}).onOk(async()=>{u.value.splice(g,1)}).catch(d=>{V.notify({color:"red",message:"Something's wrong."})})},a=g=>{V.dialog({component:Ge,componentProps:{ItemCat:"SERVICE_ITEM",ItemType:3,listOpenField:["MITM_ITMCD","MITM_ITMNM","MITM_STKUOM"]}}).onOk(async d=>{console.log(d),await t(""),u.value[g].TSRVD_ITMCD=d.MITM_ITMNM})},B=()=>{V.dialog({title:"Confirmation",message:"Do you want to submit this data ?",cancel:!0,persistent:!0}).onOk(async()=>{m.value=!0,await H.post("servicesAdmin",{header:{...f.value,SRVH_ISINT:S.value},detail:u.value}).then(g=>{m.value=!1,O()})})},Q=()=>{V.dialog({component:tl}).onOk(async g=>{console.log(g),await h(""),u.value[idx].SRVH_CUSCD=g.MCUS_CUSCD})},$=g=>{V.dialog({component:cl,componentProps:{photo:u.value[g].TSRVD_PHOTO}}).onOk(async d=>{console.log(d),d?u.value[g].TSRVD_PHOTO=d:u.value[g].TSRVD_PHOTO="",M.value=M.value+1,console.log(u.value[g])})},J=async g=>{g==1&&(f.value.SRVH_CUSCD="",y.value=[],await h("connect_jos","MCUS_CGCON"))};return(g,d)=>(_(),C(ae,{ref_key:"dialogRef",ref:D,onHide:K(p),"transition-show":"slide-up","transition-hide":"slide-down","full-width":"",persistent:""},{default:l(()=>[e(le,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:l(()=>[e(Y,null,{default:l(()=>[ml]),_:1}),e(Y,{class:"q-pa-sm"},{default:l(()=>[s("div",_l,[s("div",fl,[e(Ve,{modelValue:S.value,"onUpdate:modelValue":[d[0]||(d[0]=v=>S.value=v),d[1]||(d[1]=v=>J(v))],label:"Internal Service ?",color:"teal","true-value":1,"false-value":0,disable:m.value},null,8,["modelValue","disable"])])]),s("fieldset",vl,[Sl,s("div",gl,[s("div",Cl,[e(U,{label:"SPK No",readonly:"",dense:"",modelValue:f.value.SRVH_DOCNO,"onUpdate:modelValue":d[2]||(d[2]=v=>f.value.SRVH_DOCNO=v),filled:""},null,8,["modelValue"])]),s("div",Tl,[e(U,{filled:"",modelValue:f.value.SRVH_ISSDT,"onUpdate:modelValue":d[4]||(d[4]=v=>f.value.SRVH_ISSDT=v),dense:"",label:"Issue Date",loading:m.value,onClick:d[5]||(d[5]=v=>g.quotationIssueDate.qDateProxy.show()),mask:"####-##-##","fill-mask":"",hint:"Mask: YYYY-MM-DD",readonly:o.mode==="view"},{append:l(()=>[e(Se,{name:"event",class:"cursor-pointer",disable:o.mode==="view"},{default:l(()=>[e(Re,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(ke,{modelValue:f.value.SRVH_ISSDT,"onUpdate:modelValue":d[3]||(d[3]=v=>f.value.SRVH_ISSDT=v),mask:"YYYY-MM-DD"},{default:l(()=>[s("div",hl,[de(e(I,{label:"Close",color:"primary",flat:""},null,512),[[Oe]])])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["disable"])]),_:1},8,["modelValue","loading","readonly"])])]),s("div",Ml,[s("div",Dl,[e(z,{dense:"",filled:"",label:"Customer Choose",modelValue:f.value.SRVH_CUSCD,"onUpdate:modelValue":[d[7]||(d[7]=v=>f.value.SRVH_CUSCD=v),d[9]||(d[9]=v=>u.value=[])],"use-input":"","input-debounce":"500",options:y.value,onFilter:d[8]||(d[8]=(v,A,r)=>b(v,A,r,"cust")),behavior:"dialog","option-label":"MCUS_CUSNM","option-value":"MCUS_CUSCD","emit-value":"","map-options":"",loading:m.value,readonly:o.mode==="view"},{after:l(()=>[e(I,{round:"",dense:"",flat:"",icon:"person_add",onClick:d[6]||(d[6]=v=>Q()),color:"cyan"},{default:l(()=>[e(P,null,{default:l(()=>[R("Add new customer")]),_:1})]),_:1})]),_:1},8,["modelValue","options","loading","readonly"])])])]),(_(),x("fieldset",{style:{border:"1px black solid","border-radius":"10px",height:"35vh",overflow:"auto"},key:M.value},[pl,o.mode!=="view"?(_(),x("div",Vl,[s("div",yl,[e(I,{flat:"",icon:"add",color:"blue",onClick:d[10]||(d[10]=v=>c())},{default:l(()=>[e(P,null,{default:l(()=>[R("Add lines")]),_:1})]),_:1})])])):k("",!0),e(Ue,{bordered:"",dense:""},{default:l(()=>[u.value.length>0?(_(!0),x(ne,{key:0},ie(u.value,(v,A)=>(_(),C(me,{key:A,class:"q-my-sm",dense:""},{default:l(()=>[e(E,{avatar:""},{default:l(()=>[e(ye,{"text-color":"blue"},{default:l(()=>[R(j(A+1),1)]),_:2},1024)]),_:2},1024),e(E,null,{default:l(()=>[e(_e,{class:"text-center"},{default:l(()=>[e(z,{dense:"",filled:"",label:"Item Name",modelValue:v.TSRVD_ITMCD,"onUpdate:modelValue":r=>v.TSRVD_ITMCD=r,"use-input":"","input-debounce":"500",options:w.value,onFilter:d[11]||(d[11]=(r,L,G)=>b(r,L,G,"item")),behavior:"dialog","option-label":"MITM_ITMNMREAL","option-value":"MITM_ITMNM","emit-value":"","map-options":"",loading:m.value},null,8,["modelValue","onUpdate:modelValue","options","loading"])]),_:2},1024)]),_:2},1024),e(E,null,{default:l(()=>[e(U,{label:"Qty",filled:"",dense:"",modelValue:v.TSRVD_QTY,"onUpdate:modelValue":r=>v.TSRVD_QTY=r},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(E,null,{default:l(()=>[e(U,{label:"Problem",filled:"",dense:"",modelValue:v.TSRVD_CUSTRMK,"onUpdate:modelValue":r=>v.TSRVD_CUSTRMK=r},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o.mode!=="view"?(_(),C(E,{key:0,side:""},{default:l(()=>[e(I,{icon:"delete",color:"red",flat:"",onClick:r=>i(A),dense:""},{default:l(()=>[e(P,null,{default:l(()=>[R("Delete line")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),o.mode!=="view"?(_(),C(E,{key:1,side:""},{default:l(()=>[e(I,{icon:"library_add",color:"indigo",flat:"",onClick:r=>a(A),dense:""},{default:l(()=>[e(P,null,{default:l(()=>[R("Add new item")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),o.mode!=="view"?(_(),C(E,{key:2,side:""},{default:l(()=>[e(I,{icon:"photo",color:v.TSRVD_PHOTO!=""?"blue":"orange",flat:"",onClick:r=>$(A),dense:""},{default:l(()=>[e(P,null,{default:l(()=>[R("Add photo")]),_:1})]),_:2},1032,["color","onClick"])]),_:2},1024)):k("",!0)]),_:2},1024))),128)):de((_(),C(me,{key:1,class:"q-my-sm",clickable:""},{default:l(()=>[e(E,null,{default:l(()=>[e(_e,null,{default:l(()=>[R(" No Items Added ")]),_:1})]),_:1})]),_:1})),[[Ie]])]),_:1})]))]),_:1}),e(te,{align:"right"},{default:l(()=>[e(I,{label:"OK",color:"primary",onClick:d[12]||(d[12]=v=>B()),disable:m.value,loading:m.value},null,8,["disable","loading"]),e(I,{flat:"",label:"Cancel",color:"red",onClick:K(N),loading:m.value},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}};const Il={class:"q-pa-md"},bl={class:"row q-pb-md"},wl=s("div",{class:"col"},[s("span",{class:"text-h4"},"Receive Order ")],-1),Rl={class:"col text-right"},kl={class:"row q-pt-md"},Ol={class:"col"},Ul={key:1},Jl={__name:"serviceView",setup(n){const D=X(),p=T("SRVH_DOCNO"),O=T(""),N=T([]),V=T([{name:"SRVH_DOCNO",label:"SPK No",field:"SRVH_DOCNO",sortable:!0,align:"left"},{name:"MCUS_CUSNM",label:"Cust",field:"MCUS_CUSNM",sortable:!0,align:"left"},{name:"STAT",label:"Status",field:t=>h(t),sortable:!0,align:"left"},{name:"created_at",label:"Created Date",field:"created_at",sortable:!0,align:"left",format:t=>ee.formatDate(new Date(t),"DD MMM YYYY")}]),o=T(!1),f=T(null);Z(()=>{w(),f.value=setInterval(()=>{w()},1e4)});const w=async()=>{o.value=!0,await H.post("servicesAdmins/search",{searchBy:p.value,searchValue:O.value}).then(t=>{o.value=!1,N.value=t.data.data}).catch(t=>{o.value=!1})},y=()=>{D.dialog({component:fe}).onOk(async t=>{w()})},u=t=>{const c={SRVH_DOCNO:t.SRVH_DOCNO,SRVH_ISSDT:ee.formatDate(t.SRVH_ISSDT,"YYYY-MM-DD"),SRVH_CUSCD:t.MCUS_CUSCD};let i=[];t.detail.map(a=>{i.push({id:a.id,TSRVD_ITMCD:a.TSRVD_ITMCD,TSRVD_LINE:a.TSRVD_LINE,TSRVD_QTY:a.TSRVD_QTY,TSRVD_CUSTRMK:a.TSRVD_CUSTRMK,TSRVD_REMARK:a.TSRVD_REMARK,TSRVD_FLGSTS:a.TSRVD_FLGSTS,listFixDet:a.list_fix_det})}),D.dialog({component:$e,componentProps:{header:c,detail:i,mode:t.detail.filter(a=>a.TSRVD_FLGSTS===1).length===t.detail.length?"approvecust":"view"}}).onOk(async a=>{w()})},m=t=>{window.open("http://tribin.test/servicesAdmins/printInvoice/"+btoa(t),"_blank").focus()},S=t=>{const c={SRVH_DOCNO:t.SRVH_DOCNO,SRVH_ISSDT:ee.formatDate(t.SRVH_ISSDT,"YYYY-MM-DD"),SRVH_CUSCD:t.MCUS_CUSCD};let i=[];t.detail.map(a=>{i.push({TSRVD_ITMCD:a.TSRVD_ITMCD,TSRVD_LINE:a.TSRVD_LINE,TSRVD_QTY:a.TSRVD_QTY,TSRVD_CUSTRMK:a.TSRVD_CUSTRMK})}),D.dialog({component:fe,componentProps:{header:c,detail:i}}).onOk(async a=>{w()})},M=t=>{D.dialog({title:"Confirmation",message:"Do you want to proceed to service ?",cancel:!0,persistent:!0}).onOk(async()=>{o.value=!0,await H.put(`servicesAdmins/updateDetByIDHead/${btoa(t.id)}`,{TSRVD_FLGSTS:2}).then(c=>{o.value=!1}).catch(c=>{o.value=!1})})},b=t=>{D.dialog({title:"Confirmation",message:"Are you sure want to delete this order ?",cancel:!0,persistent:!0}).onOk(async()=>{o.value=!0,await H.delete(`servicesAdmin/${btoa(t.SRVH_DOCNO)}`).then(c=>{o.value=!1}).catch(c=>{o.value=!1})})},h=t=>{const c=t.detail.filter($=>$.TSRVD_FLGSTS==0),i=t.detail.filter($=>$.TSRVD_FLGSTS==1),a=t.detail.filter($=>$.TSRVD_FLGSTS==2),B=t.detail.filter($=>$.TSRVD_FLGSTS==3),Q=t.detail.filter($=>$.TSRVD_FLGSTS==5);if(c.length==t.detail.length)return{color:"red",label:"No Price Added yet !",icon:"edit"};if(i.length>0&&i.length<t.detail.length)return{color:"warning",label:"Please Add item & price",icon:"payments"};if(Q.length>0&&Q.length==t.detail.length)return{color:"indigo",label:"Added Price Done, Waiting Manager Confirmation",icon:"price_check"};if(i.length>0&&i.length==t.detail.length)return{color:"green",label:"Manager has been approve, Waiting Cust. Confirmation",icon:"price_check"};if(a.length>0&&a.length>=t.detail.length)return{color:"cyan",label:"Cust. has been approved, continue to fix.",icon:"engineering"};if(B.length>0&&B.length===t.detail.length)return{color:"primary",label:"Fix has been done",icon:"fact_check"}};return(t,c)=>(_(),x("div",Il,[s("div",bl,[wl,s("div",Rl,[e(I,{icon:"add",color:"blue",onClick:y},{default:l(()=>[e(P,null,{default:l(()=>[R("Create New Order")]),_:1})]),_:1})])]),e(ve),s("div",kl,[s("div",Ol,[e(we,{title:"Created Order",rows:N.value,columns:V.value,"row-key":"name",loading:o.value,dense:"",pagination:{rowsPerPage:20},class:"my-sticky-header-column-table"},{"top-right":l(()=>[e(z,{outlined:"",modelValue:p.value,"onUpdate:modelValue":c[0]||(c[0]=i=>p.value=i),options:V.value,label:"Search Columns","option-value":"name","option-label":"label","emit-value":"",dense:"","map-options":""},null,8,["modelValue","options"]),e(U,{borderless:"",dense:"",modelValue:O.value,"onUpdate:modelValue":[c[1]||(c[1]=i=>O.value=i),c[2]||(c[2]=i=>t.dataQuo())],placeholder:"Search",outlined:"",debounce:"1000"},{append:l(()=>[e(Se,{name:"search"})]),_:1},8,["modelValue"])]),header:l(i=>[e(ue,{props:i},{default:l(()=>[(_(!0),x(ne,null,ie(i.cols,a=>(_(),C(re,{key:a.name,props:i},{default:l(()=>[R(j(a.label),1)]),_:2},1032,["props"]))),128)),e(re,{"auto-width":""},{default:l(()=>[R("Action")]),_:1})]),_:2},1032,["props"])]),body:l(i=>[e(ue,{props:i},{default:l(()=>[(_(!0),x(ne,null,ie(i.cols,a=>(_(),C(ce,{key:a.name,props:i},{default:l(()=>[a.name==="STAT"?(_(),C(be,{key:0,clickable:"",color:a.value.color,"text-color":"white",icon:a.value.icon},{default:l(()=>[R(j(a.value.label),1)]),_:2},1032,["color","icon"])):(_(),x("span",Ul,j(a.value),1))]),_:2},1032,["props"]))),128)),e(ce,{"auto-width":""},{default:l(()=>[i.row.detail.filter(a=>a.TSRVD_FLGSTS>0).length===0?(_(),C(I,{key:0,flat:"",color:"orange",icon:"edit",onClick:a=>S(i.row),dense:""},{default:l(()=>[e(P,null,{default:l(()=>[R("Edit this Order")]),_:1})]),_:2},1032,["onClick"])):k("",!0),i.row.detail.filter(a=>a.TSRVD_FLGSTS>0).length===i.row.detail.length?(_(),C(I,{key:1,flat:"",color:"indigo",icon:"print",onClick:a=>m(i.row.SRVH_DOCNO),dense:""},{default:l(()=>[e(P,null,{default:l(()=>[R("Print Estimation Price")]),_:1})]),_:2},1032,["onClick"])):k("",!0),i.row.detail.filter(a=>a.TSRVD_FLGSTS>0).length===0?(_(),C(I,{key:2,flat:"",color:"red",icon:"delete",onClick:a=>b(i.row.SRVH_DOCNO),dense:""},{default:l(()=>[e(P,null,{default:l(()=>[R(j(i.row.detail.filter(a=>a.TSRVD_FLGSTS>0).length>0?"Cannot delete processed order":"Delete this Order"),1)]),_:2},1024)]),_:2},1032,["onClick"])):k("",!0),i.row.detail.filter(a=>a.TSRVD_FLGSTS>0).length>0?(_(),C(I,{key:3,flat:"",color:"cyan",icon:"visibility",onClick:a=>u(i.row),dense:""},{default:l(()=>[e(P,null,{default:l(()=>[R("View this Order")]),_:1})]),_:2},1032,["onClick"])):k("",!0),i.row.detail.filter(a=>a.TSRVD_FLGSTS==1).length===i.row.detail.length?(_(),C(I,{key:4,flat:"",color:"indigo",icon:"check",onClick:a=>M(i.row),dense:""},{default:l(()=>[e(P,null,{default:l(()=>[R(j(i.row.detail.filter(a=>a.TSRVD_FLGSTS>0).length!==i.row.detail.length?"Please wait until all item checked":"Proceed all item to service"),1)]),_:2},1024)]),_:2},1032,["onClick"])):k("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])])])]))}};export{Jl as default};
