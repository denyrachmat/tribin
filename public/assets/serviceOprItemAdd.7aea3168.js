import{o as B,t as V,C as t,D as r,E as e,F as a,M as K,O as D,J as y,R as p,Q as g,a_ as v,U as M,I as d,W as k,S as E,T as H,V as J,P as T,$ as F,X as W,Y as Q,Z as X}from"./index.ad60219f.js";import{u as Z,a as j,Q as z,b as R,c,d as u,l as G}from"./QTable.15d2ee6f.js";import{api_web as ee}from"./axios.ac806a2d.js";const ae={class:"row"},le=y("div",{class:"col"},[y("div",{class:"text-h6"},"Update Used Item")],-1),te={key:0,class:"col text-right"},oe={key:0},ne={key:0},ie={key:0},se={class:"text-h5 text-bold"},ce={__name:"serviceOprItemAdd",props:{mode:String,dataItem:Array},setup(C){const{dialogRef:b,onDialogHide:P,onDialogOK:N,onDialogCancel:h}=Z(),S=j(),n=C;B(async()=>{n.dataItem.listFixDet&&(_.value=n.dataItem.listFixDet,await w())});const I=V([]),_=V([]),m=V(!1),L=()=>{_.value.push({TSRVD_ID:n.dataItem.id,TSRVF_ITMCD:"",TSRVF_PRC:0,TSRVF_QTY:1})},O=(i,o,l,f)=>{o(async()=>{f==="item"&&await w(i)})},w=async i=>{m.value=!0,await ee.post("item/searchAPITBL",{searchValue:i}).then(o=>{m.value=!1,I.value=o.data.data}).catch(()=>{m.value=!1})},U=()=>{n.mode==="view"?h():S.dialog({title:"Confirmation",message:"Are you sure want to save this items ?",cancel:!0,persistent:!0}).onOk(async()=>{N(_.value)})},A=i=>{S.dialog({title:"Confirmation",message:`Do you want to delete this lines no ${i+1} ?`,cancel:!0,persistent:!0}).onOk(async()=>{_.value.splice(i,1)})},q=i=>{let o=0;return i.map(l=>{o+=parseInt(l.TSRVF_PRC)*parseInt(l.TSRVF_QTY)}),o.toLocaleString()},Y=(i,o)=>{const l=I.value.filter(f=>f.MITM_ITMCD===i);l.length>0&&(l[0].STOCK>0?(_.value[o].TSRVF_PRC=l[0].LATEST_PRC,_.value[o].STOCK=l[0].STOCK):(_.value[o].TSRVF_ITMCD="",S.notify({color:"red",message:`Stock item ${i} (${l[0].MITM_ITMNM}) is 0, please check stock status !`})))};return(i,o)=>(t(),r(X,{ref_key:"dialogRef",ref:b,onHide:Q(P),"transition-show":"slide-up","transition-hide":"slide-down","full-width":""},{default:e(()=>[a(K,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:e(()=>[a(D,null,{default:e(()=>[y("div",ae,[le,n.mode!=="view"?(t(),p("div",te,[a(g,{icon:"add",outline:"",color:"blue",onClick:L})])):v("",!0)])]),_:1}),a(D,{class:"q-pa-sm",style:{"max-height":"50vh"}},{default:e(()=>[a(z,{bordered:""},{default:e(()=>[_.value.length===0?M((t(),r(R,{key:0,class:"q-my-sm",clickable:""},{default:e(()=>[a(c,null,{default:e(()=>[d(" No items added ")]),_:1})]),_:1})),[[k]]):v("",!0),(t(!0),p(E,null,H(_.value,(l,f)=>M((t(),r(R,{key:f,class:"q-my-sm",clickable:""},{default:e(()=>[a(c,{avatar:""},{default:e(()=>[a(J,{color:"primary","text-color":"white"},{default:e(()=>[d(T(f+1),1)]),_:2},1024)]),_:2},1024),a(c,null,{default:e(()=>[a(u,null,{default:e(()=>[n.mode==="view"?(t(),p("div",oe,[m.value?(t(),r(u,{key:1},{default:e(()=>[d(" Please wait, loading item description ")]),_:1})):(t(),r(u,{key:0},{default:e(()=>[d(T(l.MITM_ITMNM?l.MITM_ITMNM:I.value.filter(s=>s.MITM_ITMCD==l.TSRVF_ITMCD)[0].MITM_ITMNM),1)]),_:2},1024)),a(u,{caption:""},{default:e(()=>[d(" Item ")]),_:1})])):(t(),r(G,{key:1,dense:"",filled:"",label:"Item Name",modelValue:l.TSRVF_ITMCD,"onUpdate:modelValue":[s=>l.TSRVF_ITMCD=s,s=>Y(s,f)],"use-input":"","input-debounce":"500",options:I.value,onFilter:o[0]||(o[0]=(s,$,x)=>O(s,$,x,"item")),behavior:"dialog","option-label":"MITM_ITMNM","option-value":"MITM_ITMCD","emit-value":"","map-options":"",loading:m.value,readonly:n.mode==="view"},null,8,["modelValue","onUpdate:modelValue","options","loading","readonly"]))]),_:2},1024)]),_:2},1024),a(c,null,{default:e(()=>[n.mode==="view"?(t(),p("div",ne,[a(u,null,{default:e(()=>[d(T(l.TSRVF_PRC.toLocaleString()),1)]),_:2},1024),a(u,{caption:""},{default:e(()=>[d(" Price ")]),_:1})])):(t(),r(F,{key:1,label:"Price",modelValue:l.TSRVF_PRC,"onUpdate:modelValue":s=>l.TSRVF_PRC=s,filled:"",dense:"",readonly:n.mode==="view"},null,8,["modelValue","onUpdate:modelValue","readonly"]))]),_:2},1024),a(c,null,{default:e(()=>[n.mode==="view"?(t(),p("div",ie,[a(u,null,{default:e(()=>[d(T(l.TSRVF_QTY.toLocaleString()),1)]),_:2},1024),a(u,{caption:""},{default:e(()=>[d(" Qty ")]),_:1})])):(t(),r(F,{key:1,label:"Qty",modelValue:l.TSRVF_QTY,"onUpdate:modelValue":s=>l.TSRVF_QTY=s,filled:"",dense:"",readonly:n.mode==="view"},null,8,["modelValue","onUpdate:modelValue","readonly"]))]),_:2},1024),n.mode==="view"?(t(),r(c,{key:0},{default:e(()=>[a(u,null,{default:e(()=>[d(" Rp "+T((parseInt(l.TSRVF_PRC)*parseInt(l.TSRVF_QTY)).toLocaleString()),1)]),_:2},1024),a(u,{caption:""},{default:e(()=>[d(" Total Price ")]),_:1})]),_:2},1024)):v("",!0),C.mode!=="view"?(t(),r(c,{key:1,side:""},{default:e(()=>[a(g,{icon:"delete",flat:"",color:"red",onClick:s=>A(f)},null,8,["onClick"])]),_:2},1024)):v("",!0)]),_:2},1024)),[[k]])),128)),C.mode==="view"?M((t(),r(R,{key:1,class:"q-my-sm",clickable:""},{default:e(()=>[a(c),a(c),a(c),a(c,null,{default:e(()=>[a(u,null,{default:e(()=>[y("span",se," Rp "+T(q(_.value)),1)]),_:1}),a(u,{caption:""},{default:e(()=>[d(" Total Price ")]),_:1})]),_:1})]),_:1})),[[k]]):v("",!0)]),_:1})]),_:1}),a(W,{align:"right"},{default:e(()=>[a(g,{label:"OK",color:"primary",onClick:o[1]||(o[1]=l=>U()),disable:m.value,loading:m.value},null,8,["disable","loading"]),a(g,{flat:"",label:"Cancel",color:"red",onClick:Q(h),loading:m.value},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}};export{ce as _};
