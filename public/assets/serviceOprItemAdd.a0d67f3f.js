import{o as x,t as S,C as n,D as _,E as e,F as a,M as E,O as D,J as y,R as I,Q as M,a_ as v,U as V,I as u,W as k,S as H,T as J,V as W,P as f,$ as F,X,Y as Q,Z}from"./index.ca751059.js";import{u as j,a as z,Q as G,b as R,c as m,d as c,l as ee}from"./QTable.4e2b43ef.js";import{api_web as ae}from"./axios.8c21a2d1.js";const le={class:"row"},te=y("div",{class:"col"},[y("div",{class:"text-h6"},"Update Used Item")],-1),oe={key:0,class:"col text-right"},ne={key:0},se={key:0},ie={key:0},de={class:"text-h5 text-bold"},_e={__name:"serviceOprItemAdd",props:{mode:String,dataItem:Array},setup(C){const{dialogRef:b,onDialogHide:P,onDialogOK:N,onDialogCancel:h}=j(),g=z(),i=C;x(async()=>{i.dataItem.listFixDet&&(d.value=i.dataItem.listFixDet,await w())});const p=S([]),d=S([]),T=S(!1),L=()=>{d.value.push({TSRVD_ID:i.dataItem.id,TSRVF_ITMCD:"",TSRVF_PRC:0,TSRVF_QTY:1})},O=(o,t,l,r)=>{t(async()=>{r==="item"&&await w(o)})},w=async o=>{T.value=!0,await ae.post("item/searchAPITBL",{searchValue:o}).then(t=>{T.value=!1,p.value=t.data.data}).catch(()=>{T.value=!1})},U=()=>{i.mode==="view"?h():g.dialog({title:"Confirmation",message:"Are you sure want to save this items ?",cancel:!0,persistent:!0}).onOk(async()=>{N(d.value)})},$=o=>{g.dialog({title:"Confirmation",message:`Do you want to delete this lines no ${o+1} ?`,cancel:!0,persistent:!0}).onOk(async()=>{d.value.splice(o,1)})},A=o=>{let t=0;return o.map(l=>{t+=parseInt(l.TSRVF_PRC)*parseInt(l.TSRVF_QTY)}),t.toLocaleString()},Y=(o,t)=>{const l=p.value.filter(r=>r.MITM_ITMCD===o);l.length>0&&(l[0].STOCK>0?(d.value[t].TSRVF_PRC=l[0].LATEST_PRC,d.value[t].STOCK=l[0].STOCK):(d.value[t].TSRVF_ITMCD="",g.notify({color:"red",message:`Stock item ${o} (${l[0].MITM_ITMNM}) is 0, please check stock status !`})))},q=(o,t)=>{if(o>d.value[t].STOCK){const l=p.value.filter(r=>r.MITM_ITMCD===o);g.notify({color:"red",message:`Stock item ${o} (${l[0].MITM_ITMNM}) is 0, please check stock status !`}),d.value[t].TSRVF_QTY=0}};return(o,t)=>(n(),_(Z,{ref_key:"dialogRef",ref:b,onHide:Q(P),"transition-show":"slide-up","transition-hide":"slide-down","full-width":""},{default:e(()=>[a(E,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:e(()=>[a(D,null,{default:e(()=>[y("div",le,[te,i.mode!=="view"?(n(),I("div",oe,[a(M,{icon:"add",outline:"",color:"blue",onClick:L})])):v("",!0)])]),_:1}),a(D,{class:"q-pa-sm",style:{"max-height":"50vh"}},{default:e(()=>[a(G,{bordered:""},{default:e(()=>[d.value.length===0?V((n(),_(R,{key:0,class:"q-my-sm",clickable:""},{default:e(()=>[a(m,null,{default:e(()=>[u(" No items added ")]),_:1})]),_:1})),[[k]]):v("",!0),(n(!0),I(H,null,J(d.value,(l,r)=>V((n(),_(R,{key:r,class:"q-my-sm",clickable:""},{default:e(()=>[a(m,{avatar:""},{default:e(()=>[a(W,{color:"primary","text-color":"white"},{default:e(()=>[u(f(r+1),1)]),_:2},1024)]),_:2},1024),a(m,null,{default:e(()=>[a(c,null,{default:e(()=>[i.mode==="view"?(n(),I("div",ne,[T.value?(n(),_(c,{key:1},{default:e(()=>[u(" Please wait, loading item description ")]),_:1})):(n(),_(c,{key:0},{default:e(()=>[u(f(l.MITM_ITMNM?l.MITM_ITMNM:p.value.filter(s=>s.MITM_ITMCD==l.TSRVF_ITMCD)[0].MITM_ITMNM),1)]),_:2},1024)),a(c,{caption:""},{default:e(()=>[u(" Item ")]),_:1})])):(n(),_(ee,{key:1,dense:"",filled:"",label:"Item Name",modelValue:l.TSRVF_ITMCD,"onUpdate:modelValue":[s=>l.TSRVF_ITMCD=s,s=>Y(s,r)],"use-input":"","input-debounce":"500",options:p.value,onFilter:t[0]||(t[0]=(s,B,K)=>O(s,B,K,"item")),behavior:"dialog","option-label":"MITM_ITMNM","option-value":"MITM_ITMCD","emit-value":"","map-options":"",loading:T.value,readonly:i.mode==="view"},null,8,["modelValue","onUpdate:modelValue","options","loading","readonly"]))]),_:2},1024)]),_:2},1024),a(m,null,{default:e(()=>[i.mode==="view"?(n(),I("div",se,[a(c,null,{default:e(()=>[u(f(l.TSRVF_PRC.toLocaleString()),1)]),_:2},1024),a(c,{caption:""},{default:e(()=>[u(" Price ")]),_:1})])):(n(),_(F,{key:1,label:"Price",modelValue:l.TSRVF_PRC,"onUpdate:modelValue":s=>l.TSRVF_PRC=s,filled:"",dense:"",readonly:i.mode==="view"},null,8,["modelValue","onUpdate:modelValue","readonly"]))]),_:2},1024),a(m,null,{default:e(()=>[i.mode==="view"?(n(),I("div",ie,[a(c,null,{default:e(()=>[u(f(l.TSRVF_QTY.toLocaleString()),1)]),_:2},1024),a(c,{caption:""},{default:e(()=>[u(" Qty ")]),_:1})])):(n(),_(F,{key:1,label:"Qty",modelValue:l.TSRVF_QTY,"onUpdate:modelValue":[s=>l.TSRVF_QTY=s,s=>q(s,r)],filled:"",dense:"",readonly:i.mode==="view"},null,8,["modelValue","onUpdate:modelValue","readonly"]))]),_:2},1024),i.mode==="view"?(n(),_(m,{key:0},{default:e(()=>[a(c,null,{default:e(()=>[u(" Rp "+f((parseInt(l.TSRVF_PRC)*parseInt(l.TSRVF_QTY)).toLocaleString()),1)]),_:2},1024),a(c,{caption:""},{default:e(()=>[u(" Total Price ")]),_:1})]),_:2},1024)):v("",!0),C.mode!=="view"?(n(),_(m,{key:1,side:""},{default:e(()=>[a(M,{icon:"delete",flat:"",color:"red",onClick:s=>$(r)},null,8,["onClick"])]),_:2},1024)):v("",!0)]),_:2},1024)),[[k]])),128)),C.mode==="view"?V((n(),_(R,{key:1,class:"q-my-sm",clickable:""},{default:e(()=>[a(m),a(m),a(m),a(m,null,{default:e(()=>[a(c,null,{default:e(()=>[y("span",de," Rp "+f(A(d.value)),1)]),_:1}),a(c,{caption:""},{default:e(()=>[u(" Total Price ")]),_:1})]),_:1})]),_:1})),[[k]]):v("",!0)]),_:1})]),_:1}),a(X,{align:"right"},{default:e(()=>[a(M,{label:"OK",color:"primary",onClick:t[1]||(t[1]=l=>U()),disable:T.value,loading:T.value},null,8,["disable","loading"]),a(M,{flat:"",label:"Cancel",color:"red",onClick:Q(h),loading:T.value},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}};export{_e as _};
