import{Q as h}from"./QTooltip.2f758afa.js";import{s as f,o as x,B as m,C as I,D as t,E as e,J as ee,K as P,I as s,P as V,L as le,Q as v,M as q,O as te,aa as ae,aW as B,R as H,H as S,aY as E,aU as F,aV as K,aZ as ie,aX as A,ap as de,S as ue}from"./index.343b0a24.js";import{u as oe,b as G,d as Q,Q as re,k as j,l as y,m as W,a as ce,n as Z,x as _e}from"./use-dialog-plugin-component.f1f2c3ec.js";import{Q as J,a as X}from"./use-cache.ccfd6170.js";import{d as L}from"./date.5cc4549a.js";import{api_web as R}from"./axios.72adc997.js";import{Q as me,a as fe,C as Se}from"./ClosePopup.e46f30d9.js";import{_ as ve}from"./serviceOprUpdateOrder.5be9551f.js";import"./QBadge.92a89230.js";const Ce=s("div",{class:"text-h6"},"Create Item Master",-1),De={class:"row"},Te={class:"col"},pe={class:"col q-pl-md"},Ve={class:"row q-pt-md"},Me={class:"col"},ge={class:"col q-pl-md"},he={class:"row q-pt-md"},Ie={class:"col"},Re={class:"col q-pl-md"},be={class:"row q-pt-md"},we={class:"col"},Oe={__name:"itemCreate",props:{ItemCat:String},setup(Y){const{dialogRef:M,onDialogHide:O,onDialogOK:k,onDialogCancel:U}=oe(),b=G(),n=f({MITM_ITMCD:"",MITM_ITMNM:"",MITM_STKUOM:"",MITM_ITMTYPE:1,MITM_BRAND:"",MITM_MODEL:"",MITM_SPEC:"",MITM_ITMCAT:"",MITM_COACD:"",MITM_ITMCAT:""}),c=f(!1),T=f([]),w=f([]),D=Y;x(()=>{$(),n.value.MITM_ITMCAT=D.ItemCat});const _=(C,d,a,u)=>{d(async()=>{await R.post("item/getListCoasAPI",{search:C}).then(o=>{w.value=o.data})})},N=()=>{b.dialog({title:"Confirmation",message:"Do you want to save this item ?",cancel:!0,persistent:!0}).onOk(async()=>{await R.post("item",n.value).then(C=>{k(C.data.data.value)})})},$=async()=>{c.value=!0,await R.get("item/formAPI").then(C=>{c.value=!1,T.value=C.data.uoms,w.value=C.data.coas}).catch(()=>{c.value=!1})};return(C,d)=>(m(),I(te,{ref_key:"dialogRef",ref:M,onHide:q(O),"transition-show":"slide-up","transition-hide":"slide-down","full-width":"",persistent:""},{default:t(()=>[e(ee,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:t(()=>[e(P,null,{default:t(()=>[Ce]),_:1}),e(P,{class:"q-pa-sm"},{default:t(()=>[s("div",De,[s("div",Te,[e(V,{label:"Item Code",dense:"",modelValue:n.value.MITM_ITMCD,"onUpdate:modelValue":d[0]||(d[0]=a=>n.value.MITM_ITMCD=a),filled:""},null,8,["modelValue"])]),s("div",pe,[e(V,{label:"Item Name",dense:"",modelValue:n.value.MITM_ITMNM,"onUpdate:modelValue":d[1]||(d[1]=a=>n.value.MITM_ITMNM=a),filled:""},null,8,["modelValue"])])]),s("div",Ve,[s("div",Me,[e(Q,{dense:"",filled:"",label:"UOM",modelValue:n.value.MITM_STKUOM,"onUpdate:modelValue":d[2]||(d[2]=a=>n.value.MITM_STKUOM=a),options:T.value,behavior:"dialog","option-label":"MUOM_UOMNM","option-value":"MUOM_UOMCD","emit-value":"","map-options":"",loading:c.value},null,8,["modelValue","options","loading"])]),s("div",ge,[e(V,{label:"Item Brand",dense:"",modelValue:n.value.MITM_BRAND,"onUpdate:modelValue":d[3]||(d[3]=a=>n.value.MITM_BRAND=a),filled:""},null,8,["modelValue"])])]),s("div",he,[s("div",Ie,[e(V,{label:"Item Model",dense:"",modelValue:n.value.MITM_MODEL,"onUpdate:modelValue":d[4]||(d[4]=a=>n.value.MITM_MODEL=a),filled:""},null,8,["modelValue"])]),s("div",Re,[e(V,{label:"Item Specification",dense:"",modelValue:n.value.MITM_SPEC,"onUpdate:modelValue":d[5]||(d[5]=a=>n.value.MITM_SPEC=a),filled:""},null,8,["modelValue"])])]),s("div",be,[s("div",we,[e(Q,{dense:"",filled:"",label:"COA",modelValue:n.value.MITM_COACD,"onUpdate:modelValue":d[6]||(d[6]=a=>n.value.MITM_COACD=a),options:w.value,"use-input":"",behavior:"dialog","option-label":"MCOA_COANM","option-value":"MCOA_COACD",onFilter:d[7]||(d[7]=(a,u,o)=>_(a,u,o)),"emit-value":"","map-options":"",loading:c.value},null,8,["modelValue","options","loading"])])])]),_:1}),e(le,{align:"right"},{default:t(()=>[e(v,{label:"OK",color:"primary",onClick:d[8]||(d[8]=a=>N())}),e(v,{flat:"",label:"Cancel",color:"red",onClick:q(U)},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}},ke=s("div",{class:"text-h6"},"Create Order",-1),ye={style:{border:"1px black solid","border-radius":"10px"}},Ue=s("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[s("b",null,"Header")],-1),Ne={class:"row"},$e={class:"col"},Ae={class:"col q-pl-md"},He={class:"row items-center justify-end"},Qe={class:"row"},Ye={class:"col"},Le={style:{border:"1px black solid","border-radius":"10px",height:"35vh",overflow:"auto"}},Pe=s("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[s("b",null,"Detail Items")],-1),qe={key:0,class:"row q-pb-sm"},Ee={class:"col text-right"},z={__name:"serviceCreateOrder",props:{header:Array,detail:Array,mode:String},setup(Y){const{dialogRef:M,onDialogHide:O,onDialogOK:k,onDialogCancel:U}=oe(),b=G(),n=Y;x(async()=>{n.header&&(await $(),await C(),c.value=n.header,D.value=n.detail)});const c=f({SRVH_DOCNO:"",SRVH_ISSDT:L.formatDate(Date.now(),"YYYY-MM-DD"),SRVH_CUSCD:""}),T=f([]),w=f([]),D=f([]),_=f(!1),N=(l,i,r,g)=>{i(async()=>{g==="cust"&&await $(l),g==="item"&&await C(l)})},$=async l=>{_.value=!0,await R.post("customer/searchAPI",{searchValue:l}).then(i=>{_.value=!1,w.value=i.data.data}).catch(()=>{_.value=!1})},C=async l=>{_.value=!0,await R.post("item/searchAPI",{searchValue:l}).then(i=>{_.value=!1,T.value=i.data.data}).catch(()=>{_.value=!1})},d=()=>{D.value.push({TSRVD_ITMCD:"",TSRVD_LINE:D.value.length+1,TSRVD_QTY:1,TSRVD_CUSTRMK:""})},a=l=>{b.dialog({title:"Confirmation",message:`Do you want to delete this lines no ${l+1} ?`,cancel:!0,persistent:!0}).onOk(async()=>{D.value.splice(l,1)})},u=l=>{b.dialog({component:Oe,componentProps:{ItemCat:"SERVICE_ITEMM"}}).onOk(async i=>{await C(""),D.value[l].TSRVD_ITMCD=i.MITM_ITMNM})},o=()=>{b.dialog({title:"Confirmation",message:"Do you want to submit this data ?",cancel:!0,persistent:!0}).onOk(async()=>{_.value=!0,await R.post("servicesAdmin",{header:c.value,detail:D.value}).then(l=>{_.value=!1,k()})})};return(l,i)=>(m(),I(te,{ref_key:"dialogRef",ref:M,onHide:q(O),"transition-show":"slide-up","transition-hide":"slide-down","full-width":"",persistent:""},{default:t(()=>[e(ee,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:t(()=>[e(P,null,{default:t(()=>[ke]),_:1}),e(P,{class:"q-pa-sm"},{default:t(()=>[s("fieldset",ye,[Ue,s("div",Ne,[s("div",$e,[e(V,{label:"SPK No",readonly:"",dense:"",modelValue:c.value.SRVH_DOCNO,"onUpdate:modelValue":i[0]||(i[0]=r=>c.value.SRVH_DOCNO=r),filled:""},null,8,["modelValue"])]),s("div",Ae,[e(V,{filled:"",modelValue:c.value.SRVH_ISSDT,"onUpdate:modelValue":i[2]||(i[2]=r=>c.value.SRVH_ISSDT=r),dense:"",label:"Issue Date",loading:_.value,onClick:i[3]||(i[3]=r=>l.quotationIssueDate.qDateProxy.show()),mask:"####-##-##","fill-mask":"",hint:"Mask: YYYY-MM-DD",readonly:n.mode==="view"},{append:t(()=>[e(ae,{name:"event",class:"cursor-pointer",disable:n.mode==="view"},{default:t(()=>[e(me,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[e(fe,{modelValue:c.value.SRVH_ISSDT,"onUpdate:modelValue":i[1]||(i[1]=r=>c.value.SRVH_ISSDT=r),mask:"YYYY-MM-DD"},{default:t(()=>[s("div",He,[B(e(v,{label:"Close",color:"primary",flat:""},null,512),[[Se]])])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["disable"])]),_:1},8,["modelValue","loading","readonly"])])]),s("div",Qe,[s("div",Ye,[e(Q,{dense:"",filled:"",label:"Customer Choose",modelValue:c.value.SRVH_CUSCD,"onUpdate:modelValue":i[4]||(i[4]=r=>c.value.SRVH_CUSCD=r),"use-input":"","input-debounce":"500",options:w.value,onFilter:i[5]||(i[5]=(r,g,p)=>N(r,g,p,"cust")),behavior:"dialog","option-label":"MCUS_CUSNM","option-value":"MCUS_CUSCD","emit-value":"","map-options":"",loading:_.value,readonly:n.mode==="view"},null,8,["modelValue","options","loading","readonly"])])])]),s("fieldset",Le,[Pe,n.mode!=="view"?(m(),H("div",qe,[s("div",Ee,[e(v,{flat:"",icon:"add",color:"blue",onClick:i[6]||(i[6]=r=>d())},{default:t(()=>[e(h,null,{default:t(()=>[S("Add lines")]),_:1})]),_:1})])])):E("",!0),e(re,{bordered:"",dense:""},{default:t(()=>[D.value.length>0?(m(!0),H(F,{key:0},K(D.value,(r,g)=>(m(),I(j,{key:g,class:"q-my-sm",dense:""},{default:t(()=>[e(y,{avatar:""},{default:t(()=>[e(ie,{"text-color":"blue"},{default:t(()=>[S(A(g+1),1)]),_:2},1024)]),_:2},1024),e(y,null,{default:t(()=>[e(W,null,{default:t(()=>[e(Q,{dense:"",filled:"",label:"Item Name",modelValue:r.TSRVD_ITMCD,"onUpdate:modelValue":p=>r.TSRVD_ITMCD=p,"use-input":"","input-debounce":"500",options:T.value,onFilter:i[7]||(i[7]=(p,ne,se)=>N(p,ne,se,"item")),behavior:"dialog","option-label":"MITM_ITMNM","option-value":"MITM_ITMNM","emit-value":"","map-options":"",loading:_.value},null,8,["modelValue","onUpdate:modelValue","options","loading"])]),_:2},1024)]),_:2},1024),e(y,null,{default:t(()=>[e(V,{label:"Qty",filled:"",dense:"",modelValue:r.TSRVD_QTY,"onUpdate:modelValue":p=>r.TSRVD_QTY=p},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(y,null,{default:t(()=>[e(V,{label:"Problem",filled:"",dense:"",modelValue:r.TSRVD_CUSTRMK,"onUpdate:modelValue":p=>r.TSRVD_CUSTRMK=p},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n.mode!=="view"?(m(),I(y,{key:0,side:""},{default:t(()=>[e(v,{icon:"delete",color:"red",flat:"",onClick:p=>a(g)},{default:t(()=>[e(h,null,{default:t(()=>[S("Delete line")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):E("",!0),n.mode!=="view"?(m(),I(y,{key:1,side:""},{default:t(()=>[e(v,{icon:"library_add",color:"indigo",flat:"",onClick:p=>u(g)},{default:t(()=>[e(h,null,{default:t(()=>[S("Add new item")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):E("",!0)]),_:2},1024))),128)):B((m(),I(j,{key:1,class:"q-my-sm",clickable:""},{default:t(()=>[e(y,null,{default:t(()=>[e(W,null,{default:t(()=>[S(" No Items Added ")]),_:1})]),_:1})]),_:1})),[[de]])]),_:1})])]),_:1}),e(le,{align:"right"},{default:t(()=>[e(v,{label:"OK",color:"primary",onClick:i[8]||(i[8]=r=>o()),disable:_.value,loading:_.value},null,8,["disable","loading"]),e(v,{flat:"",label:"Cancel",color:"red",onClick:q(U),loading:_.value},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}};const Fe={class:"q-pa-md"},Ke={class:"row q-pb-md"},xe=s("div",{class:"col"},[s("span",{class:"text-h4"},"Receive Order ")],-1),Ge={class:"col text-right"},Be={class:"row q-pt-md"},je={class:"col"},We={key:1},nl={__name:"serviceView",setup(Y){const M=G(),O=f("SRVH_DOCNO"),k=f(""),U=f([]),b=f([{name:"SRVH_DOCNO",label:"SPK No",field:"SRVH_DOCNO",sortable:!0,align:"left"},{name:"MCUS_CUSNM",label:"Cust",field:"MCUS_CUSNM",sortable:!0,align:"left"},{name:"STAT",label:"Status",field:a=>d(a),sortable:!0,align:"left"},{name:"created_at",label:"Created Date",field:"created_at",sortable:!0,align:"left",format:a=>L.formatDate(new Date(a),"DD MMM YYYY")}]),n=f(!1),c=f(null);x(()=>{T(),c.value=setInterval(()=>{T()},1e4)});const T=async()=>{n.value=!0,await R.post("servicesAdmin/search",{searchBy:O.value,searchValue:k.value}).then(a=>{n.value=!1,U.value=a.data.data}).catch(a=>{n.value=!1})},w=()=>{M.dialog({component:z}).onOk(async a=>{T()})},D=a=>{const u={SRVH_DOCNO:a.SRVH_DOCNO,SRVH_ISSDT:L.formatDate(a.SRVH_ISSDT,"YYYY-MM-DD"),SRVH_CUSCD:a.MCUS_CUSCD};let o=[];a.detail.map(l=>{o.push({TSRVD_ITMCD:l.TSRVD_ITMCD,TSRVD_LINE:l.TSRVD_LINE,TSRVD_QTY:l.TSRVD_QTY,TSRVD_CUSTRMK:l.TSRVD_CUSTRMK,TSRVD_REMARK:l.TSRVD_REMARK,TSRVD_FLGSTS:l.TSRVD_FLGSTS,listFixDet:l.list_fix_det})}),M.dialog({component:ve,componentProps:{header:u,detail:o,mode:"view"}}).onOk(async l=>{T()})},_=a=>{window.open("https://joss.jatpowerindo.co.id/servicesAdmin/printInvoice/"+btoa(a),"_blank").focus()},N=a=>{const u={SRVH_DOCNO:a.SRVH_DOCNO,SRVH_ISSDT:L.formatDate(a.SRVH_ISSDT,"YYYY-MM-DD"),SRVH_CUSCD:a.MCUS_CUSCD};let o=[];a.detail.map(l=>{o.push({TSRVD_ITMCD:l.TSRVD_ITMCD,TSRVD_LINE:l.TSRVD_LINE,TSRVD_QTY:l.TSRVD_QTY,TSRVD_CUSTRMK:l.TSRVD_CUSTRMK})}),M.dialog({component:z,componentProps:{header:u,detail:o}}).onOk(async l=>{T()})},$=a=>{M.dialog({title:"Confirmation",message:"Do you want to proceed to service ?",cancel:!0,persistent:!0}).onOk(async()=>{n.value=!0,await R.put(`servicesAdmin/${btoa(a.SRVH_DOCNO)}`,{TSRVD_FLGSTS:2}).then(u=>{n.value=!1}).catch(u=>{n.value=!1})})},C=a=>{M.dialog({title:"Confirmation",message:"Are you sure want to delete this order ?",cancel:!0,persistent:!0}).onOk(async()=>{n.value=!0,await R.delete(`servicesAdmin/${btoa(a.SRVH_DOCNO)}`).then(u=>{n.value=!1}).catch(u=>{n.value=!1})})},d=a=>{const u=a.detail.filter(l=>l.TSRVD_FLGSTS===0),o=a.detail.filter(l=>l.TSRVD_FLGSTS===1);if(a.detail.filter(l=>l.TSRVD_FLGSTS===2),u.length==a.detail.length)return"On Draft";if(o.length>0&&o.length<=a.detail.length)return"On Checking Price";if(o.length>0&&o.length==a.detail.length)return"Checking Price Done, Waiting Cust Confirmation"};return(a,u)=>(m(),H("div",Fe,[s("div",Ke,[xe,s("div",Ge,[e(v,{icon:"add",color:"blue",onClick:w},{default:t(()=>[e(h,null,{default:t(()=>[S("Create New Order")]),_:1})]),_:1})])]),e(ue),s("div",Be,[s("div",je,[e(ce,{title:"Created Order",rows:U.value,columns:b.value,"row-key":"name",loading:n.value,dense:"",pagination:{rowsPerPage:20},class:"my-sticky-header-column-table"},{"top-right":t(()=>[e(Q,{outlined:"",modelValue:O.value,"onUpdate:modelValue":u[0]||(u[0]=o=>O.value=o),options:b.value,label:"Search Columns","option-value":"name","option-label":"label","emit-value":"",dense:"","map-options":""},null,8,["modelValue","options"]),e(V,{borderless:"",dense:"",modelValue:k.value,"onUpdate:modelValue":[u[1]||(u[1]=o=>k.value=o),u[2]||(u[2]=o=>a.dataQuo())],placeholder:"Search",outlined:"",debounce:"1000"},{append:t(()=>[e(ae,{name:"search"})]),_:1},8,["modelValue"])]),header:t(o=>[e(J,{props:o},{default:t(()=>[(m(!0),H(F,null,K(o.cols,l=>(m(),I(Z,{key:l.name,props:o},{default:t(()=>[S(A(l.label),1)]),_:2},1032,["props"]))),128)),e(Z,{"auto-width":""},{default:t(()=>[S("Action")]),_:1})]),_:2},1032,["props"])]),body:t(o=>[e(J,{props:o},{default:t(()=>[(m(!0),H(F,null,K(o.cols,l=>(m(),I(X,{key:l.name,props:o},{default:t(()=>[l.name==="STAT"?(m(),I(_e,{key:0,clickable:"",color:"primary","text-color":"white",icon:"event"},{default:t(()=>[S(A(l.value),1)]),_:2},1024)):(m(),H("span",We,A(l.value),1))]),_:2},1032,["props"]))),128)),e(X,{"auto-width":""},{default:t(()=>[e(v,{flat:"",color:"orange",icon:"edit",onClick:l=>N(o.row),dense:"",disable:o.row.detail.filter(l=>l.TSRVD_FLGSTS>0).length>0},{default:t(()=>[e(h,null,{default:t(()=>[S("Edit this Order")]),_:1})]),_:2},1032,["onClick","disable"]),e(v,{flat:"",color:"indigo",icon:"print",onClick:l=>_(o.row.SRVH_DOCNO),dense:"",disable:o.row.detail.filter(l=>l.TSRVD_FLGSTS>0).length!==o.row.detail.length},{default:t(()=>[e(h,null,{default:t(()=>[S("Print this order")]),_:1})]),_:2},1032,["onClick","disable"]),e(v,{flat:"",color:"red",icon:"delete",onClick:l=>C(o.row.SRVH_DOCNO),dense:"",disable:o.row.detail.filter(l=>l.TSRVD_FLGSTS>0).length>0},{default:t(()=>[e(h,null,{default:t(()=>[S(A(o.row.detail.filter(l=>l.TSRVD_FLGSTS>0).length>0?"Cannot delete processed order":"Delete this Order"),1)]),_:2},1024)]),_:2},1032,["onClick","disable"]),e(v,{flat:"",color:"cyan",icon:"visibility",onClick:l=>D(o.row),dense:"",disable:o.row.detail.filter(l=>l.TSRVD_FLGSTS>0).length===0},{default:t(()=>[e(h,null,{default:t(()=>[S("View this Order")]),_:1})]),_:2},1032,["onClick","disable"]),e(v,{flat:"",color:"indigo",icon:"check",onClick:l=>$(o.row.SRVH_DOCNO),dense:"",disable:o.row.detail.filter(l=>l.TSRVD_FLGSTS===1).length===0||o.row.detail.filter(l=>l.TSRVD_FLGSTS>=2).length>0},{default:t(()=>[e(h,null,{default:t(()=>[S(A(o.row.detail.filter(l=>l.TSRVD_FLGSTS>0).length!==o.row.detail.length?"Please wait until all item checked":"Proceed to service"),1)]),_:2},1024)]),_:2},1032,["onClick","disable"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])])])]))}};export{nl as default};
