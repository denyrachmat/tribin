import{t as p,o as F,C as _,D as I,E as t,F as e,M as z,O as q,J as n,$ as P,R,S as k,T as M,a0 as W,aZ as X,X as Z,Q as w,Y as A,Z as G,aI as J,av as j,I as g,P as E}from"./index.b0f1ad0e.js";import{Q as V}from"./QSelect.e4d42960.js";import{Q as ee,a as N}from"./QTable.ad994ee0.js";import{Q as x,a as U}from"./QTd.04620a1c.js";import{Q as B}from"./QTooltip.e2263133.js";import{api_web as y}from"./axios.2033dc9c.js";import{u as Y}from"./use-quasar.a3a73e34.js";import{Q as ae,a as le}from"./QInnerLoading.bb04fc4d.js";import{u as oe}from"./use-dialog-plugin-component.591c7231.js";import"./QItemLabel.c4a762ca.js";import"./format.c3aeefc4.js";import"./QList.fdeab013.js";const te=n("div",{class:"text-h6"},"Request Part",-1),ne={style:{border:"1px black solid","border-radius":"10px"}},se=n("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[n("b",null,"Header")],-1),ie={class:"row q-col-gutter-md"},de={class:"col-12"},re={style:{border:"1px black solid","border-radius":"10px",height:"35vh",overflow:"auto"}},ue=n("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[n("b",null,"List Of Items")],-1),ce={class:"col-12 col-sm-3"},me={class:"col-12 col-sm-3"},pe={class:"col-12 col-sm-3"},Ce={class:"col-12 col-sm-2"},_e={class:"col-12 col-sm-1"},fe={__name:"transferRequestPreview",props:{dataHeader:Array,dataDet:Array,qtyOnly:Boolean},setup(S){const h=Y(),O=S,T=p({TLOCREQ_DOCNO:"",TLOCREQ_FRLOC:"",TLOCREQ_TOLOC:""}),m=p([]),f=p([]),C=p([]),d=p(!1);F(async()=>{console.log(O),await r(""),await c(""),T.value=O.dataHeader,O.dataDet.map(o=>{C.value.push({...o,TLOCREQ_QTY:u(o.TLOCREQ_ITMCD).STOCK>=o.TLOCREQ_QTY?o.TLOCREQ_QTY:u(o.TLOCREQ_ITMCD).STOCK,IS_STOCK_EX:u(o.TLOCREQ_ITMCD).STOCK>=o.TLOCREQ_QTY})})});const D=()=>{let o=[];return C.value.map(l=>{u(l.TLOCREQ_ITMCD).STOCK<l.TLOCREQ_QTY&&o.push(l)}),o.length>0},v=(o,l,s,b)=>{l(async()=>{b==="loc"&&await r(o),b==="item"&&await c(o)})},r=async(o,l="MSUP_SUPNM")=>{d.value=!0,await y.post("location/searchAPI",{searchBy:l,searchValue:o}).then(s=>{d.value=!1,f.value=s.data.data}).catch(s=>{d.value=!1})},c=async o=>{d.value=!0,await y.post("item/searchAPITBL",{searchValue:o}).then(l=>{d.value=!1,m.value=l.data.data}).catch(()=>{d.value=!1})},a=()=>{h.dialog({title:"Confirmation",message:"Are you sure want to send this request ?",cancel:!0,persistent:!0}).onOk(async()=>{d.value=!0,console.log(C.value)})},u=o=>m.value.filter(l=>l.MITM_ITMCD==o)[0],{dialogRef:$,onDialogHide:K,onDialogOK:Le,onDialogCancel:H}=oe();return(o,l)=>(_(),I(G,{ref_key:"dialogRef",ref:$,onHide:A(K),"transition-show":"slide-up","transition-hide":"slide-down","full-width":"",persistent:""},{default:t(()=>[e(z,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:t(()=>[e(q,null,{default:t(()=>[te]),_:1}),e(q,{class:"q-pa-sm"},{default:t(()=>[n("fieldset",ne,[se,e(ae,{showing:d.value,dark:""},{default:t(()=>[e(le,{size:"50px",color:"primary"})]),_:1},8,["showing"]),n("div",ie,[n("div",de,[e(P,{label:"Doc No",dense:"",filled:"",modelValue:T.value.TLOCREQ_DOCNO,"onUpdate:modelValue":l[0]||(l[0]=s=>T.value.TLOCREQ_DOCNO=s),readonly:!0},null,8,["modelValue"])])])]),n("fieldset",re,[ue,C.value.length>0?(_(!0),R(k,{key:0},M(C.value,(s,b)=>(_(),R("div",{class:"row q-col-gutter-md q-pt-md",key:b,style:{"font-size":"10px"}},[n("div",ce,[e(V,{dense:"",filled:"",label:"Item Name",modelValue:s.TLOCREQ_ITMCD,"onUpdate:modelValue":i=>s.TLOCREQ_ITMCD=i,"use-input":"","input-debounce":"500",options:m.value,onFilter:l[1]||(l[1]=(i,Q,L)=>v(i,Q,L,"item")),behavior:"dialog","option-label":"MITM_ITMNM","option-value":"MITM_ITMCD","emit-value":"","map-options":"",loading:d.value,readonly:!0,"input-style":"font-size:11px"},null,8,["modelValue","onUpdate:modelValue","options","loading"])]),n("div",me,[e(V,{dense:"",filled:"",label:"Transfer From",modelValue:s.TLOCREQ_FRLOC,"onUpdate:modelValue":i=>s.TLOCREQ_FRLOC=i,"use-input":"","input-debounce":"500",options:f.value,onFilter:l[2]||(l[2]=(i,Q,L)=>v(i,Q,L,"loc")),behavior:"dialog","option-label":"MLOC_LOCNM","option-value":"MLOC_LOCCD","emit-value":"","map-options":"",loading:d.value,readonly:!0},null,8,["modelValue","onUpdate:modelValue","options","loading"])]),n("div",pe,[e(V,{dense:"",filled:"",label:"Transfer To",modelValue:s.TLOCREQ_TOLOC,"onUpdate:modelValue":i=>s.TLOCREQ_TOLOC=i,"use-input":"","input-debounce":"500",options:f.value,onFilter:l[3]||(l[3]=(i,Q,L)=>v(i,Q,L,"loc")),behavior:"dialog","option-label":"MLOC_LOCNM","option-value":"MLOC_LOCCD","emit-value":"","map-options":"",loading:d.value,readonly:!0},null,8,["modelValue","onUpdate:modelValue","options","loading"])]),n("div",Ce,[e(P,{label:"Qty",dense:"",filled:"",modelValue:s.TLOCREQ_QTY,"onUpdate:modelValue":i=>s.TLOCREQ_QTY=i,rules:[i=>i<=u(s.TLOCREQ_ITMCD).STOCK||`Stock is less than needed, stock only ${u(s.TLOCREQ_ITMCD).STOCK}`]},null,8,["modelValue","onUpdate:modelValue","rules"])]),n("div",_e,[e(W,{modelValue:s.TLOCREQ_ISREP,"onUpdate:modelValue":i=>s.TLOCREQ_ISREP=i,label:"Is replacement ?",color:"teal","true-value":1,"false-value":0,disable:!0},null,8,["modelValue","onUpdate:modelValue"])])]))),128)):X("",!0)])]),_:1}),e(Z,{align:"right"},{default:t(()=>[e(w,{label:"approve",color:"primary",onClick:l[4]||(l[4]=s=>a()),loading:d.value,disable:D()},null,8,["loading","disable"]),e(w,{flat:"",label:"Cancel",color:"red",onClick:A(H)},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}},Oe={class:"q-pa-md"},Te=n("div",{class:"row q-pb-md"},[n("div",{class:"col"},[n("span",{class:"text-h4"},"Transfer Request")]),n("div",{class:"col text-right"})],-1),ve={class:"row q-pt-md"},Qe={class:"col"},Me={__name:"transferRequestIndex",setup(S){const h=Y(),O=p([]),T=p([{name:"TLOCREQ_DOCNO",label:"Doc Np",field:"TLOCREQ_DOCNO",sortable:!0,align:"left"},{name:"TLOCREQ_FRLOC",label:"From Location",field:"TLOCREQ_FRLOC",sortable:!0,align:"left"},{name:"TLOCREQ_TOLOC",label:"To Location",field:"TLOCREQ_TOLOC",sortable:!0,align:"left"},{name:"TLOCREQ_ISREP",label:"Is Replacement ?",field:"TLOCREQ_ISREP",sortable:!0,format:r=>`${r==1?"Yes":"No"}`,align:"left"}]),m=p(!1),f=p(""),C=p("");F(()=>{d()});const d=async()=>{m.value=!0,await y.post("inventory/transferRequest/searchAPI",{searchBy:f.value,searchValue:C.value}).then(r=>{m.value=!1,O.value=r.data.data}).catch(r=>{m.value=!1})},D=r=>{h.dialog({component:fe,componentProps:{dataHeader:r,dataDet:r.detail}}).onOk(async c=>{m.value=!1,onDialogOK()})},v=r=>{h.dialog({title:"Confirmation",message:"Are you sure want to print this transfer ?",cancel:!0,persistent:!0}).onOk(async()=>{m.value=!0,await y.post("inventory/printHandoverPDF",{data:btoa(r)}).then(c=>{m.value=!1,window.open("").document.write("<iframe width='100%' height='100%' src='data:application/pdf;base64, "+encodeURI(c.data)+"'></iframe>")}).catch(c=>{m.value=!1})})};return(r,c)=>(_(),R("div",Oe,[Te,e(J),n("div",ve,[n("div",Qe,[e(ee,{title:"Transfer Request List",rows:O.value,columns:T.value,"row-key":"TDLVORD_DLVCD",loading:m.value,dense:"",pagination:{rowsPerPage:20},class:"my-sticky-header-column-table"},{"top-right":t(()=>[e(V,{outlined:"",modelValue:f.value,"onUpdate:modelValue":c[0]||(c[0]=a=>f.value=a),options:T.value,label:"Search Columns","option-value":"name","option-label":"label","emit-value":"",dense:"","map-options":""},null,8,["modelValue","options"]),e(P,{borderless:"",dense:"",modelValue:C.value,"onUpdate:modelValue":[c[1]||(c[1]=a=>C.value=a),c[2]||(c[2]=a=>r.getOutgoingData())],placeholder:"Search",outlined:"",debounce:"1000"},{append:t(()=>[e(j,{name:"search"})]),_:1},8,["modelValue"])]),header:t(a=>[e(x,{props:a},{default:t(()=>[(_(!0),R(k,null,M(a.cols,u=>(_(),I(N,{key:u.name,props:a},{default:t(()=>[g(E(u.label),1)]),_:2},1032,["props"]))),128)),e(N,{"auto-width":""},{default:t(()=>[g("Action")]),_:1})]),_:2},1032,["props"])]),body:t(a=>[e(x,{props:a},{default:t(()=>[(_(!0),R(k,null,M(a.cols,u=>(_(),I(U,{key:u.name,props:a},{default:t(()=>[g(E(u.value),1)]),_:2},1032,["props"]))),128)),e(U,{"auto-width":""},{default:t(()=>[e(w,{flat:"",color:a.row.TLOCREQ_APPRVBY!==null?"grey":"indigo",icon:"done_all",onClick:u=>D(a.row),dense:"",disable:a.row.TLOCREQ_APPRVBY!==null},{default:t(()=>[e(B,null,{default:t(()=>[g(E(a.row.TLOCREQ_APPRVBY!==null?"Request has been approved":"Approve All Data"),1)]),_:2},1024)]),_:2},1032,["color","onClick","disable"]),e(w,{flat:"",color:a.row.TLOCREQ_APPRVBY!==null?"cyan":"grey",icon:"print",onClick:u=>v(a.row.TLOCREQ_DOCNO),dense:"",disable:a.row.TLOCREQ_APPRVBY===null},{default:t(()=>[e(B,null,{default:t(()=>[g(E(a.row.TLOCREQ_APPRVBY===null?"Please Aprove first":"Print handover request"),1)]),_:2},1024)]),_:2},1032,["color","onClick","disable"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])])])]))}};export{Me as default};
