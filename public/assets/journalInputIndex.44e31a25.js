import{t as C,o as $,C as v,D as O,E as o,F as e,M as N,O as k,J as l,$ as I,at as P,U as K,Q as f,R as S,S as G,T as V,P as y,X,Y as E,Z,aM as z,I as D}from"./index.32b7eccc.js";import{e as R}from"./QSelect.759acdbd.js";import{u as W,a as ee,b as M}from"./QTable.863f02b2.js";import{Q,a as U}from"./QTd.4d40aaf5.js";import{Q as F}from"./QTooltip.af0672cb.js";import{u as q}from"./format.80f43069.js";import{api_web as L}from"./axios.2eed2313.js";import{Q as le,a as ae,C as oe}from"./ClosePopup.98d3d3f1.js";import{Q as te}from"./QBtnToggle.a3059f03.js";import"./use-render-cache.3aae9b27.js";import"./date.470912c1.js";import"./QBtnGroup.8b0eed83.js";const se=l("div",{class:"text-h6"},"Closing Period",-1),ne={style:{border:"1px black solid","border-radius":"10px"}},de=l("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[l("b",null,"Header")],-1),ie={class:"row q-col-gutter-sm q-pt-sm"},ue={class:"col-12 col-sm-6"},re={class:"col-12 col-sm-6"},ce={class:"row items-center justify-end"},me={style:{border:"1px black solid","border-radius":"10px"}},_e=l("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[l("b",null,"Detail")],-1),pe={class:"row q-col-gutter-sm q-pt-sm"},Ce={class:"col-12 col-sm-12 text-right"},ve={class:"col-12 col-sm-3"},fe={class:"col-12 col-sm-2"},Te={class:"col-12 col-sm-2"},ge={class:"col-12 col-sm-2"},he={class:"col-12 col-sm-2"},Ie={class:"col-12 col-sm-1"},Se={key:1,class:"row q-col-gutter-sm q-pt-sm"},be={class:"col-12 text-center"},De={__name:"journalInputCreate",props:{header:String},setup(w){const g=q(),t=C({GLHIST_DOC:"",GLHIST_EFFDT:"",MCOA_TYPE:"INC"}),m=C([]),_=C(!1),h=C([]),u=w;$(async()=>{u.header&&u.header!==""&&(await s(""),t.value.GLHIST_DOC=u.header.GLHIST_DOC,t.value.GLHIST_EFFDT=u.header.GLHIST_EFFDT,t.value.MCOA_TYPE=u.header.MCOA_TYPE,m.value=u.header.det)});const{dialogRef:b,onDialogHide:A,onDialogOK:H,onDialogCancel:r}=W(),d=(c,n,a,T)=>{n(async()=>{T==="coa"&&await s(c)})},s=async(c,n="MCOA_COACD")=>{_.value=!0,await L.post("coa/searchAPI",{searchValue:c,searchCol:n}).then(a=>{_.value=!1,h.value=a.data.data}).catch(()=>{_.value=!1})},p=()=>{m.value.push({GLHIST_ACC:t.value.GLHIST_ACC,GLHIST_DOC:t.value.GLHIST_DOC,GLHIST_AMT:0,GLHIST_DESC:"",GLHIST_EFFDT:t.value.GLHIST_EFFDT,MCOA_TYPE:"INC"})},x=c=>{g.dialog({title:"Confirmation",message:`Do you want to delete this lines no ${c+1} ?`,cancel:!0,persistent:!0}).onOk(async()=>{m.value.splice(c,1)})},Y=(c,n)=>{let a=h.value.filter(T=>T.MCOA_COACD===c);a.length>0&&(m.value[n].GLHIST_CURR=a[0].MCOA_CURR,m.value[n].MCOA_TYPE=a[0].MCOA_TYPE)},j=()=>{g.dialog({title:"Confirmation",message:"Are you sure want to save this journal ?",cancel:!0,persistent:!0}).onOk(async()=>{_.value=!0,await L.post(`${t.value.GLHIST_DOC?`acc/journal/${btoa(t.value.GLHIST_DOC)}`:"acc/journal"}`,{...t.value,det:m.value}).then(c=>{_.value=!1,g.notify({color:"green",message:`${c.data.msg}`}),H()}).catch(c=>{_.value=!1})})};return(c,n)=>(v(),O(Z,{ref_key:"dialogRef",ref:b,onHide:E(A),"transition-show":"slide-up","transition-hide":"slide-down","full-width":""},{default:o(()=>[e(N,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:o(()=>[e(k,null,{default:o(()=>[se]),_:1}),e(k,{class:"q-pa-sm"},{default:o(()=>[l("fieldset",ne,[de,l("div",ie,[l("div",ue,[e(I,{filled:"",label:"Doc Reference",modelValue:t.value.GLHIST_DOC,"onUpdate:modelValue":n[0]||(n[0]=a=>t.value.GLHIST_DOC=a),readonly:"",dense:""},null,8,["modelValue"])]),l("div",re,[e(I,{filled:"",modelValue:t.value.GLHIST_EFFDT,"onUpdate:modelValue":n[2]||(n[2]=a=>t.value.GLHIST_EFFDT=a),label:"Eff Date",dense:""},{prepend:o(()=>[e(P,{name:"event",class:"cursor-pointer"},{default:o(()=>[e(le,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:o(()=>[e(ae,{modelValue:t.value.GLHIST_EFFDT,"onUpdate:modelValue":n[1]||(n[1]=a=>t.value.GLHIST_EFFDT=a),mask:"YYYY-MM-DD"},{default:o(()=>[l("div",ce,[K(e(f,{label:"Close",color:"primary",flat:""},null,512),[[oe]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])])]),l("fieldset",me,[_e,l("div",pe,[l("div",Ce,[e(f,{flat:"",color:"primary",icon:"add",onClick:p})])]),m.value.length>0?(v(!0),S(G,{key:0},V(m.value,(a,T)=>(v(),S("div",{class:"row q-col-gutter-sm q-pt-sm",key:T},[l("div",ve,[e(te,{modelValue:a.MCOA_TYPE,"onUpdate:modelValue":i=>a.MCOA_TYPE=i,spread:"",class:"my-custom-toggle","no-caps":"",rounded:"",unelevated:"","toggle-color":"primary",color:"white","text-color":"primary",options:[{label:"Income",value:"INC"},{label:"Expense",value:"OUT"}],disable:t.value.GLHIST_DOC!==""},null,8,["modelValue","onUpdate:modelValue","disable"])]),l("div",fe,[e(R,{filled:"",label:"Account Code",modelValue:a.GLHIST_ACC,"onUpdate:modelValue":[i=>a.GLHIST_ACC=i,i=>Y(i,T)],"use-input":"","input-debounce":"500",options:h.value,onFilter:n[3]||(n[3]=(i,B,J)=>d(i,B,J,"coa")),behavior:"dialog","option-label":"MCOA_COANM","option-value":"MCOA_COACD","emit-value":"","map-options":"",loading:_.value,dense:""},null,8,["modelValue","onUpdate:modelValue","options","loading"])]),l("div",Te,[e(I,{filled:"",label:"Valuta",modelValue:a.GLHIST_CURR,"onUpdate:modelValue":i=>a.GLHIST_CURR=i,dense:""},null,8,["modelValue","onUpdate:modelValue"])]),l("div",ge,[e(I,{filled:"",label:"Description",modelValue:a.GLHIST_DESC,"onUpdate:modelValue":i=>a.GLHIST_DESC=i,dense:""},null,8,["modelValue","onUpdate:modelValue"])]),l("div",he,[e(I,{filled:"",label:"Amount",modelValue:a.GLHIST_AMT,"onUpdate:modelValue":i=>a.GLHIST_AMT=i,dense:""},null,8,["modelValue","onUpdate:modelValue"])]),l("div",Ie,[e(f,{icon:"delete",onClick:i=>x(T),flat:"",color:"red"},null,8,["onClick"])])]))),128)):(v(),S("div",Se,[l("div",be," Click + button to add "+y(t.value.MCOA_TYPE==="INC"?"Income":"Expense"),1)]))])]),_:1}),e(X,{align:"right"},{default:o(()=>[e(f,{label:"OK",color:"primary",onClick:n[4]||(n[4]=a=>j()),disable:c.stateSubmit,loading:_.value},null,8,["disable","loading"]),e(f,{flat:"",label:"Cancel",color:"red",onClick:E(r)},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}},He={class:"q-pa-md"},Le={class:"row q-pb-md"},Ae=l("div",{class:"col"},[l("span",{class:"text-h4"},"Journal Input")],-1),Oe={class:"col text-right"},Ge={class:"row q-pt-md"},Ve={class:"col"},xe={__name:"journalInputIndex",setup(w){const g=q(),t=C("GLHIST_DOC"),m=C(""),_=C([]),h=C([{name:"GLHIST_DOC",label:"Journal Doc",field:"GLHIST_DOC",sortable:!0,align:"left"},{name:"GLHIST_CURR",label:"Valuta",field:"GLHIST_CURR",sortable:!0,align:"left"},{name:"GLHIST_AMT_DB",label:"Debit",field:"GLHIST_AMT_DB",sortable:!0,format:r=>r.toLocaleString(),align:"left"},{name:"GLHIST_AMT_CR",label:"Credit",field:"GLHIST_AMT_CR",sortable:!0,format:r=>r.toLocaleString(),align:"left"}]),u=C(!1);$(()=>{b()});const b=async()=>{u.value=!0,await L.post("acc/journal/searchAPI",{searchBy:t.value,searchValue:m.value}).then(r=>{u.value=!1,_.value=r.data.data}).catch(r=>{u.value=!1})},A=r=>{g.dialog({title:"Confirmation",message:"Are you sure want to delete this journal doc ?",cancel:!0,persistent:!0}).onOk(async()=>{L.delete(`acc/journal/${btoa(r)}`).then(d=>{u.value=!1,_.value=d.data.data}).catch(d=>{u.value=!1})})},H=(r=null)=>{g.dialog({component:De,componentProps:{header:r}}).onOk(async d=>{b()})};return(r,d)=>(v(),S("div",He,[l("div",Le,[Ae,l("div",Oe,[e(f,{icon:"add",color:"primary",onClick:d[0]||(d[0]=s=>H())})])]),e(z),l("div",Ge,[l("div",Ve,[e(ee,{title:"Journal History",rows:_.value,columns:h.value,"row-key":"name",loading:u.value,dense:"",pagination:{rowsPerPage:20},class:"my-sticky-header-column-table"},{"top-right":o(()=>[e(R,{outlined:"",modelValue:t.value,"onUpdate:modelValue":d[1]||(d[1]=s=>t.value=s),options:h.value,label:"Search Columns","option-value":"name","option-label":"label","emit-value":"",dense:"","map-options":""},null,8,["modelValue","options"]),e(I,{borderless:"",dense:"",modelValue:m.value,"onUpdate:modelValue":[d[2]||(d[2]=s=>m.value=s),d[3]||(d[3]=s=>b())],placeholder:"Search",outlined:"",debounce:"1000"},{append:o(()=>[e(P,{name:"search"})]),_:1},8,["modelValue"])]),header:o(s=>[e(Q,{props:s},{default:o(()=>[e(M,{"auto-width":""},{default:o(()=>[D("Action")]),_:1}),(v(!0),S(G,null,V(s.cols,p=>(v(),O(M,{key:p.name,props:s},{default:o(()=>[D(y(p.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:o(s=>[e(Q,{props:s},{default:o(()=>[e(U,{"auto-width":""},{default:o(()=>[e(f,{flat:"",color:"orange",icon:"edit",onClick:p=>H(s.row),dense:""},{default:o(()=>[e(F,null,{default:o(()=>[D("Journal Edit")]),_:1})]),_:2},1032,["onClick"]),e(f,{flat:"",color:"red",icon:"delete",onClick:p=>A(s.row.GLHIST_DOC),dense:""},{default:o(()=>[e(F,null,{default:o(()=>[D("Journal Delete")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),(v(!0),S(G,null,V(s.cols,p=>(v(),O(U,{key:p.name,props:s},{default:o(()=>[D(y(p.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])])])]))}};export{xe as default};
