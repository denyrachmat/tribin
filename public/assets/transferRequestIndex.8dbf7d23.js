import{t as m,o as F,C,D as I,E as l,F as a,M as K,O as q,J as o,$ as P,R,S as k,T as M,a0 as z,aZ as W,X,Q as V,Y as A,Z,aI as G,av as J,I as g,P as w}from"./index.62c0d4c8.js";import{Q as y}from"./QSelect.435b2bf7.js";import{Q as j,a as N}from"./QTable.4edcb5da.js";import{Q as x,a as U}from"./QTd.ebbbba80.js";import{Q as B}from"./QTooltip.52e448e2.js";import{api_web as D}from"./axios.f1a12e89.js";import{u as Y}from"./use-quasar.a6eae17d.js";import{Q as ee,a as ae}from"./QInnerLoading.1d6b1417.js";import{u as le}from"./use-dialog-plugin-component.af617c24.js";import"./QItemLabel.c7c69077.js";import"./format.3f8125ff.js";import"./QList.a3a96362.js";const oe=o("div",{class:"text-h6"},"Request Part",-1),te={style:{border:"1px black solid","border-radius":"10px"}},ne=o("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[o("b",null,"Header")],-1),se={class:"row q-col-gutter-md"},ie={class:"col-12"},re={style:{border:"1px black solid","border-radius":"10px",height:"35vh",overflow:"auto"}},de=o("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[o("b",null,"List Of Items")],-1),ue={class:"col-12 col-sm-3"},ce={class:"col-12 col-sm-3"},me={class:"col-12 col-sm-3"},pe={class:"col-12 col-sm-2"},Ce={class:"col-12 col-sm-1"},_e={__name:"transferRequestPreview",props:{dataHeader:Array,dataDet:Array,qtyOnly:Boolean},setup(S){const h=Y(),O=S,T=m({TLOCREQ_DOCNO:"",TLOCREQ_FRLOC:"",TLOCREQ_TOLOC:""}),u=m([]),_=m([]),f=m([]),r=m(!1);F(async()=>{console.log(O),await b(""),await d(""),T.value=O.dataHeader,O.dataDet.map(s=>{f.value.push({...s,TLOCREQ_QTY:e(s.TLOCREQ_ITMCD).STOCK>=s.TLOCREQ_QTY?s.TLOCREQ_QTY:e(s.TLOCREQ_ITMCD).STOCK,IS_STOCK_EX:e(s.TLOCREQ_ITMCD).STOCK>=s.TLOCREQ_QTY})})});const v=(s,n,t,E)=>{n(async()=>{E==="loc"&&await b(s),E==="item"&&await d(s)})},b=async(s,n="MSUP_SUPNM")=>{r.value=!0,await D.post("location/searchAPI",{searchBy:n,searchValue:s}).then(t=>{r.value=!1,_.value=t.data.data}).catch(t=>{r.value=!1})},d=async s=>{r.value=!0,await D.post("item/searchAPITBL",{searchValue:s}).then(n=>{r.value=!1,u.value=n.data.data}).catch(()=>{r.value=!1})},c=()=>{h.dialog({title:"Confirmation",message:"Are you sure want to send this request ?",cancel:!0,persistent:!0}).onOk(async()=>{r.value=!0})},e=s=>u.value.filter(n=>n.MITM_ITMCD==s)[0],{dialogRef:p,onDialogHide:$,onDialogOK:Qe,onDialogCancel:H}=le();return(s,n)=>(C(),I(Z,{ref_key:"dialogRef",ref:p,onHide:A($),"transition-show":"slide-up","transition-hide":"slide-down","full-width":"",persistent:""},{default:l(()=>[a(K,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:l(()=>[a(q,null,{default:l(()=>[oe]),_:1}),a(q,{class:"q-pa-sm"},{default:l(()=>[o("fieldset",te,[ne,a(ee,{showing:r.value,dark:""},{default:l(()=>[a(ae,{size:"50px",color:"primary"})]),_:1},8,["showing"]),o("div",se,[o("div",ie,[a(P,{label:"Doc No",dense:"",filled:"",modelValue:T.value.TLOCREQ_DOCNO,"onUpdate:modelValue":n[0]||(n[0]=t=>T.value.TLOCREQ_DOCNO=t),readonly:!0},null,8,["modelValue"])])])]),o("fieldset",re,[de,f.value.length>0?(C(!0),R(k,{key:0},M(f.value,(t,E)=>(C(),R("div",{class:"row q-col-gutter-md q-pt-md",key:E,style:{"font-size":"10px"}},[o("div",ue,[a(y,{dense:"",filled:"",label:"Item Name",modelValue:t.TLOCREQ_ITMCD,"onUpdate:modelValue":i=>t.TLOCREQ_ITMCD=i,"use-input":"","input-debounce":"500",options:u.value,onFilter:n[1]||(n[1]=(i,Q,L)=>v(i,Q,L,"item")),behavior:"dialog","option-label":"MITM_ITMNM","option-value":"MITM_ITMCD","emit-value":"","map-options":"",loading:r.value,readonly:!0,"input-style":"font-size:11px"},null,8,["modelValue","onUpdate:modelValue","options","loading"])]),o("div",ce,[a(y,{dense:"",filled:"",label:"Transfer From",modelValue:t.TLOCREQ_FRLOC,"onUpdate:modelValue":i=>t.TLOCREQ_FRLOC=i,"use-input":"","input-debounce":"500",options:_.value,onFilter:n[2]||(n[2]=(i,Q,L)=>v(i,Q,L,"loc")),behavior:"dialog","option-label":"MLOC_LOCNM","option-value":"MLOC_LOCCD","emit-value":"","map-options":"",loading:r.value,readonly:!0},null,8,["modelValue","onUpdate:modelValue","options","loading"])]),o("div",me,[a(y,{dense:"",filled:"",label:"Transfer To",modelValue:t.TLOCREQ_TOLOC,"onUpdate:modelValue":i=>t.TLOCREQ_TOLOC=i,"use-input":"","input-debounce":"500",options:_.value,onFilter:n[3]||(n[3]=(i,Q,L)=>v(i,Q,L,"loc")),behavior:"dialog","option-label":"MLOC_LOCNM","option-value":"MLOC_LOCCD","emit-value":"","map-options":"",loading:r.value,readonly:!0},null,8,["modelValue","onUpdate:modelValue","options","loading"])]),o("div",pe,[a(P,{label:"Qty",dense:"",filled:"",modelValue:t.TLOCREQ_QTY,"onUpdate:modelValue":i=>t.TLOCREQ_QTY=i,rules:[i=>i<=e(t.TLOCREQ_ITMCD).STOCK||`Stock is less than needed, stock only ${e(t.TLOCREQ_ITMCD).STOCK}`]},null,8,["modelValue","onUpdate:modelValue","rules"])]),o("div",Ce,[a(z,{modelValue:t.TLOCREQ_ISREP,"onUpdate:modelValue":i=>t.TLOCREQ_ISREP=i,label:"Is replacement ?",color:"teal","true-value":1,"false-value":0,disable:!0},null,8,["modelValue","onUpdate:modelValue"])])]))),128)):W("",!0)])]),_:1}),a(X,{align:"right"},{default:l(()=>[a(V,{label:"approve",color:"primary",onClick:n[4]||(n[4]=t=>c()),loading:r.value},null,8,["loading"]),a(V,{flat:"",label:"Cancel",color:"red",onClick:A(H)},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}},fe={class:"q-pa-md"},Oe=o("div",{class:"row q-pb-md"},[o("div",{class:"col"},[o("span",{class:"text-h4"},"Transfer Request")]),o("div",{class:"col text-right"})],-1),Te={class:"row q-pt-md"},ve={class:"col"},ke={__name:"transferRequestIndex",setup(S){const h=Y(),O=m([]),T=m([{name:"TLOCREQ_DOCNO",label:"Doc Np",field:"TLOCREQ_DOCNO",sortable:!0,align:"left"},{name:"TLOCREQ_FRLOC",label:"From Location",field:"TLOCREQ_FRLOC",sortable:!0,align:"left"},{name:"TLOCREQ_TOLOC",label:"To Location",field:"TLOCREQ_TOLOC",sortable:!0,align:"left"},{name:"TLOCREQ_ISREP",label:"Is Replacement ?",field:"TLOCREQ_ISREP",sortable:!0,format:d=>`${d==1?"Yes":"No"}`,align:"left"}]),u=m(!1),_=m(""),f=m("");F(()=>{r()});const r=async()=>{u.value=!0,await D.post("inventory/transferRequest/searchAPI",{searchBy:_.value,searchValue:f.value}).then(d=>{u.value=!1,O.value=d.data.data}).catch(d=>{u.value=!1})},v=d=>{h.dialog({component:_e,componentProps:{dataHeader:d,dataDet:d.detail}}).onOk(async c=>{u.value=!1,onDialogOK()})},b=d=>{h.dialog({title:"Confirmation",message:"Are you sure want to print this transfer ?",cancel:!0,persistent:!0}).onOk(async()=>{u.value=!0,await D.post("inventory/printHandoverPDF",{data:btoa(d)}).then(c=>{u.value=!1,window.open("").document.write("<iframe width='100%' height='100%' src='data:application/pdf;base64, "+encodeURI(c.data)+"'></iframe>")}).catch(c=>{u.value=!1})})};return(d,c)=>(C(),R("div",fe,[Oe,a(G),o("div",Te,[o("div",ve,[a(j,{title:"Transfer Request List",rows:O.value,columns:T.value,"row-key":"TDLVORD_DLVCD",loading:u.value,dense:"",pagination:{rowsPerPage:20},class:"my-sticky-header-column-table"},{"top-right":l(()=>[a(y,{outlined:"",modelValue:_.value,"onUpdate:modelValue":c[0]||(c[0]=e=>_.value=e),options:T.value,label:"Search Columns","option-value":"name","option-label":"label","emit-value":"",dense:"","map-options":""},null,8,["modelValue","options"]),a(P,{borderless:"",dense:"",modelValue:f.value,"onUpdate:modelValue":[c[1]||(c[1]=e=>f.value=e),c[2]||(c[2]=e=>d.getOutgoingData())],placeholder:"Search",outlined:"",debounce:"1000"},{append:l(()=>[a(J,{name:"search"})]),_:1},8,["modelValue"])]),header:l(e=>[a(x,{props:e},{default:l(()=>[(C(!0),R(k,null,M(e.cols,p=>(C(),I(N,{key:p.name,props:e},{default:l(()=>[g(w(p.label),1)]),_:2},1032,["props"]))),128)),a(N,{"auto-width":""},{default:l(()=>[g("Action")]),_:1})]),_:2},1032,["props"])]),body:l(e=>[a(x,{props:e},{default:l(()=>[(C(!0),R(k,null,M(e.cols,p=>(C(),I(U,{key:p.name,props:e},{default:l(()=>[g(w(p.value),1)]),_:2},1032,["props"]))),128)),a(U,{"auto-width":""},{default:l(()=>[a(V,{flat:"",color:e.row.TLOCREQ_APPRVBY!==null?"grey":"indigo",icon:"done_all",onClick:p=>v(e.row),dense:"",disable:e.row.TLOCREQ_APPRVBY!==null},{default:l(()=>[a(B,null,{default:l(()=>[g(w(e.row.TLOCREQ_APPRVBY!==null?"Request has been approved":"Approve All Data"),1)]),_:2},1024)]),_:2},1032,["color","onClick","disable"]),a(V,{flat:"",color:e.row.TLOCREQ_APPRVBY!==null?"cyan":"grey",icon:"print",onClick:p=>b(e.row.TLOCREQ_DOCNO),dense:"",disable:e.row.TLOCREQ_APPRVBY===null},{default:l(()=>[a(B,null,{default:l(()=>[g(w(e.row.TLOCREQ_APPRVBY===null?"Please Aprove first":"Print handover request"),1)]),_:2},1024)]),_:2},1032,["color","onClick","disable"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])])])]))}};export{ke as default};
