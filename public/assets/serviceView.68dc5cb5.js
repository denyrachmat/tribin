import{Q as I}from"./QTooltip.c7c4a574.js";import{s as f,o as K,B as c,C as v,D as a,E as l,J as ee,K as q,I as s,P as M,L as le,Q as C,M as F,O as te,aa as ae,aW as B,R as Q,H as S,aY as k,aU as E,aV as x,aZ as se,aX as H,ap as de,S as ue}from"./index.4576cdd3.js";import{u as oe,b as G,d as Y,Q as re,k as j,l as U,m as W,a as ce,n as Z,x as _e}from"./use-dialog-plugin-component.f0b87b73.js";import{Q as J,a as X}from"./use-cache.5d7a0b9e.js";import{d as P}from"./date.173b942b.js";import{api_web as R}from"./axios.bb06a4b8.js";import{Q as me,a as fe,C as Se}from"./ClosePopup.e3652ff6.js";import{_ as ve}from"./serviceOprUpdateOrder.dfc6be68.js";import"./QBadge.4723abf8.js";const Ce=s("div",{class:"text-h6"},"Create Item Master",-1),Te={class:"row"},De={class:"col"},pe={class:"col q-pl-md"},Ve={class:"row q-pt-md"},Me={class:"col"},ge={class:"col q-pl-md"},he={class:"row q-pt-md"},Ie={class:"col"},Re={class:"col q-pl-md"},be={class:"row q-pt-md"},we={class:"col"},ke={__name:"itemCreate",props:{ItemCat:String},setup(L){const{dialogRef:g,onDialogHide:O,onDialogOK:y,onDialogCancel:N}=oe(),b=G(),n=f({MITM_ITMCD:"",MITM_ITMNM:"",MITM_STKUOM:"",MITM_ITMTYPE:1,MITM_BRAND:"",MITM_MODEL:"",MITM_SPEC:"",MITM_ITMCAT:"",MITM_COACD:"",MITM_ITMCAT:""}),_=f(!1),p=f([]),w=f([]),D=L;K(()=>{A(),n.value.MITM_ITMCAT=D.ItemCat});const m=(T,d,t,u)=>{d(async()=>{await R.post("item/getListCoasAPI",{search:T}).then(o=>{w.value=o.data})})},$=()=>{b.dialog({title:"Confirmation",message:"Do you want to save this item ?",cancel:!0,persistent:!0}).onOk(async()=>{await R.post("item",n.value).then(T=>{y(T.data.data.value)})})},A=async()=>{_.value=!0,await R.get("item/formAPI").then(T=>{_.value=!1,p.value=T.data.uoms,w.value=T.data.coas}).catch(()=>{_.value=!1})};return(T,d)=>(c(),v(te,{ref_key:"dialogRef",ref:g,onHide:F(O),"transition-show":"slide-up","transition-hide":"slide-down","full-width":"",persistent:""},{default:a(()=>[l(ee,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:a(()=>[l(q,null,{default:a(()=>[Ce]),_:1}),l(q,{class:"q-pa-sm"},{default:a(()=>[s("div",Te,[s("div",De,[l(M,{label:"Item Code",dense:"",modelValue:n.value.MITM_ITMCD,"onUpdate:modelValue":d[0]||(d[0]=t=>n.value.MITM_ITMCD=t),filled:""},null,8,["modelValue"])]),s("div",pe,[l(M,{label:"Item Name",dense:"",modelValue:n.value.MITM_ITMNM,"onUpdate:modelValue":d[1]||(d[1]=t=>n.value.MITM_ITMNM=t),filled:""},null,8,["modelValue"])])]),s("div",Ve,[s("div",Me,[l(Y,{dense:"",filled:"",label:"UOM",modelValue:n.value.MITM_STKUOM,"onUpdate:modelValue":d[2]||(d[2]=t=>n.value.MITM_STKUOM=t),options:p.value,behavior:"dialog","option-label":"MUOM_UOMNM","option-value":"MUOM_UOMCD","emit-value":"","map-options":"",loading:_.value},null,8,["modelValue","options","loading"])]),s("div",ge,[l(M,{label:"Item Brand",dense:"",modelValue:n.value.MITM_BRAND,"onUpdate:modelValue":d[3]||(d[3]=t=>n.value.MITM_BRAND=t),filled:""},null,8,["modelValue"])])]),s("div",he,[s("div",Ie,[l(M,{label:"Item Model",dense:"",modelValue:n.value.MITM_MODEL,"onUpdate:modelValue":d[4]||(d[4]=t=>n.value.MITM_MODEL=t),filled:""},null,8,["modelValue"])]),s("div",Re,[l(M,{label:"Item Specification",dense:"",modelValue:n.value.MITM_SPEC,"onUpdate:modelValue":d[5]||(d[5]=t=>n.value.MITM_SPEC=t),filled:""},null,8,["modelValue"])])]),s("div",be,[s("div",we,[l(Y,{dense:"",filled:"",label:"COA",modelValue:n.value.MITM_COACD,"onUpdate:modelValue":d[6]||(d[6]=t=>n.value.MITM_COACD=t),options:w.value,"use-input":"",behavior:"dialog","option-label":"MCOA_COANM","option-value":"MCOA_COACD",onFilter:d[7]||(d[7]=(t,u,o)=>m(t,u,o)),"emit-value":"","map-options":"",loading:_.value},null,8,["modelValue","options","loading"])])])]),_:1}),l(le,{align:"right"},{default:a(()=>[l(C,{label:"OK",color:"primary",onClick:d[8]||(d[8]=t=>$())}),l(C,{flat:"",label:"Cancel",color:"red",onClick:F(N)},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}},Oe=s("div",{class:"text-h6"},"Create Order",-1),ye={style:{border:"1px black solid","border-radius":"10px"}},Ue=s("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[s("b",null,"Header")],-1),Ne={class:"row"},$e={class:"col"},Ae={class:"col q-pl-md"},He={class:"row items-center justify-end"},Qe={class:"row"},Ye={class:"col"},Le={style:{border:"1px black solid","border-radius":"10px",height:"35vh",overflow:"auto"}},Pe=s("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[s("b",null,"Detail Items")],-1),qe={key:0,class:"row q-pb-sm"},Fe={class:"col text-right"},z={__name:"serviceCreateOrder",props:{header:Array,detail:Array,mode:String},setup(L){const{dialogRef:g,onDialogHide:O,onDialogOK:y,onDialogCancel:N}=oe(),b=G(),n=L;K(async()=>{n.header&&(await A(),await T(),_.value=n.header,D.value=n.detail)});const _=f({SRVH_DOCNO:"",SRVH_ISSDT:P.formatDate(Date.now(),"YYYY-MM-DD"),SRVH_CUSCD:""}),p=f([]),w=f([]),D=f([]),m=f(!1),$=(e,i,r,h)=>{i(async()=>{h==="cust"&&await A(e),h==="item"&&await T(e)})},A=async e=>{m.value=!0,await R.post("customer/searchAPI",{searchValue:e}).then(i=>{m.value=!1,w.value=i.data.data}).catch(()=>{m.value=!1})},T=async e=>{m.value=!0,await R.post("item/searchAPI",{searchValue:e}).then(i=>{m.value=!1,p.value=i.data.data}).catch(()=>{m.value=!1})},d=()=>{D.value.push({TSRVD_ITMCD:"",TSRVD_LINE:D.value.length+1,TSRVD_QTY:1,TSRVD_CUSTRMK:""})},t=e=>{b.dialog({title:"Confirmation",message:`Do you want to delete this lines no ${e+1} ?`,cancel:!0,persistent:!0}).onOk(async()=>{D.value.splice(e,1)})},u=e=>{b.dialog({component:ke,componentProps:{ItemCat:"SERVICE_ITEMM"}}).onOk(async i=>{await T(""),D.value[e].TSRVD_ITMCD=i.MITM_ITMNM})},o=()=>{b.dialog({title:"Confirmation",message:"Do you want to submit this data ?",cancel:!0,persistent:!0}).onOk(async()=>{m.value=!0,await R.post("servicesAdmin",{header:_.value,detail:D.value}).then(e=>{m.value=!1,y()})})};return(e,i)=>(c(),v(te,{ref_key:"dialogRef",ref:g,onHide:F(O),"transition-show":"slide-up","transition-hide":"slide-down","full-width":"",persistent:""},{default:a(()=>[l(ee,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:a(()=>[l(q,null,{default:a(()=>[Oe]),_:1}),l(q,{class:"q-pa-sm"},{default:a(()=>[s("fieldset",ye,[Ue,s("div",Ne,[s("div",$e,[l(M,{label:"SPK No",readonly:"",dense:"",modelValue:_.value.SRVH_DOCNO,"onUpdate:modelValue":i[0]||(i[0]=r=>_.value.SRVH_DOCNO=r),filled:""},null,8,["modelValue"])]),s("div",Ae,[l(M,{filled:"",modelValue:_.value.SRVH_ISSDT,"onUpdate:modelValue":i[2]||(i[2]=r=>_.value.SRVH_ISSDT=r),dense:"",label:"Issue Date",loading:m.value,onClick:i[3]||(i[3]=r=>e.quotationIssueDate.qDateProxy.show()),mask:"####-##-##","fill-mask":"",hint:"Mask: YYYY-MM-DD",readonly:n.mode==="view"},{append:a(()=>[l(ae,{name:"event",class:"cursor-pointer",disable:n.mode==="view"},{default:a(()=>[l(me,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[l(fe,{modelValue:_.value.SRVH_ISSDT,"onUpdate:modelValue":i[1]||(i[1]=r=>_.value.SRVH_ISSDT=r),mask:"YYYY-MM-DD"},{default:a(()=>[s("div",He,[B(l(C,{label:"Close",color:"primary",flat:""},null,512),[[Se]])])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["disable"])]),_:1},8,["modelValue","loading","readonly"])])]),s("div",Qe,[s("div",Ye,[l(Y,{dense:"",filled:"",label:"Customer Choose",modelValue:_.value.SRVH_CUSCD,"onUpdate:modelValue":i[4]||(i[4]=r=>_.value.SRVH_CUSCD=r),"use-input":"","input-debounce":"500",options:w.value,onFilter:i[5]||(i[5]=(r,h,V)=>$(r,h,V,"cust")),behavior:"dialog","option-label":"MCUS_CUSNM","option-value":"MCUS_CUSCD","emit-value":"","map-options":"",loading:m.value,readonly:n.mode==="view"},null,8,["modelValue","options","loading","readonly"])])])]),s("fieldset",Le,[Pe,n.mode!=="view"?(c(),Q("div",qe,[s("div",Fe,[l(C,{flat:"",icon:"add",color:"blue",onClick:i[6]||(i[6]=r=>d())},{default:a(()=>[l(I,null,{default:a(()=>[S("Add lines")]),_:1})]),_:1})])])):k("",!0),l(re,{bordered:"",dense:""},{default:a(()=>[D.value.length>0?(c(!0),Q(E,{key:0},x(D.value,(r,h)=>(c(),v(j,{key:h,class:"q-my-sm",dense:""},{default:a(()=>[l(U,{avatar:""},{default:a(()=>[l(se,{"text-color":"blue"},{default:a(()=>[S(H(h+1),1)]),_:2},1024)]),_:2},1024),l(U,null,{default:a(()=>[l(W,null,{default:a(()=>[l(Y,{dense:"",filled:"",label:"Item Name",modelValue:r.TSRVD_ITMCD,"onUpdate:modelValue":V=>r.TSRVD_ITMCD=V,"use-input":"","input-debounce":"500",options:p.value,onFilter:i[7]||(i[7]=(V,ne,ie)=>$(V,ne,ie,"item")),behavior:"dialog","option-label":"MITM_ITMNM","option-value":"MITM_ITMNM","emit-value":"","map-options":"",loading:m.value},null,8,["modelValue","onUpdate:modelValue","options","loading"])]),_:2},1024)]),_:2},1024),l(U,null,{default:a(()=>[l(M,{label:"Qty",filled:"",dense:"",modelValue:r.TSRVD_QTY,"onUpdate:modelValue":V=>r.TSRVD_QTY=V},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(U,null,{default:a(()=>[l(M,{label:"Problem",filled:"",dense:"",modelValue:r.TSRVD_CUSTRMK,"onUpdate:modelValue":V=>r.TSRVD_CUSTRMK=V},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n.mode!=="view"?(c(),v(U,{key:0,side:""},{default:a(()=>[l(C,{icon:"delete",color:"red",flat:"",onClick:V=>t(h)},{default:a(()=>[l(I,null,{default:a(()=>[S("Delete line")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),n.mode!=="view"?(c(),v(U,{key:1,side:""},{default:a(()=>[l(C,{icon:"library_add",color:"indigo",flat:"",onClick:V=>u(h)},{default:a(()=>[l(I,null,{default:a(()=>[S("Add new item")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0)]),_:2},1024))),128)):B((c(),v(j,{key:1,class:"q-my-sm",clickable:""},{default:a(()=>[l(U,null,{default:a(()=>[l(W,null,{default:a(()=>[S(" No Items Added ")]),_:1})]),_:1})]),_:1})),[[de]])]),_:1})])]),_:1}),l(le,{align:"right"},{default:a(()=>[l(C,{label:"OK",color:"primary",onClick:i[8]||(i[8]=r=>o()),disable:m.value,loading:m.value},null,8,["disable","loading"]),l(C,{flat:"",label:"Cancel",color:"red",onClick:F(N),loading:m.value},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}};const Ee={class:"q-pa-md"},xe={class:"row q-pb-md"},Ke=s("div",{class:"col"},[s("span",{class:"text-h4"},"Receive Order ")],-1),Ge={class:"col text-right"},Be={class:"row q-pt-md"},je={class:"col"},We={key:1},nl={__name:"serviceView",setup(L){const g=G(),O=f("SRVH_DOCNO"),y=f(""),N=f([]),b=f([{name:"SRVH_DOCNO",label:"SPK No",field:"SRVH_DOCNO",sortable:!0,align:"left"},{name:"MCUS_CUSNM",label:"Cust",field:"MCUS_CUSNM",sortable:!0,align:"left"},{name:"STAT",label:"Status",field:t=>d(t),sortable:!0,align:"left"},{name:"created_at",label:"Created Date",field:"created_at",sortable:!0,align:"left",format:t=>P.formatDate(new Date(t),"DD MMM YYYY")}]),n=f(!1),_=f(null);K(()=>{p(),_.value=setInterval(()=>{p()},1e4)});const p=async()=>{n.value=!0,await R.post("servicesAdmin/search",{searchBy:O.value,searchValue:y.value}).then(t=>{n.value=!1,N.value=t.data.data}).catch(t=>{n.value=!1})},w=()=>{g.dialog({component:z}).onOk(async t=>{p()})},D=t=>{const u={SRVH_DOCNO:t.SRVH_DOCNO,SRVH_ISSDT:P.formatDate(t.SRVH_ISSDT,"YYYY-MM-DD"),SRVH_CUSCD:t.MCUS_CUSCD};let o=[];t.detail.map(e=>{o.push({id:e.id,TSRVD_ITMCD:e.TSRVD_ITMCD,TSRVD_LINE:e.TSRVD_LINE,TSRVD_QTY:e.TSRVD_QTY,TSRVD_CUSTRMK:e.TSRVD_CUSTRMK,TSRVD_REMARK:e.TSRVD_REMARK,TSRVD_FLGSTS:e.TSRVD_FLGSTS,listFixDet:e.list_fix_det})}),g.dialog({component:ve,componentProps:{header:u,detail:o,mode:t.detail.filter(e=>e.TSRVD_FLGSTS===1).length===t.detail.length?"approvecust":"view"}}).onOk(async e=>{p()})},m=t=>{window.open("https://joss.jatpowerindo.co.id/servicesAdmin/printInvoice/"+btoa(t),"_blank").focus()},$=t=>{const u={SRVH_DOCNO:t.SRVH_DOCNO,SRVH_ISSDT:P.formatDate(t.SRVH_ISSDT,"YYYY-MM-DD"),SRVH_CUSCD:t.MCUS_CUSCD};let o=[];t.detail.map(e=>{o.push({TSRVD_ITMCD:e.TSRVD_ITMCD,TSRVD_LINE:e.TSRVD_LINE,TSRVD_QTY:e.TSRVD_QTY,TSRVD_CUSTRMK:e.TSRVD_CUSTRMK})}),g.dialog({component:z,componentProps:{header:u,detail:o}}).onOk(async e=>{p()})},A=t=>{g.dialog({title:"Confirmation",message:"Do you want to proceed to service ?",cancel:!0,persistent:!0}).onOk(async()=>{n.value=!0,await R.put(`servicesAdmin/${btoa(t.SRVH_DOCNO)}`,{TSRVD_FLGSTS:2}).then(u=>{n.value=!1}).catch(u=>{n.value=!1})})},T=t=>{g.dialog({title:"Confirmation",message:"Are you sure want to delete this order ?",cancel:!0,persistent:!0}).onOk(async()=>{n.value=!0,await R.delete(`servicesAdmin/${btoa(t.SRVH_DOCNO)}`).then(u=>{n.value=!1}).catch(u=>{n.value=!1})})},d=t=>{const u=t.detail.filter(i=>i.TSRVD_FLGSTS===0),o=t.detail.filter(i=>i.TSRVD_FLGSTS===1),e=t.detail.filter(i=>i.TSRVD_FLGSTS===2);if(u.length==t.detail.length)return{color:"warning",label:"On Draft",icon:"edit"};if(o.length>0&&o.length<t.detail.length)return{color:"green",label:"On Checking Price",icon:"payments"};if(o.length>0&&o.length==t.detail.length)return{color:"primary",label:"Checking Price Done, Waiting Cust Confirmation",icon:"price_check"};if(e.length>0&&e.length<t.detail.length)return{color:"green",label:"On progress Fix by Technician",icon:"engineering"};if(e.length>0&&e.length===t.detail.length)return{color:"primary",label:"Fix has been done",icon:"fact_check"}};return(t,u)=>(c(),Q("div",Ee,[s("div",xe,[Ke,s("div",Ge,[l(C,{icon:"add",color:"blue",onClick:w},{default:a(()=>[l(I,null,{default:a(()=>[S("Create New Order")]),_:1})]),_:1})])]),l(ue),s("div",Be,[s("div",je,[l(ce,{title:"Created Order",rows:N.value,columns:b.value,"row-key":"name",loading:n.value,dense:"",pagination:{rowsPerPage:20},class:"my-sticky-header-column-table"},{"top-right":a(()=>[l(Y,{outlined:"",modelValue:O.value,"onUpdate:modelValue":u[0]||(u[0]=o=>O.value=o),options:b.value,label:"Search Columns","option-value":"name","option-label":"label","emit-value":"",dense:"","map-options":""},null,8,["modelValue","options"]),l(M,{borderless:"",dense:"",modelValue:y.value,"onUpdate:modelValue":[u[1]||(u[1]=o=>y.value=o),u[2]||(u[2]=o=>t.dataQuo())],placeholder:"Search",outlined:"",debounce:"1000"},{append:a(()=>[l(ae,{name:"search"})]),_:1},8,["modelValue"])]),header:a(o=>[l(J,{props:o},{default:a(()=>[(c(!0),Q(E,null,x(o.cols,e=>(c(),v(Z,{key:e.name,props:o},{default:a(()=>[S(H(e.label),1)]),_:2},1032,["props"]))),128)),l(Z,{"auto-width":""},{default:a(()=>[S("Action")]),_:1})]),_:2},1032,["props"])]),body:a(o=>[l(J,{props:o},{default:a(()=>[(c(!0),Q(E,null,x(o.cols,e=>(c(),v(X,{key:e.name,props:o},{default:a(()=>[e.name==="STAT"?(c(),v(_e,{key:0,clickable:"",color:e.value.color,"text-color":"white",icon:e.value.icon},{default:a(()=>[S(H(e.value.label),1)]),_:2},1032,["color","icon"])):(c(),Q("span",We,H(e.value),1))]),_:2},1032,["props"]))),128)),l(X,{"auto-width":""},{default:a(()=>[o.row.detail.filter(e=>e.TSRVD_FLGSTS>0).length===0?(c(),v(C,{key:0,flat:"",color:"orange",icon:"edit",onClick:e=>$(o.row),dense:""},{default:a(()=>[l(I,null,{default:a(()=>[S("Edit this Order")]),_:1})]),_:2},1032,["onClick"])):k("",!0),o.row.detail.filter(e=>e.TSRVD_FLGSTS>0).length===o.row.detail.length?(c(),v(C,{key:1,flat:"",color:"indigo",icon:"print",onClick:e=>m(o.row.SRVH_DOCNO),dense:""},{default:a(()=>[l(I,null,{default:a(()=>[S("Print this order")]),_:1})]),_:2},1032,["onClick"])):k("",!0),o.row.detail.filter(e=>e.TSRVD_FLGSTS>0).length===0?(c(),v(C,{key:2,flat:"",color:"red",icon:"delete",onClick:e=>T(o.row.SRVH_DOCNO),dense:""},{default:a(()=>[l(I,null,{default:a(()=>[S(H(o.row.detail.filter(e=>e.TSRVD_FLGSTS>0).length>0?"Cannot delete processed order":"Delete this Order"),1)]),_:2},1024)]),_:2},1032,["onClick"])):k("",!0),o.row.detail.filter(e=>e.TSRVD_FLGSTS>0).length>0?(c(),v(C,{key:3,flat:"",color:"cyan",icon:"visibility",onClick:e=>D(o.row),dense:""},{default:a(()=>[l(I,null,{default:a(()=>[S("View this Order")]),_:1})]),_:2},1032,["onClick"])):k("",!0),o.row.detail.filter(e=>e.TSRVD_FLGSTS===1).length===o.row.detail.length?(c(),v(C,{key:4,flat:"",color:"indigo",icon:"check",onClick:e=>A(o.row.SRVH_DOCNO),dense:""},{default:a(()=>[l(I,null,{default:a(()=>[S(H(o.row.detail.filter(e=>e.TSRVD_FLGSTS>0).length!==o.row.detail.length?"Please wait until all item checked":"Proceed all item to service"),1)]),_:2},1024)]),_:2},1032,["onClick"])):k("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])])])]))}};export{nl as default};
