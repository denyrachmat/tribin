import{Q as k}from"./QTooltip.d059922c.js";import{t as m,o as K,C as _,D as P,E as t,F as a,M as ue,O as E,J as i,$ as S,an as j,U as H,Q as T,R,S as Q,T as M,V as re,I as f,P as N,W as ce,X as pe,Y as $,Z as me,aY as Ce}from"./index.d3b281cc.js";import{a as z,u as ve,l as h,Q as _e,b as x,c as b,d as I,k as Ve,m as B}from"./QTable.1615aa7c.js";import{Q as Y,a as J}from"./QTd.1b41b091.js";import{api_web as g}from"./axios.92c5a30f.js";import{Q as De,a as fe}from"./QInnerLoading.4796ca90.js";import{Q as Te,a as Re,C as ge}from"./ClosePopup.5dd0d898.js";import{Q as be}from"./QBtnToggle.58885291.js";import"./use-render-cache.3aae9b27.js";import"./date.ee3c6413.js";import"./QBtnGroup.81cf4959.js";const Se=i("div",{class:"text-h6"},"Create Incoming",-1),he={style:{border:"1px black solid","border-radius":"10px"}},Oe=i("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[i("b",null,"Header")],-1),Ue={class:"row q-col-gutter-md"},ye={class:"col-12 col-sm-6"},Pe={class:"col-12 col-sm-6"},we={class:"row items-center justify-end"},Ie={class:"row q-col-gutter-md q-pt-md"},ke={key:0,class:"col-12 col-sm-6"},Qe={key:1,class:"col-12 col-sm-6"},Me={key:2,class:"col-12 col-sm-6"},Ne={key:3,class:"col-12 col-sm-6"},Le={class:"row q-col-gutter-md q-pt-md"},Ae={class:"col"},Fe={class:"row q-py-md"},qe={class:"col"},Ee={style:{border:"1px black solid","border-radius":"10px",height:"35vh",overflow:"auto"}},He=i("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[i("b",null,"List Of Items")],-1),$e={class:"row q-pb-sm"},xe={class:"col text-right"},Be={__name:"incomingCreate",props:{dataHeader:Array},setup(L){const O=z(),D=L,n=m({TRCV_RCVCD:"",TRCV_SUPCD:"",TRCV_ISSUDT:"",TRCV_REFFNO:"",TRCV_DOCNO:""}),V=m(1),r=m([]),o=m(!1),w=m([]),U=m([]),y=m([]),p=m([]),C=m([]);K(async()=>{await A(""),await F(""),await q(""),D.dataHeader&&(n.value={TRCV_RCVCD:D.dataHeader.TRCV_RCVCD,TRCV_SUPCD:D.dataHeader.TRCV_SUPCD,TRCV_ISSUDT:D.dataHeader.TRCV_ISSUDT,TRCV_REFFNO:D.dataHeader.TRCV_REFFNO,TRCV_DOCNO:D.dataHeader.TRCV_DOCNO},V.value=D.dataHeader.RCV_STATE,D.dataHeader.det.map(s=>{r.value.push({item_code:s.item_code,quantity:s.quantity,unit_price:s.unit_price})}))});const d=()=>{n.value={TRCV_RCVCD:"",TRCV_SUPCD:"",TRCV_ISSUDT:"",TRCV_REFFNO:"",TRCV_DOCNO:""},r.value=[]},v=(s,l,e,u)=>{l(async()=>{u==="supp"&&await F(s),u==="cust"&&await q(s),u==="item"&&await A(s),u==="po"&&await G(s),u==="inv"&&await Z(s)})},A=async s=>{o.value=!0,await g.post("item/searchAPI",{searchValue:s,isITMCD:1}).then(l=>{o.value=!1,p.value=l.data.data}).catch(()=>{o.value=!1})},F=async(s,l="MSUP_SUPNM")=>{o.value=!0,await g.post("supplier/searchAPI",{searchValue:s,searchCol:l}).then(e=>{o.value=!1,w.value=e.data.data}).catch(()=>{o.value=!1})},q=async(s,l="MCUS_CUSNM")=>{o.value=!0,await g.post("customer/searchAPI",{searchValue:s,searchCol:l}).then(e=>{o.value=!1,U.value=e.data.data}).catch(()=>{o.value=!1})},G=async(s,l="TPCHORD_PCHCD")=>{o.value=!0,await g.post("purchase-order/searchApprovedPO",{searchValue:s,searchCol:l}).then(e=>{o.value=!1,y.value=e.data.data}).catch(()=>{o.value=!1})},W=s=>{O.dialog({title:"Confirmation",message:`Do you want to delete this lines no ${s+1} ?`,cancel:!0,persistent:!0}).onOk(async()=>{r.value.splice(s,1)})},X=()=>{r.value.push({item_code:"",quantity:"",unit_price:""})},Z=async(s,l="TDLVORD_DLVCD")=>{o.value=!0,await g.post("invoices/search",{searchBy:l,searchValue:s}).then(e=>{o.value=!1,C.value=e.data.data}).catch(e=>{o.value=!1})},ee=s=>{let l=y.value.filter(e=>e.TPCHORD_PCHCD==s);r.value=[],l.length>0&&(n.value.TRCV_SUPCD=l[0].TPCHORD_SUPCD,l[0].det.map(e=>{r.value.push({item_code:e.TPCHORDDETA_ITMCD,quantity:e.TPCHORDDETA_ITMQT,unit_price:e.TPCHORDDETA_ITMPRC_PER})}))},le=s=>{let l=C.value.filter(e=>e.TDLVORD_DLVCD==s);r.value=[],l.length>0&&(n.value.TRCV_SUPCD=l[0].TDLVORD_CUSCD,l[0].dlvacc.map(e=>{r.value.push({item_code:e.TDLVACCESSORY_ITMCD,quantity:e.TDLVACCESSORY_ITMQT,unit_price:0})}),l[0].dlvdet.map(e=>{r.value.push({item_code:e.TDLVORDDETA_ITMCD,quantity:e.TDLVORDDETA_ITMQT,unit_price:e.TDLVORDDETA_PRC})}))},ae=()=>{O.dialog({title:"Confirmation",message:"Are you sure want to save this Incoming ?",cancel:!0,persistent:!0}).onOk(async()=>{o.value=!0,await g.post("receive/saveAPI",{...n.value,det:r.value}).then(s=>{o.value=!1,O.notify({color:"green",message:`${s.data.msg}`}),se()}).catch(()=>{o.value=!1})})},{dialogRef:te,onDialogHide:oe,onDialogOK:se,onDialogCancel:ne}=ve();return(s,l)=>(_(),P(me,{ref_key:"dialogRef",ref:te,onHide:$(oe),"transition-show":"slide-up","transition-hide":"slide-down","full-width":"",persistent:""},{default:t(()=>[a(ue,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:t(()=>[a(E,null,{default:t(()=>[Se]),_:1}),a(E,{class:"q-pa-sm"},{default:t(()=>[i("fieldset",he,[Oe,a(De,{showing:o.value,dark:""},{default:t(()=>[a(fe,{size:"50px",color:"primary"})]),_:1},8,["showing"]),i("div",Ue,[i("div",ye,[a(S,{label:"Code",readonly:"",dense:"",filled:"",modelValue:n.value.TRCV_RCVCD,"onUpdate:modelValue":l[0]||(l[0]=e=>n.value.TRCV_RCVCD=e)},null,8,["modelValue"])]),i("div",Pe,[a(S,{filled:"",modelValue:n.value.TRCV_ISSUDT,"onUpdate:modelValue":l[2]||(l[2]=e=>n.value.TRCV_ISSUDT=e),dense:"",label:"Receive Date"},{append:t(()=>[a(j,{name:"event",class:"cursor-pointer"},{default:t(()=>[a(Te,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[a(Re,{modelValue:n.value.TRCV_ISSUDT,"onUpdate:modelValue":l[1]||(l[1]=e=>n.value.TRCV_ISSUDT=e),mask:"YYYY-MM-DD"},{default:t(()=>[i("div",we,[H(a(T,{label:"Close",color:"primary",flat:""},null,512),[[ge]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),i("div",Ie,[V.value==1?(_(),R("div",ke,[a(h,{dense:"",filled:"",label:"Supplier Name",modelValue:n.value.TRCV_SUPCD,"onUpdate:modelValue":l[3]||(l[3]=e=>n.value.TRCV_SUPCD=e),"use-input":"","input-debounce":"500",options:w.value,onFilter:l[4]||(l[4]=(e,u,c)=>v(e,u,c,"supp")),behavior:"dialog","option-label":"MSUP_SUPNM","option-value":"MSUP_SUPCD","emit-value":"","map-options":"",loading:o.value,disable:n.value.TRCV_RCVCD!==""||V.value==1},null,8,["modelValue","options","loading","disable"])])):(_(),R("div",Qe,[a(h,{dense:"",filled:"",label:"Customer Name",modelValue:n.value.TRCV_SUPCD,"onUpdate:modelValue":l[5]||(l[5]=e=>n.value.TRCV_SUPCD=e),"use-input":"","input-debounce":"500",options:U.value,onFilter:l[6]||(l[6]=(e,u,c)=>v(e,u,c,"cust")),behavior:"dialog","option-label":"MCUS_CUSNM","option-value":"MCUS_CUSCD","emit-value":"","map-options":"",loading:o.value,disable:n.value.TRCV_RCVCD!==""||V.value==1},null,8,["modelValue","options","loading","disable"])])),V.value==1?(_(),R("div",Me,[a(h,{dense:"",filled:"",label:"PO Number",modelValue:n.value.TRCV_REFFNO,"onUpdate:modelValue":[l[7]||(l[7]=e=>n.value.TRCV_REFFNO=e),l[9]||(l[9]=e=>ee(e))],"use-input":"","input-debounce":"500",options:y.value,onFilter:l[8]||(l[8]=(e,u,c)=>v(e,u,c,"po")),behavior:"dialog","option-label":"PO_CUSTDESC","option-value":"TPCHORD_PCHCD","emit-value":"","map-options":"",loading:o.value,disable:n.value.TRCV_RCVCD!==""},null,8,["modelValue","options","loading","disable"])])):(_(),R("div",Ne,[a(h,{dense:"",filled:"",label:"JAT Invoice No",modelValue:n.value.TRCV_REFFNO,"onUpdate:modelValue":[l[10]||(l[10]=e=>n.value.TRCV_REFFNO=e),l[12]||(l[12]=e=>le(e))],"use-input":"","input-debounce":"500",options:C.value,onFilter:l[11]||(l[11]=(e,u,c)=>v(e,u,c,"inv")),behavior:"dialog","option-label":"LABEL","option-value":"TDLVORD_DLVCD","emit-value":"","map-options":"",loading:o.value,disable:n.value.TRCV_RCVCD!==""},null,8,["modelValue","options","loading","disable"])]))]),i("div",Le,[i("div",Ae,[a(S,{label:"Doc Supplier No",dense:"",filled:"",modelValue:n.value.TRCV_DOCNO,"onUpdate:modelValue":l[13]||(l[13]=e=>n.value.TRCV_DOCNO=e)},null,8,["modelValue"])])])]),i("div",Fe,[i("div",qe,[a(be,{modelValue:V.value,"onUpdate:modelValue":[l[14]||(l[14]=e=>V.value=e),l[15]||(l[15]=e=>d())],spread:"","no-caps":"","toggle-color":"purple",color:"white","text-color":"black",options:[{label:"From PO",value:1},{label:"Return",value:2}],disable:n.value.TRCV_RCVCD!==""},null,8,["modelValue","disable"])])]),i("fieldset",Ee,[He,i("div",$e,[i("div",xe,[a(T,{flat:"",icon:"add",color:"blue",label:"Add Lines",onClick:X,loading:o.value},null,8,["loading"])])]),a(_e,{bordered:"",dense:""},{default:t(()=>[r.value.length>0?(_(!0),R(Q,{key:0},M(r.value,(e,u)=>(_(),P(x,{key:u,class:"q-my-sm",dense:"",loading:o.value},{default:t(()=>[a(b,{avatar:""},{default:t(()=>[a(re,{"text-color":"blue"},{default:t(()=>[f(N(u+1),1)]),_:2},1024)]),_:2},1024),a(b,null,{default:t(()=>[a(I,null,{default:t(()=>[a(h,{dense:"",filled:"",label:"Item Code",modelValue:e.item_code,"onUpdate:modelValue":c=>e.item_code=c,"use-input":"","input-debounce":"500",options:p.value,onFilter:l[16]||(l[16]=(c,ie,de)=>v(c,ie,de,"item")),behavior:"dialog","option-label":"MITM_ITMNMREAL","option-value":"MITM_ITMNM","emit-value":"","map-options":"",loading:o.value,disable:n.value.TRCV_RCVCD!==""},null,8,["modelValue","onUpdate:modelValue","options","loading","disable"])]),_:2},1024)]),_:2},1024),a(b,null,{default:t(()=>[a(I,null,{default:t(()=>[a(S,{dense:"",label:"Qty",filled:"",modelValue:e.quantity,"onUpdate:modelValue":c=>e.quantity=c},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),a(b,null,{default:t(()=>[a(I,null,{default:t(()=>[a(S,{dense:"",label:"Price",filled:"",modelValue:e.unit_price,"onUpdate:modelValue":c=>e.unit_price=c},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),a(b,{side:""},{default:t(()=>[a(T,{icon:"delete",color:"red",flat:"",onClick:c=>W(u)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["loading"]))),128)):H((_(),P(x,{key:1,class:"q-my-sm",clickable:""},{default:t(()=>[a(b,null,{default:t(()=>[a(I,null,{default:t(()=>[f(" Choose sales order first to access item list ")]),_:1})]),_:1})]),_:1})),[[ce]])]),_:1})])]),_:1}),a(pe,{align:"right"},{default:t(()=>[a(T,{label:"OK",color:"primary",onClick:l[17]||(l[17]=e=>ae()),disable:s.stateSubmit,loading:o.value},null,8,["disable","loading"]),a(T,{flat:"",label:"Cancel",color:"red",onClick:$(ne)},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}},Ye={class:"q-pa-md"},Je={class:"row q-pb-md"},Ke=i("div",{class:"col"},[i("span",{class:"text-h4"},"Incoming")],-1),je={class:"col text-right"},ze={class:"row q-pt-md"},Ge={class:"col"},dl={__name:"incomingIndex",setup(L){const O=z(),D=m([]),n=m([{name:"TRCV_RCVCD",label:"Receive ID",field:"TRCV_RCVCD",sortable:!0,align:"left"},{name:"MSUP_SUPNM",label:"Supplier Name",field:"MSUP_SUPNM",sortable:!0,align:"left"},{name:"MSUP_CURCD",label:"Currency",field:"MSUP_CURCD",sortable:!0,align:"left"},{name:"TOT_RCV",label:"Total Qty",field:"TOT_RCV",sortable:!0,align:"left",format:p=>`${p.toLocaleString()}`},{name:"TOT_AMT",label:"Total Amount",field:"TOT_AMT",sortable:!0,align:"left",format:p=>`${p.toLocaleString()}`}]),V=m(!1),r=m(""),o=m("");K(()=>{w()});const w=async()=>{V.value=!0,await g.post("receive/searchAPI",{searchBy:r.value,searchValue:o.value}).then(p=>{V.value=!1,D.value=p.data.data}).catch(p=>{V.value=!1})},U=(p=[])=>{O.dialog({component:Be,componentProps:{dataHeader:p}}).onOk(async C=>{getOutgoingData()})},y=p=>{};return(p,C)=>(_(),R("div",Ye,[i("div",Je,[Ke,i("div",je,[a(T,{icon:"add",color:"blue",onClick:C[0]||(C[0]=d=>U())},{default:t(()=>[a(k,null,{default:t(()=>[f("Create New Delivery")]),_:1})]),_:1})])]),a(Ce),i("div",ze,[i("div",Ge,[a(Ve,{title:"Outgoing List",rows:D.value,columns:n.value,"row-key":"TDLVORD_DLVCD",loading:V.value,dense:"",pagination:{rowsPerPage:20},class:"my-sticky-header-column-table"},{"top-right":t(()=>[a(h,{outlined:"",modelValue:r.value,"onUpdate:modelValue":C[1]||(C[1]=d=>r.value=d),options:p.columns,label:"Search Columns","option-value":"name","option-label":"label","emit-value":"",dense:"","map-options":""},null,8,["modelValue","options"]),a(S,{borderless:"",dense:"",modelValue:o.value,"onUpdate:modelValue":[C[2]||(C[2]=d=>o.value=d),C[3]||(C[3]=d=>p.getOutgoingData())],placeholder:"Search",outlined:"",debounce:"1000"},{append:t(()=>[a(j,{name:"search"})]),_:1},8,["modelValue"])]),header:t(d=>[a(Y,{props:d},{default:t(()=>[(_(!0),R(Q,null,M(d.cols,v=>(_(),P(B,{key:v.name,props:d},{default:t(()=>[f(N(v.label),1)]),_:2},1032,["props"]))),128)),a(B,{"auto-width":""},{default:t(()=>[f("Action")]),_:1})]),_:2},1032,["props"])]),body:t(d=>[a(Y,{props:d},{default:t(()=>[(_(!0),R(Q,null,M(d.cols,v=>(_(),P(J,{key:v.name,props:d},{default:t(()=>[f(N(v.value),1)]),_:2},1032,["props"]))),128)),a(J,{"auto-width":""},{default:t(()=>[a(T,{flat:"",color:"orange",icon:"edit",onClick:v=>U(d.row),dense:""},{default:t(()=>[a(k,null,{default:t(()=>[f("Edit Data")]),_:1})]),_:2},1032,["onClick"]),a(T,{flat:"",color:"red",icon:"delete",onClick:v=>y(d.row.TDLVORD_DLVCD),dense:""},{default:t(()=>[a(k,null,{default:t(()=>[f("Edit Data")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])])])]))}};export{dl as default};
