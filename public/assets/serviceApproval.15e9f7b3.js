import{s as f,o as M,B as _,C as h,D as e,E as a,L as I,M as p,T as N,H as n,V as L,P,R as U,S as A,bc as O,U as q,O as d,I as s,Q as w,W as B,X as x,Y as F,Z as K,am as j,aX as E}from"./index.8816b435.js";import{a as $,u as G,Q as Y,b as H,c,d as u,k as X}from"./QTable.cd0a79d1.js";import{api_web as V}from"./axios.94729689.js";import{Q as z}from"./QTooltip.3adfa3f2.js";import{_ as W}from"./serviceOprItemAdd.6ee39b29.js";const Z=s("div",{class:"text-h6"},"View List Price",-1),J=["innerHTML"],ee={__name:"serviceApprovalDetView",props:{idHeader:String},setup(k){const C=$(),{dialogRef:D,onDialogHide:g,onDialogOK:v,onDialogCancel:R}=G(),m=k,S=f([]),l=f(!1);M(()=>{b()});const b=async()=>{l.value=!0,await V.get(`servicesAdmins/viewUnapproveMgrDet/${btoa(m.idHeader.SRVH_DOCNO)}`).then(t=>{l.value=!1,S.value=t.data}).catch(t=>{l.value=!1})},i=t=>{let r=0;return t.map(o=>{r+=o.TSRVF_QTY*o.TSRVF_PRC}),r},y=t=>{t.listFixDet=t.list_fix_det,C.dialog({component:W,componentProps:{mode:"view",dataItem:t}}).onOk(async r=>{})},T=(t=!1)=>{C.dialog({title:`${t?"Approval Message Confirmation":"Rejection Message Confirmation"}`,message:`Please add message before ${t?"approve":"reject"} this service.`,cancel:!0,persistent:!0,prompt:{model:"",type:"text"}}).onOk(async r=>{l.value=!0,await V.put(`servicesAdmins/updateDetByIDHead/${btoa(m.idHeader.id)}`,{TSRVD_FLGSTS:t?1:0,TSRVD_MGRRMK:r}).then(o=>{l.value=!1,v()}).catch(o=>{l.value=!1})})};return(t,r)=>(_(),h(F,{ref_key:"dialogRef",ref:D,onHide:x(g),"transition-show":"slide-up","transition-hide":"slide-down","full-width":""},{default:e(()=>[a(I,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:e(()=>[a(p,null,{default:e(()=>[Z]),_:1}),a(p,{class:"q-pa-sm"},{default:e(()=>[a(Y,{bordered:"",loading:l.value},{default:e(()=>[S.value.length===0?N((_(),h(H,{key:0,class:"q-my-sm",clickable:""},{default:e(()=>[l.value?(_(),h(c,{key:1},{default:e(()=>[n("Please wait, loading data... ")]),_:1})):(_(),h(c,{key:0},{default:e(()=>[n(" No items added ")]),_:1}))]),_:1})),[[L]]):(_(!0),P(U,{key:1},A(S.value,(o,Q)=>(_(),h(H,{key:Q,class:O("q-my-sm")},{default:e(()=>[a(c,{avatar:""},{default:e(()=>[a(q,{color:o.TSRVD_FLGSTS===0?"red":"primary","text-color":"white"},{default:e(()=>[n(d(Q+1),1)]),_:2},1032,["color"])]),_:2},1024),a(c,null,{default:e(()=>[a(u,null,{default:e(()=>[n(d(o.TSRVD_ITMCD),1)]),_:2},1024),a(u,{caption:""},{default:e(()=>[n(" Item ")]),_:1})]),_:2},1024),a(c,null,{default:e(()=>[a(u,null,{default:e(()=>[n(d(o.TSRVD_QTY),1)]),_:2},1024),a(u,{caption:""},{default:e(()=>[n(" Qty ")]),_:1})]),_:2},1024),a(c,null,{default:e(()=>[a(u,null,{default:e(()=>[s("div",{innerHTML:o.TSRVD_REMARK},null,8,J)]),_:2},1024),a(u,{caption:""},{default:e(()=>[n(" Remarks ")]),_:1})]),_:2},1024),a(c,null,{default:e(()=>[a(u,null,{default:e(()=>[n("Rp. "+d(i(o.list_fix_det).toLocaleString()),1)]),_:2},1024),a(u,{caption:""},{default:e(()=>[n(" Total Fix Price ")]),_:1})]),_:2},1024),a(c,{side:""},{default:e(()=>[a(w,{icon:"visibility",flat:"",color:"primary",onClick:_e=>y(o)},{default:e(()=>[a(z,null,{default:e(()=>[n("View list fix items")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["loading"])]),_:1}),a(B,{align:"right"},{default:e(()=>[a(w,{label:"Approve",color:"primary",onClick:r[0]||(r[0]=o=>T(!0)),disable:l.value,loading:l.value},null,8,["disable","loading"]),a(w,{label:"Reject",color:"red",onClick:r[1]||(r[1]=o=>T()),loading:l.value},null,8,["loading"]),a(w,{label:"Cancel",color:"red",onClick:x(R),disable:l.value,loading:l.value,flat:""},null,8,["onClick","disable","loading"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}},ae={class:"q-pa-md"},le={class:"row"},te={class:"col"},oe={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},se={class:"text-h5 text-bold"},ne={class:"text-h6 text-bold"},ie={class:"text-subtitle2"},re={class:"text-h6 text-bold"},de=s("div",{class:"text-subtitle2"},"Resolved Items",-1),ce={class:"row"},ue={class:"col"},Se={__name:"serviceApproval",setup(k){const C=$();f([{name:"SRVH_DOCNO",label:"SPK No",field:"SRVH_DOCNO",sortable:!0,align:"left"},{name:"MCUS_CUSNM",label:"Customer Name",field:"MCUS_CUSNM",sortable:!0,align:"left"},{name:"resolve",label:"Resolved Line",sortable:!0,align:"left",field:l=>l.resolve.length},{name:"unresolve",label:"Unresolved Line",sortable:!0,align:"left",field:l=>l.unresolve.length},{name:"SRVH_ISSDT",label:"Submited Date",field:"SRVH_ISSDT",sortable:!0,align:"left"}]);const D=f([]),g=f(""),v=f(!1),R=f(null);M(()=>{m(),R.value=setInterval(()=>{m()},1e4)});const m=async()=>{v.value=!0,await V.get("servicesAdmins/listUnapproveMgr").then(l=>{v.value=!1,D.value=l.data}).catch(l=>{v.value=!1})},S=l=>{C.dialog({component:ee,componentProps:{idHeader:l}}).onOk(async b=>{m()})};return(l,b)=>(_(),P("div",ae,[s("div",le,[s("div",te,[a(X,{grid:"",flat:"",bordered:"","card-container-class":l.cardContainerClass,title:"Approve Service Pricing",rows:D.value,columns:l.columns,"row-key":"name",filter:g.value,"hide-header":"",pagination:{rowsPerPage:50},"rows-per-page-options":l.rowsPerPageOptions,loading:v.value},{"top-right":e(()=>[a(K,{borderless:"",dense:"",debounce:"300",modelValue:g.value,"onUpdate:modelValue":b[0]||(b[0]=i=>g.value=i),placeholder:"Search"},{append:e(()=>[a(j,{name:"search"})]),_:1},8,["modelValue"])]),item:e(i=>[s("div",oe,[a(I,{flat:"",bordered:""},{default:e(()=>[a(p,{class:O("text-center bg-green text-white")},{default:e(()=>[s("div",se,d(i.row.SRVH_DOCNO),1)]),_:2},1024),a(E),a(p,null,{default:e(()=>[s("div",ne,d(i.row.MCUS_CUSNM),1),s("div",ie,d(i.row.SRVH_ISSDT),1)]),_:2},1024),a(p,null,{default:e(()=>[s("div",re,d(i.row.resolve.length)+" of "+d(i.row.detail.length),1),de]),_:2},1024),a(p,null,{default:e(()=>[s("div",ce,[s("div",ue,[a(w,{color:"primary",label:"View Data",onClick:y=>S(i.row)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024)])]),_:1},8,["card-container-class","rows","columns","filter","rows-per-page-options","loading"])])])]))}};export{Se as default};
