import{Q as k}from"./QTooltip.8988ec0c.js";import{t as c,C as _,D as I,E as o,F as a,M as Z,O as M,J as s,$ as S,an as H,U as L,Q as D,R as b,S as U,T as N,V as ee,I as C,P as w,W as le,X as ae,Z as oe,o as te,aY as se}from"./index.33d42d45.js";import{a as x,l as y,Q as ne,b as q,c as T,d as O,k as ie,m as A}from"./QTable.8bef965b.js";import{Q as $,a as E}from"./QTd.cf967279.js";import{api_web as P}from"./axios.8c26b471.js";import{Q as de,a as ue}from"./QInnerLoading.8728b2db.js";import{Q as re,a as ce,C as pe}from"./ClosePopup.97d46971.js";import{Q as me}from"./QBtnToggle.6d6d3514.js";import"./use-render-cache.3aae9b27.js";import"./date.0f1ec996.js";import"./QBtnGroup.706a151f.js";const ve=s("div",{class:"text-h6"},"Create Incoming",-1),_e={style:{border:"1px black solid","border-radius":"10px"}},Ce=s("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[s("b",null,"Header")],-1),fe={class:"row q-col-gutter-md"},De={class:"col-12 col-sm-6"},Ve={class:"col-12 col-sm-6"},ge={class:"row items-center justify-end"},Te={class:"row q-col-gutter-md q-pt-md"},be={class:"col-12 col-sm-6"},Re={key:0,class:"col-12 col-sm-6"},he={key:1,class:"col-12 col-sm-6"},Oe={class:"row q-col-gutter-md q-pt-md"},Se={class:"col"},ye={class:"row q-py-md"},Pe={class:"col"},Ie={style:{border:"1px black solid","border-radius":"10px",height:"35vh",overflow:"auto"}},we=s("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[s("b",null,"List Of Items")],-1),Qe={class:"row q-pb-sm"},ke={class:"col text-right"},Ue={__name:"incomingCreate",props:{dataHeader:Array},setup(B){const Q=x(),i=c({TRCV_RCVCD:"",TRCV_SUPCD:"",TRCV_ISSUDT:"",INV_NO:"",PO_NO:"",TRCV_DOCNO:""}),V=c(1),p=c([]),n=c(!1),g=c([]),R=c([]),h=c([]),m=c([]),u=(t,l,e,r)=>{l(async()=>{r==="cust"&&f(t),r==="item"&&await d(t),r==="po"&&await F(t),r==="inv"&&await j(t)})},d=async t=>{n.value=!0,await P.post("item/searchAPI",{searchValue:t,IS_ITMCD:1}).then(l=>{n.value=!1,h.value=l.data.data}).catch(()=>{n.value=!1})},f=async(t,l="MSUP_SUPNM")=>{n.value=!0,await P.post("supplier/searchAPI",{searchValue:t,searchCol:l}).then(e=>{n.value=!1,g.value=e.data.data}).catch(()=>{n.value=!1})},F=async(t,l="TPCHORD_PCHCD")=>{n.value=!0,await P.post("purchase-order/searchApprovedPO",{searchValue:t,searchCol:l}).then(e=>{n.value=!1,R.value=e.data.data}).catch(()=>{n.value=!1})},Y=t=>{Q.dialog({title:"Confirmation",message:`Do you want to delete this lines no ${t+1} ?`,cancel:!0,persistent:!0}).onOk(async()=>{p.value.splice(t,1)})},J=()=>{p.value.push({item_code:"",quantity:"",unit_price:""})},j=async(t,l="TDLVORD_DLVCD")=>{n.value=!0,await P.post("invoices/search",{searchBy:l,searchValue:t}).then(e=>{n.value=!1,m.value=e.data.data}).catch(e=>{n.value=!1})},z=t=>{let l=R.value.filter(e=>e.TPCHORD_PCHCD==t);console.log([t,l]),l.length>0&&l.det&&l.det.map(e=>{p.value.push({item_code:e.TPCHORDDETA_ITMCD,quantity:e.TPCHORDDETA_ITMQT,unit_price:e.TPCHORDDETA_ITMPRC_PER})})},G=t=>{let l=m.value.filter(e=>e.TDLVORD_DLVCD==t);console.log([t,l]),l.length>0&&l.dlvacc&&l.dlvdet&&(l.dlvacc.map(e=>{p.value.push({item_code:e.TDLVACCESSORY_ITMCD,quantity:e.TDLVACCESSORY_ITMQT,unit_price:0})}),l.dlvdet.map(e=>{p.value.push({item_code:e.TDLVORDDETA_ITMCD,quantity:e.TDLVORDDETA_ITMQT,unit_price:e.TDLVORDDETA_PRC})}))},K=()=>{};return(t,l)=>(_(),I(oe,{ref:"dialogRef",onHide:t.onDialogHide,"transition-show":"slide-up","transition-hide":"slide-down","full-width":"",persistent:""},{default:o(()=>[a(Z,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:o(()=>[a(M,null,{default:o(()=>[ve]),_:1}),a(M,{class:"q-pa-sm"},{default:o(()=>[s("fieldset",_e,[Ce,a(de,{showing:n.value,dark:""},{default:o(()=>[a(ue,{size:"50px",color:"primary"})]),_:1},8,["showing"]),s("div",fe,[s("div",De,[a(S,{label:"Code",readonly:"",dense:"",filled:"",modelValue:i.value.TRCV_RCVCD,"onUpdate:modelValue":l[0]||(l[0]=e=>i.value.TRCV_RCVCD=e)},null,8,["modelValue"])]),s("div",Ve,[a(S,{filled:"",modelValue:i.value.TRCV_ISSUDT,"onUpdate:modelValue":l[2]||(l[2]=e=>i.value.TRCV_ISSUDT=e),dense:"",label:"Receive Date"},{append:o(()=>[a(H,{name:"event",class:"cursor-pointer"},{default:o(()=>[a(re,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:o(()=>[a(ce,{modelValue:i.value.TRCV_ISSUDT,"onUpdate:modelValue":l[1]||(l[1]=e=>i.value.TRCV_ISSUDT=e),mask:"YYYY-MM-DD"},{default:o(()=>[s("div",ge,[L(a(D,{label:"Close",color:"primary",flat:""},null,512),[[pe]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),s("div",Te,[s("div",be,[a(y,{dense:"",filled:"",label:"Supplier Name",modelValue:i.value.TRCV_SUPCD,"onUpdate:modelValue":l[3]||(l[3]=e=>i.value.TRCV_SUPCD=e),"use-input":"","input-debounce":"500",options:g.value,onFilter:l[4]||(l[4]=(e,r,v)=>u(e,r,v,"cust")),behavior:"dialog","option-label":"MSUP_SUPNM","option-value":"MSUP_SUPCD","emit-value":"","map-options":"",loading:n.value,disable:i.value.TRCV_RCVCD!==""||V.value==1},null,8,["modelValue","options","loading","disable"])]),V.value==1?(_(),b("div",Re,[a(y,{dense:"",filled:"",label:"PO Number",modelValue:i.value.PO_NO,"onUpdate:modelValue":[l[5]||(l[5]=e=>i.value.PO_NO=e),l[7]||(l[7]=e=>z(e))],"use-input":"","input-debounce":"500",options:R.value,onFilter:l[6]||(l[6]=(e,r,v)=>u(e,r,v,"po")),behavior:"dialog","option-label":"PO_CUSTDESC","option-value":"TPCHORD_PCHCD","emit-value":"","map-options":"",loading:n.value,disable:i.value.TRCV_RCVCD!==""},null,8,["modelValue","options","loading","disable"])])):(_(),b("div",he,[a(y,{dense:"",filled:"",label:"JAT Invoice No",modelValue:i.value.INV_NO,"onUpdate:modelValue":[l[8]||(l[8]=e=>i.value.INV_NO=e),l[10]||(l[10]=e=>G(e))],"use-input":"","input-debounce":"500",options:m.value,onFilter:l[9]||(l[9]=(e,r,v)=>u(e,r,v,"inv")),behavior:"dialog","option-label":"LABEL","option-value":"TDLVORD_DLVCD","emit-value":"","map-options":"",loading:n.value,disable:i.value.TRCV_RCVCD!==""},null,8,["modelValue","options","loading","disable"])]))]),s("div",Oe,[s("div",Se,[a(S,{label:"Doc Supplier No",dense:"",filled:"",modelValue:i.value.TRCV_DOCNO,"onUpdate:modelValue":l[11]||(l[11]=e=>i.value.TRCV_DOCNO=e)},null,8,["modelValue"])])])]),s("div",ye,[s("div",Pe,[a(me,{modelValue:V.value,"onUpdate:modelValue":l[12]||(l[12]=e=>V.value=e),spread:"","no-caps":"","toggle-color":"purple",color:"white","text-color":"black",options:[{label:"From PO",value:1},{label:"Return",value:2}],disable:i.value.TRCV_RCVCD!==""},null,8,["modelValue","disable"])])]),s("fieldset",Ie,[we,s("div",Qe,[s("div",ke,[a(D,{flat:"",icon:"add",color:"blue",label:"Add Lines",onClick:J,loading:n.value},null,8,["loading"])])]),a(ne,{bordered:"",dense:""},{default:o(()=>[p.value.length>0?(_(!0),b(U,{key:0},N(p.value,(e,r)=>(_(),I(q,{key:r,class:"q-my-sm",dense:"",loading:n.value},{default:o(()=>[a(T,{avatar:""},{default:o(()=>[a(ee,{"text-color":"blue"},{default:o(()=>[C(w(r+1),1)]),_:2},1024)]),_:2},1024),a(T,null,{default:o(()=>[a(O,null,{default:o(()=>[a(y,{dense:"",filled:"",label:"Item Code",modelValue:e.item_code,"onUpdate:modelValue":v=>e.item_code=v,"use-input":"","input-debounce":"500",options:h.value,onFilter:l[13]||(l[13]=(v,W,X)=>u(v,W,X,"item")),behavior:"dialog","option-label":"MITM_ITMNM","option-value":"MITM_ITMCD","emit-value":"","map-options":"",loading:n.value,disable:i.value.TRCV_RCVCD!==""},null,8,["modelValue","onUpdate:modelValue","options","loading","disable"])]),_:2},1024)]),_:2},1024),a(T,null,{default:o(()=>[a(O,null,{default:o(()=>[a(S,{dense:"",label:"Qty",filled:"",modelValue:e.quantity,"onUpdate:modelValue":v=>e.quantity=v},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),a(T,null,{default:o(()=>[a(O,null,{default:o(()=>[C(" Rp. "+w(e.unit_price.toLocaleString()),1)]),_:2},1024),a(O,{caption:""},{default:o(()=>[C(" Price ")]),_:1})]),_:2},1024),a(T,{side:""},{default:o(()=>[a(D,{icon:"delete",color:"red",flat:"",onClick:v=>Y(r)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["loading"]))),128)):L((_(),I(q,{key:1,class:"q-my-sm",clickable:""},{default:o(()=>[a(T,null,{default:o(()=>[a(O,null,{default:o(()=>[C(" Choose sales order first to access item list ")]),_:1})]),_:1})]),_:1})),[[le]])]),_:1})])]),_:1}),a(ae,{align:"right"},{default:o(()=>[a(D,{label:"OK",color:"primary",onClick:l[14]||(l[14]=e=>K()),disable:t.stateSubmit,loading:n.value},null,8,["disable","loading"]),a(D,{flat:"",label:"Cancel",color:"red",onClick:t.onDialogCancel},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}},Ne={class:"q-pa-md"},Me={class:"row q-pb-md"},Le=s("div",{class:"col"},[s("span",{class:"text-h4"},"Incoming")],-1),qe={class:"col text-right"},Ae={class:"row q-pt-md"},$e={class:"col"},We={__name:"incomingIndex",setup(B){const Q=x(),i=c([]),V=c([{name:"TRCV_RCVCD",label:"Receive ID",field:"TRCV_RCVCD",sortable:!0,align:"left"},{name:"MSUP_SUPNM",label:"Supplier Name",field:"MSUP_SUPNM",sortable:!0,align:"left"},{name:"TOT_RCV",label:"Total Qty",field:"TOT_RCV",sortable:!0,align:"left"},{name:"TOT_AMT",label:"Total Amount",field:"TOT_AMT",sortable:!0,align:"left"}]),p=c(!1),n=c(""),g=c("");te(()=>{R()});const R=async()=>{p.value=!0,await P.post("receive/searchAPI",{searchBy:n.value,searchValue:g.value}).then(m=>{p.value=!1,i.value=m.data.data}).catch(m=>{p.value=!1})},h=(m=[])=>{Q.dialog({component:Ue,componentProps:{dataHeader:m}}).onOk(async u=>{getOutgoingData()})};return(m,u)=>(_(),b("div",Ne,[s("div",Me,[Le,s("div",qe,[a(D,{icon:"add",color:"blue",onClick:u[0]||(u[0]=d=>h())},{default:o(()=>[a(k,null,{default:o(()=>[C("Create New Delivery")]),_:1})]),_:1})])]),a(se),s("div",Ae,[s("div",$e,[a(ie,{title:"Outgoing List",rows:i.value,columns:V.value,"row-key":"TDLVORD_DLVCD",loading:p.value,dense:"",pagination:{rowsPerPage:20},class:"my-sticky-header-column-table"},{"top-right":o(()=>[a(y,{outlined:"",modelValue:n.value,"onUpdate:modelValue":u[1]||(u[1]=d=>n.value=d),options:m.columns,label:"Search Columns","option-value":"name","option-label":"label","emit-value":"",dense:"","map-options":""},null,8,["modelValue","options"]),a(S,{borderless:"",dense:"",modelValue:g.value,"onUpdate:modelValue":[u[2]||(u[2]=d=>g.value=d),u[3]||(u[3]=d=>m.getOutgoingData())],placeholder:"Search",outlined:"",debounce:"1000"},{append:o(()=>[a(H,{name:"search"})]),_:1},8,["modelValue"])]),header:o(d=>[a($,{props:d},{default:o(()=>[(_(!0),b(U,null,N(d.cols,f=>(_(),I(A,{key:f.name,props:d},{default:o(()=>[C(w(f.label),1)]),_:2},1032,["props"]))),128)),a(A,{"auto-width":""},{default:o(()=>[C("Action")]),_:1})]),_:2},1032,["props"])]),body:o(d=>[a($,{props:d},{default:o(()=>[(_(!0),b(U,null,N(d.cols,f=>(_(),I(E,{key:f.name,props:d},{default:o(()=>[C(w(f.value),1)]),_:2},1032,["props"]))),128)),a(E,{"auto-width":""},{default:o(()=>[a(D,{flat:"",color:"orange",icon:"edit",onClick:f=>h(d.row),dense:""},{default:o(()=>[a(k,null,{default:o(()=>[C("Edit Data")]),_:1})]),_:2},1032,["onClick"]),a(D,{flat:"",color:"red",icon:"delete",onClick:f=>m.onDelete(d.row.TDLVORD_DLVCD),dense:""},{default:o(()=>[a(k,null,{default:o(()=>[C("Edit Data")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])])])]))}};export{We as default};
