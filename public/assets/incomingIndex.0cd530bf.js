import{Q as I}from"./QTooltip.694ab8bf.js";import{t as p,o as Y,C,D as P,E as o,F as a,M as ue,O as q,J as i,$ as h,an as J,U as E,Q as D,R as T,S as k,T as Q,V as de,I as f,P as M,W as re,X as ce,Y as F,Z as pe,aY as me}from"./index.bfa72058.js";import{a as K,u as ve,l as y,Q as Ce,b as $,c as S,d as w,k as _e,m as H}from"./QTable.8fbcd7c0.js";import{Q as x,a as B}from"./QTd.563f5d5a.js";import{api_web as g}from"./axios.b3958b2f.js";import{Q as Ve,a as fe}from"./QInnerLoading.79c4304c.js";import{Q as De,a as Te,C as ge}from"./ClosePopup.5c4f58b1.js";import{Q as be}from"./QBtnToggle.3cded575.js";import"./use-render-cache.3aae9b27.js";import"./date.1e3fc3dd.js";import"./QBtnGroup.e04da602.js";const Re=i("div",{class:"text-h6"},"Create Incoming",-1),Se={style:{border:"1px black solid","border-radius":"10px"}},he=i("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[i("b",null,"Header")],-1),ye={class:"row q-col-gutter-md"},Oe={class:"col-12 col-sm-6"},Pe={class:"col-12 col-sm-6"},Ue={class:"row items-center justify-end"},we={class:"row q-col-gutter-md q-pt-md"},Ie={key:0,class:"col-12 col-sm-6"},ke={key:1,class:"col-12 col-sm-6"},Qe={key:2,class:"col-12 col-sm-6"},Me={key:3,class:"col-12 col-sm-6"},Ne={class:"row q-col-gutter-md q-pt-md"},Le={class:"col"},Ae={class:"row q-py-md"},qe={class:"col"},Ee={style:{border:"1px black solid","border-radius":"10px",height:"35vh",overflow:"auto"}},Fe=i("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[i("b",null,"List Of Items")],-1),$e={class:"row q-pb-sm"},He={class:"col text-right"},xe={__name:"incomingCreate",props:{dataHeader:Array},setup(j){const O=K(),s=p({TRCV_RCVCD:"",TRCV_SUPCD:"",TRCV_ISSUDT:"",TRCV_REFFNO:"",TRCV_DOCNO:""}),V=p(1),r=p([]),t=p(!1),b=p([]),U=p([]),R=p([]),_=p([]),m=p([]);Y(()=>{N(""),A(""),L("")});const u=()=>{s.value={TRCV_RCVCD:"",TRCV_SUPCD:"",TRCV_ISSUDT:"",TRCV_REFFNO:"",TRCV_DOCNO:""},r.value=[]},v=(n,l,e,d)=>{l(async()=>{d==="supp"&&await L(n),d==="cust"&&await A(n),d==="item"&&await N(n),d==="po"&&await z(n),d==="inv"&&await X(n)})},N=async n=>{t.value=!0,await g.post("item/searchAPI",{searchValue:n,isITMCD:1}).then(l=>{t.value=!1,_.value=l.data.data}).catch(()=>{t.value=!1})},L=async(n,l="MSUP_SUPNM")=>{t.value=!0,await g.post("supplier/searchAPI",{searchValue:n,searchCol:l}).then(e=>{t.value=!1,b.value=e.data.data}).catch(()=>{t.value=!1})},A=async(n,l="MCUS_CUSNM")=>{t.value=!0,await g.post("customer/searchAPI",{searchValue:n,searchCol:l}).then(e=>{t.value=!1,U.value=e.data.data}).catch(()=>{t.value=!1})},z=async(n,l="TPCHORD_PCHCD")=>{t.value=!0,await g.post("purchase-order/searchApprovedPO",{searchValue:n,searchCol:l}).then(e=>{t.value=!1,R.value=e.data.data}).catch(()=>{t.value=!1})},G=n=>{O.dialog({title:"Confirmation",message:`Do you want to delete this lines no ${n+1} ?`,cancel:!0,persistent:!0}).onOk(async()=>{r.value.splice(n,1)})},W=()=>{r.value.push({item_code:"",quantity:"",unit_price:""})},X=async(n,l="TDLVORD_DLVCD")=>{t.value=!0,await g.post("invoices/search",{searchBy:l,searchValue:n}).then(e=>{t.value=!1,m.value=e.data.data}).catch(e=>{t.value=!1})},Z=n=>{let l=R.value.filter(e=>e.TPCHORD_PCHCD==n);r.value=[],l.length>0&&(s.value.TRCV_SUPCD=l[0].TPCHORD_SUPCD,l[0].det.map(e=>{r.value.push({item_code:e.TPCHORDDETA_ITMCD,quantity:e.TPCHORDDETA_ITMQT,unit_price:e.TPCHORDDETA_ITMPRC_PER})}))},ee=n=>{let l=m.value.filter(e=>e.TDLVORD_DLVCD==n);r.value=[],l.length>0&&(s.value.TRCV_SUPCD=l[0].TDLVORD_CUSCD,l[0].dlvacc.map(e=>{r.value.push({item_code:e.TDLVACCESSORY_ITMCD,quantity:e.TDLVACCESSORY_ITMQT,unit_price:0})}),l[0].dlvdet.map(e=>{r.value.push({item_code:e.TDLVORDDETA_ITMCD,quantity:e.TDLVORDDETA_ITMQT,unit_price:e.TDLVORDDETA_PRC})}))},le=()=>{O.dialog({title:"Confirmation",message:"Are you sure want to save this Incoming ?",cancel:!0,persistent:!0}).onOk(async()=>{t.value=!0,await g.post("receive/saveAPI",{...s.value,det:r.value}).then(n=>{t.value=!1,O.notify({color:"green",message:`${n.data.msg}`}),te()}).catch(()=>{t.value=!1})})},{dialogRef:ae,onDialogHide:oe,onDialogOK:te,onDialogCancel:se}=ve();return(n,l)=>(C(),P(pe,{ref_key:"dialogRef",ref:ae,onHide:F(oe),"transition-show":"slide-up","transition-hide":"slide-down","full-width":"",persistent:""},{default:o(()=>[a(ue,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:o(()=>[a(q,null,{default:o(()=>[Re]),_:1}),a(q,{class:"q-pa-sm"},{default:o(()=>[i("fieldset",Se,[he,a(Ve,{showing:t.value,dark:""},{default:o(()=>[a(fe,{size:"50px",color:"primary"})]),_:1},8,["showing"]),i("div",ye,[i("div",Oe,[a(h,{label:"Code",readonly:"",dense:"",filled:"",modelValue:s.value.TRCV_RCVCD,"onUpdate:modelValue":l[0]||(l[0]=e=>s.value.TRCV_RCVCD=e)},null,8,["modelValue"])]),i("div",Pe,[a(h,{filled:"",modelValue:s.value.TRCV_ISSUDT,"onUpdate:modelValue":l[2]||(l[2]=e=>s.value.TRCV_ISSUDT=e),dense:"",label:"Receive Date"},{append:o(()=>[a(J,{name:"event",class:"cursor-pointer"},{default:o(()=>[a(De,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:o(()=>[a(Te,{modelValue:s.value.TRCV_ISSUDT,"onUpdate:modelValue":l[1]||(l[1]=e=>s.value.TRCV_ISSUDT=e),mask:"YYYY-MM-DD"},{default:o(()=>[i("div",Ue,[E(a(D,{label:"Close",color:"primary",flat:""},null,512),[[ge]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),i("div",we,[V.value==1?(C(),T("div",Ie,[a(y,{dense:"",filled:"",label:"Supplier Name",modelValue:s.value.TRCV_SUPCD,"onUpdate:modelValue":l[3]||(l[3]=e=>s.value.TRCV_SUPCD=e),"use-input":"","input-debounce":"500",options:b.value,onFilter:l[4]||(l[4]=(e,d,c)=>v(e,d,c,"supp")),behavior:"dialog","option-label":"MSUP_SUPNM","option-value":"MSUP_SUPCD","emit-value":"","map-options":"",loading:t.value,disable:s.value.TRCV_RCVCD!==""||V.value==1},null,8,["modelValue","options","loading","disable"])])):(C(),T("div",ke,[a(y,{dense:"",filled:"",label:"Customer Name",modelValue:s.value.TRCV_SUPCD,"onUpdate:modelValue":l[5]||(l[5]=e=>s.value.TRCV_SUPCD=e),"use-input":"","input-debounce":"500",options:U.value,onFilter:l[6]||(l[6]=(e,d,c)=>v(e,d,c,"cust")),behavior:"dialog","option-label":"MCUS_CUSNM","option-value":"MCUS_CUSCD","emit-value":"","map-options":"",loading:t.value,disable:s.value.TRCV_RCVCD!==""||V.value==1},null,8,["modelValue","options","loading","disable"])])),V.value==1?(C(),T("div",Qe,[a(y,{dense:"",filled:"",label:"PO Number",modelValue:s.value.TRCV_REFFNO,"onUpdate:modelValue":[l[7]||(l[7]=e=>s.value.TRCV_REFFNO=e),l[9]||(l[9]=e=>Z(e))],"use-input":"","input-debounce":"500",options:R.value,onFilter:l[8]||(l[8]=(e,d,c)=>v(e,d,c,"po")),behavior:"dialog","option-label":"PO_CUSTDESC","option-value":"TPCHORD_PCHCD","emit-value":"","map-options":"",loading:t.value,disable:s.value.TRCV_RCVCD!==""},null,8,["modelValue","options","loading","disable"])])):(C(),T("div",Me,[a(y,{dense:"",filled:"",label:"JAT Invoice No",modelValue:s.value.TRCV_REFFNO,"onUpdate:modelValue":[l[10]||(l[10]=e=>s.value.TRCV_REFFNO=e),l[12]||(l[12]=e=>ee(e))],"use-input":"","input-debounce":"500",options:m.value,onFilter:l[11]||(l[11]=(e,d,c)=>v(e,d,c,"inv")),behavior:"dialog","option-label":"LABEL","option-value":"TDLVORD_DLVCD","emit-value":"","map-options":"",loading:t.value,disable:s.value.TRCV_RCVCD!==""},null,8,["modelValue","options","loading","disable"])]))]),i("div",Ne,[i("div",Le,[a(h,{label:"Doc Supplier No",dense:"",filled:"",modelValue:s.value.TRCV_DOCNO,"onUpdate:modelValue":l[13]||(l[13]=e=>s.value.TRCV_DOCNO=e)},null,8,["modelValue"])])])]),i("div",Ae,[i("div",qe,[a(be,{modelValue:V.value,"onUpdate:modelValue":[l[14]||(l[14]=e=>V.value=e),l[15]||(l[15]=e=>u())],spread:"","no-caps":"","toggle-color":"purple",color:"white","text-color":"black",options:[{label:"From PO",value:1},{label:"Return",value:2}],disable:s.value.TRCV_RCVCD!==""},null,8,["modelValue","disable"])])]),i("fieldset",Ee,[Fe,i("div",$e,[i("div",He,[a(D,{flat:"",icon:"add",color:"blue",label:"Add Lines",onClick:W,loading:t.value},null,8,["loading"])])]),a(Ce,{bordered:"",dense:""},{default:o(()=>[r.value.length>0?(C(!0),T(k,{key:0},Q(r.value,(e,d)=>(C(),P($,{key:d,class:"q-my-sm",dense:"",loading:t.value},{default:o(()=>[a(S,{avatar:""},{default:o(()=>[a(de,{"text-color":"blue"},{default:o(()=>[f(M(d+1),1)]),_:2},1024)]),_:2},1024),a(S,null,{default:o(()=>[a(w,null,{default:o(()=>[a(y,{dense:"",filled:"",label:"Item Code",modelValue:e.item_code,"onUpdate:modelValue":c=>e.item_code=c,"use-input":"","input-debounce":"500",options:_.value,onFilter:l[16]||(l[16]=(c,ne,ie)=>v(c,ne,ie,"item")),behavior:"dialog","option-label":"MITM_ITMNMREAL","option-value":"MITM_ITMNM","emit-value":"","map-options":"",loading:t.value,disable:s.value.TRCV_RCVCD!==""},null,8,["modelValue","onUpdate:modelValue","options","loading","disable"])]),_:2},1024)]),_:2},1024),a(S,null,{default:o(()=>[a(w,null,{default:o(()=>[a(h,{dense:"",label:"Qty",filled:"",modelValue:e.quantity,"onUpdate:modelValue":c=>e.quantity=c},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),a(S,null,{default:o(()=>[a(w,null,{default:o(()=>[a(h,{dense:"",label:"Price",filled:"",modelValue:e.unit_price,"onUpdate:modelValue":c=>e.unit_price=c},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),a(S,{side:""},{default:o(()=>[a(D,{icon:"delete",color:"red",flat:"",onClick:c=>G(d)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["loading"]))),128)):E((C(),P($,{key:1,class:"q-my-sm",clickable:""},{default:o(()=>[a(S,null,{default:o(()=>[a(w,null,{default:o(()=>[f(" Choose sales order first to access item list ")]),_:1})]),_:1})]),_:1})),[[re]])]),_:1})])]),_:1}),a(ce,{align:"right"},{default:o(()=>[a(D,{label:"OK",color:"primary",onClick:l[17]||(l[17]=e=>le()),disable:n.stateSubmit,loading:t.value},null,8,["disable","loading"]),a(D,{flat:"",label:"Cancel",color:"red",onClick:F(se)},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}},Be={class:"q-pa-md"},Ye={class:"row q-pb-md"},Je=i("div",{class:"col"},[i("span",{class:"text-h4"},"Incoming")],-1),Ke={class:"col text-right"},je={class:"row q-pt-md"},ze={class:"col"},il={__name:"incomingIndex",setup(j){const O=K(),s=p([]),V=p([{name:"TRCV_RCVCD",label:"Receive ID",field:"TRCV_RCVCD",sortable:!0,align:"left"},{name:"MSUP_SUPNM",label:"Supplier Name",field:"MSUP_SUPNM",sortable:!0,align:"left"},{name:"TOT_RCV",label:"Total Qty",field:"TOT_RCV",sortable:!0,align:"left"},{name:"TOT_AMT",label:"Total Amount",field:"TOT_AMT",sortable:!0,align:"left"}]),r=p(!1),t=p(""),b=p("");Y(()=>{U()});const U=async()=>{r.value=!0,await g.post("receive/searchAPI",{searchBy:t.value,searchValue:b.value}).then(_=>{r.value=!1,s.value=_.data.data}).catch(_=>{r.value=!1})},R=(_=[])=>{O.dialog({component:xe,componentProps:{dataHeader:_}}).onOk(async m=>{getOutgoingData()})};return(_,m)=>(C(),T("div",Be,[i("div",Ye,[Je,i("div",Ke,[a(D,{icon:"add",color:"blue",onClick:m[0]||(m[0]=u=>R())},{default:o(()=>[a(I,null,{default:o(()=>[f("Create New Delivery")]),_:1})]),_:1})])]),a(me),i("div",je,[i("div",ze,[a(_e,{title:"Outgoing List",rows:s.value,columns:V.value,"row-key":"TDLVORD_DLVCD",loading:r.value,dense:"",pagination:{rowsPerPage:20},class:"my-sticky-header-column-table"},{"top-right":o(()=>[a(y,{outlined:"",modelValue:t.value,"onUpdate:modelValue":m[1]||(m[1]=u=>t.value=u),options:_.columns,label:"Search Columns","option-value":"name","option-label":"label","emit-value":"",dense:"","map-options":""},null,8,["modelValue","options"]),a(h,{borderless:"",dense:"",modelValue:b.value,"onUpdate:modelValue":[m[2]||(m[2]=u=>b.value=u),m[3]||(m[3]=u=>_.getOutgoingData())],placeholder:"Search",outlined:"",debounce:"1000"},{append:o(()=>[a(J,{name:"search"})]),_:1},8,["modelValue"])]),header:o(u=>[a(x,{props:u},{default:o(()=>[(C(!0),T(k,null,Q(u.cols,v=>(C(),P(H,{key:v.name,props:u},{default:o(()=>[f(M(v.label),1)]),_:2},1032,["props"]))),128)),a(H,{"auto-width":""},{default:o(()=>[f("Action")]),_:1})]),_:2},1032,["props"])]),body:o(u=>[a(x,{props:u},{default:o(()=>[(C(!0),T(k,null,Q(u.cols,v=>(C(),P(B,{key:v.name,props:u},{default:o(()=>[f(M(v.value),1)]),_:2},1032,["props"]))),128)),a(B,{"auto-width":""},{default:o(()=>[a(D,{flat:"",color:"orange",icon:"edit",onClick:v=>R(u.row),dense:""},{default:o(()=>[a(I,null,{default:o(()=>[f("Edit Data")]),_:1})]),_:2},1032,["onClick"]),a(D,{flat:"",color:"red",icon:"delete",onClick:v=>_.onDelete(u.row.TDLVORD_DLVCD),dense:""},{default:o(()=>[a(I,null,{default:o(()=>[f("Edit Data")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])])])]))}};export{il as default};
