import{Q as I}from"./QTooltip.0474e3df.js";import{s as _,o as x,B as C,C as w,D as l,E as e,J as ee,K as P,I as i,P as V,L as le,Q as f,M as q,O as ae,aa as te,aW as B,R as H,H as S,aY as E,aU as F,aV as K,aZ as ie,aX as A,ap as de,S as ue}from"./index.a4aa7398.js";import{u as oe,b as G,d as Q,Q as re,k as j,l as y,m as W,a as ce,n as J}from"./use-dialog-plugin-component.951bb55a.js";import{Q as X,a as Z}from"./use-cache.24aa01d6.js";import{d as L}from"./date.efd6c3d7.js";import{api_web as R}from"./axios.5046a631.js";import{Q as _e,a as me,C as Se}from"./ClosePopup.7bdbc64e.js";import{_ as fe}from"./serviceOprUpdateOrder.11c2be76.js";import"./QBadge.a91c47ac.js";const ve=i("div",{class:"text-h6"},"Create Item Master",-1),Ce={class:"row"},De={class:"col"},Te={class:"col q-pl-md"},pe={class:"row q-pt-md"},Ve={class:"col"},Me={class:"col q-pl-md"},ge={class:"row q-pt-md"},Ie={class:"col"},Re={class:"col q-pl-md"},be={class:"row q-pt-md"},he={class:"col"},we={__name:"itemCreate",props:{ItemCat:String},setup(Y){const{dialogRef:M,onDialogHide:O,onDialogOK:k,onDialogCancel:U}=oe(),b=G(),s=_({MITM_ITMCD:"",MITM_ITMNM:"",MITM_STKUOM:"",MITM_ITMTYPE:1,MITM_BRAND:"",MITM_MODEL:"",MITM_SPEC:"",MITM_ITMCAT:"",MITM_COACD:"",MITM_ITMCAT:""}),r=_(!1),T=_([]),h=_([]),D=Y;x(()=>{$(),s.value.MITM_ITMCAT=D.ItemCat});const c=(v,a,o,n)=>{a(async()=>{await R.post("item/getListCoasAPI",{search:v}).then(t=>{h.value=t.data})})},N=()=>{b.dialog({title:"Confirmation",message:"Do you want to save this item ?",cancel:!0,persistent:!0}).onOk(async()=>{await R.post("item",s.value).then(v=>{k(v.data.data.value)})})},$=async()=>{r.value=!0,await R.get("item/formAPI").then(v=>{r.value=!1,T.value=v.data.uoms,h.value=v.data.coas}).catch(()=>{r.value=!1})};return(v,a)=>(C(),w(ae,{ref_key:"dialogRef",ref:M,onHide:q(O),"transition-show":"slide-up","transition-hide":"slide-down","full-width":"",persistent:""},{default:l(()=>[e(ee,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:l(()=>[e(P,null,{default:l(()=>[ve]),_:1}),e(P,{class:"q-pa-sm"},{default:l(()=>[i("div",Ce,[i("div",De,[e(V,{label:"Item Code",dense:"",modelValue:s.value.MITM_ITMCD,"onUpdate:modelValue":a[0]||(a[0]=o=>s.value.MITM_ITMCD=o),filled:""},null,8,["modelValue"])]),i("div",Te,[e(V,{label:"Item Name",dense:"",modelValue:s.value.MITM_ITMNM,"onUpdate:modelValue":a[1]||(a[1]=o=>s.value.MITM_ITMNM=o),filled:""},null,8,["modelValue"])])]),i("div",pe,[i("div",Ve,[e(Q,{dense:"",filled:"",label:"UOM",modelValue:s.value.MITM_STKUOM,"onUpdate:modelValue":a[2]||(a[2]=o=>s.value.MITM_STKUOM=o),options:T.value,behavior:"dialog","option-label":"MUOM_UOMNM","option-value":"MUOM_UOMCD","emit-value":"","map-options":"",loading:r.value},null,8,["modelValue","options","loading"])]),i("div",Me,[e(V,{label:"Item Brand",dense:"",modelValue:s.value.MITM_BRAND,"onUpdate:modelValue":a[3]||(a[3]=o=>s.value.MITM_BRAND=o),filled:""},null,8,["modelValue"])])]),i("div",ge,[i("div",Ie,[e(V,{label:"Item Model",dense:"",modelValue:s.value.MITM_MODEL,"onUpdate:modelValue":a[4]||(a[4]=o=>s.value.MITM_MODEL=o),filled:""},null,8,["modelValue"])]),i("div",Re,[e(V,{label:"Item Specification",dense:"",modelValue:s.value.MITM_SPEC,"onUpdate:modelValue":a[5]||(a[5]=o=>s.value.MITM_SPEC=o),filled:""},null,8,["modelValue"])])]),i("div",be,[i("div",he,[e(Q,{dense:"",filled:"",label:"COA",modelValue:s.value.MITM_COACD,"onUpdate:modelValue":a[6]||(a[6]=o=>s.value.MITM_COACD=o),options:h.value,"use-input":"",behavior:"dialog","option-label":"MCOA_COANM","option-value":"MCOA_COACD",onFilter:a[7]||(a[7]=(o,n,t)=>c(o,n,t)),"emit-value":"","map-options":"",loading:r.value},null,8,["modelValue","options","loading"])])])]),_:1}),e(le,{align:"right"},{default:l(()=>[e(f,{label:"OK",color:"primary",onClick:a[8]||(a[8]=o=>N())}),e(f,{flat:"",label:"Cancel",color:"red",onClick:q(U)},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}},Oe=i("div",{class:"text-h6"},"Create Order",-1),ke={style:{border:"1px black solid","border-radius":"10px"}},ye=i("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[i("b",null,"Header")],-1),Ue={class:"row"},Ne={class:"col"},$e={class:"col q-pl-md"},Ae={class:"row items-center justify-end"},He={class:"row"},Qe={class:"col"},Ye={style:{border:"1px black solid","border-radius":"10px",height:"35vh",overflow:"auto"}},Le=i("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[i("b",null,"Detail Items")],-1),Pe={key:0,class:"row q-pb-sm"},qe={class:"col text-right"},z={__name:"serviceCreateOrder",props:{header:Array,detail:Array,mode:String},setup(Y){const{dialogRef:M,onDialogHide:O,onDialogOK:k,onDialogCancel:U}=oe(),b=G(),s=Y;x(async()=>{s.header&&(await $(),await v(),r.value=s.header,D.value=s.detail)});const r=_({SRVH_DOCNO:"",SRVH_ISSDT:L.formatDate(Date.now(),"YYYY-MM-DD"),SRVH_CUSCD:""}),T=_([]),h=_([]),D=_([]),c=_(!1),N=(m,d,u,g)=>{d(async()=>{g==="cust"&&await $(m),g==="item"&&await v(m)})},$=async m=>{c.value=!0,await R.post("customer/searchAPI",{searchValue:m}).then(d=>{c.value=!1,h.value=d.data.data}).catch(()=>{c.value=!1})},v=async m=>{c.value=!0,await R.post("item/searchAPI",{searchValue:m}).then(d=>{c.value=!1,T.value=d.data.data}).catch(()=>{c.value=!1})},a=()=>{D.value.push({TSRVD_ITMCD:"",TSRVD_LINE:D.value.length+1,TSRVD_QTY:1,TSRVD_CUSTRMK:""})},o=m=>{b.dialog({title:"Confirmation",message:`Do you want to delete this lines no ${m+1} ?`,cancel:!0,persistent:!0}).onOk(async()=>{D.value.splice(m,1)})},n=m=>{b.dialog({component:we,componentProps:{ItemCat:"SERVICE_ITEMM"}}).onOk(async d=>{await v(""),D.value[m].TSRVD_ITMCD=d.MITM_ITMNM})},t=()=>{b.dialog({title:"Confirmation",message:"Do you want to submit this data ?",cancel:!0,persistent:!0}).onOk(async()=>{c.value=!0,await R.post("servicesAdmin",{header:r.value,detail:D.value}).then(m=>{c.value=!1,k()})})};return(m,d)=>(C(),w(ae,{ref_key:"dialogRef",ref:M,onHide:q(O),"transition-show":"slide-up","transition-hide":"slide-down","full-width":"",persistent:""},{default:l(()=>[e(ee,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:l(()=>[e(P,null,{default:l(()=>[Oe]),_:1}),e(P,{class:"q-pa-sm"},{default:l(()=>[i("fieldset",ke,[ye,i("div",Ue,[i("div",Ne,[e(V,{label:"SPK No",readonly:"",dense:"",modelValue:r.value.SRVH_DOCNO,"onUpdate:modelValue":d[0]||(d[0]=u=>r.value.SRVH_DOCNO=u),filled:""},null,8,["modelValue"])]),i("div",$e,[e(V,{filled:"",modelValue:r.value.SRVH_ISSDT,"onUpdate:modelValue":d[2]||(d[2]=u=>r.value.SRVH_ISSDT=u),dense:"",label:"Issue Date",loading:c.value,onClick:d[3]||(d[3]=u=>m.quotationIssueDate.qDateProxy.show()),mask:"####-##-##","fill-mask":"",hint:"Mask: YYYY-MM-DD",readonly:s.mode==="view"},{append:l(()=>[e(te,{name:"event",class:"cursor-pointer",disable:s.mode==="view"},{default:l(()=>[e(_e,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(me,{modelValue:r.value.SRVH_ISSDT,"onUpdate:modelValue":d[1]||(d[1]=u=>r.value.SRVH_ISSDT=u),mask:"YYYY-MM-DD"},{default:l(()=>[i("div",Ae,[B(e(f,{label:"Close",color:"primary",flat:""},null,512),[[Se]])])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["disable"])]),_:1},8,["modelValue","loading","readonly"])])]),i("div",He,[i("div",Qe,[e(Q,{dense:"",filled:"",label:"Customer Choose",modelValue:r.value.SRVH_CUSCD,"onUpdate:modelValue":d[4]||(d[4]=u=>r.value.SRVH_CUSCD=u),"use-input":"","input-debounce":"500",options:h.value,onFilter:d[5]||(d[5]=(u,g,p)=>N(u,g,p,"cust")),behavior:"dialog","option-label":"MCUS_CUSNM","option-value":"MCUS_CUSCD","emit-value":"","map-options":"",loading:c.value,readonly:s.mode==="view"},null,8,["modelValue","options","loading","readonly"])])])]),i("fieldset",Ye,[Le,s.mode!=="view"?(C(),H("div",Pe,[i("div",qe,[e(f,{flat:"",icon:"add",color:"blue",onClick:d[6]||(d[6]=u=>a())},{default:l(()=>[e(I,null,{default:l(()=>[S("Add lines")]),_:1})]),_:1})])])):E("",!0),e(re,{bordered:"",dense:""},{default:l(()=>[D.value.length>0?(C(!0),H(F,{key:0},K(D.value,(u,g)=>(C(),w(j,{key:g,class:"q-my-sm",dense:""},{default:l(()=>[e(y,{avatar:""},{default:l(()=>[e(ie,{"text-color":"blue"},{default:l(()=>[S(A(g+1),1)]),_:2},1024)]),_:2},1024),e(y,null,{default:l(()=>[e(W,null,{default:l(()=>[e(Q,{dense:"",filled:"",label:"Item Name",modelValue:u.TSRVD_ITMCD,"onUpdate:modelValue":p=>u.TSRVD_ITMCD=p,"use-input":"","input-debounce":"500",options:T.value,onFilter:d[7]||(d[7]=(p,ne,se)=>N(p,ne,se,"item")),behavior:"dialog","option-label":"MITM_ITMNM","option-value":"MITM_ITMNM","emit-value":"","map-options":"",loading:c.value},null,8,["modelValue","onUpdate:modelValue","options","loading"])]),_:2},1024)]),_:2},1024),e(y,null,{default:l(()=>[e(V,{label:"Qty",filled:"",dense:"",modelValue:u.TSRVD_QTY,"onUpdate:modelValue":p=>u.TSRVD_QTY=p},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(y,null,{default:l(()=>[e(V,{label:"Problem",filled:"",dense:"",modelValue:u.TSRVD_CUSTRMK,"onUpdate:modelValue":p=>u.TSRVD_CUSTRMK=p},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),s.mode!=="view"?(C(),w(y,{key:0,side:""},{default:l(()=>[e(f,{icon:"delete",color:"red",flat:"",onClick:p=>o(g)},{default:l(()=>[e(I,null,{default:l(()=>[S("Delete line")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):E("",!0),s.mode!=="view"?(C(),w(y,{key:1,side:""},{default:l(()=>[e(f,{icon:"library_add",color:"indigo",flat:"",onClick:p=>n(g)},{default:l(()=>[e(I,null,{default:l(()=>[S("Add new item")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):E("",!0)]),_:2},1024))),128)):B((C(),w(j,{key:1,class:"q-my-sm",clickable:""},{default:l(()=>[e(y,null,{default:l(()=>[e(W,null,{default:l(()=>[S(" No Items Added ")]),_:1})]),_:1})]),_:1})),[[de]])]),_:1})])]),_:1}),e(le,{align:"right"},{default:l(()=>[e(f,{label:"OK",color:"primary",onClick:d[8]||(d[8]=u=>t()),disable:c.value,loading:c.value},null,8,["disable","loading"]),e(f,{flat:"",label:"Cancel",color:"red",onClick:q(U),loading:c.value},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}};const Ee={class:"q-pa-md"},Fe={class:"row q-pb-md"},Ke=i("div",{class:"col"},[i("span",{class:"text-h4"},"Receive Order ")],-1),xe={class:"col text-right"},Ge={class:"row q-pt-md"},Be={class:"col"},tl={__name:"serviceView",setup(Y){const M=G(),O=_("SRVH_DOCNO"),k=_(""),U=_([]),b=_([{name:"SRVH_DOCNO",label:"SPK No",field:"SRVH_DOCNO",sortable:!0,align:"left"},{name:"MCUS_CUSNM",label:"Cust",field:"MCUS_CUSNM",sortable:!0,align:"left"},{name:"MCUS_CUSNM",label:"Status",field:a=>a.detail.filter(o=>o.TSRVD_FLGSTS===0).length>0?"On Draft":a.detail.filter(o=>o.TSRVD_FLGSTS===1).length>0?"On Check Price":"On Working",sortable:!0,align:"left"},{name:"created_at",label:"Created Date",field:"created_at",sortable:!0,align:"left",format:a=>L.formatDate(new Date(a),"DD MMM YYYY")}]),s=_(!1),r=_(null);x(()=>{T(),r.value=setInterval(()=>{T()},1e4)});const T=async()=>{s.value=!0,await R.post("servicesAdmin/search",{searchBy:O.value,searchValue:k.value}).then(a=>{s.value=!1,U.value=a.data.data}).catch(a=>{s.value=!1})},h=()=>{M.dialog({component:z}).onOk(async a=>{T()})},D=a=>{const o={SRVH_DOCNO:a.SRVH_DOCNO,SRVH_ISSDT:L.formatDate(a.SRVH_ISSDT,"YYYY-MM-DD"),SRVH_CUSCD:a.MCUS_CUSCD};let n=[];a.detail.map(t=>{n.push({TSRVD_ITMCD:t.TSRVD_ITMCD,TSRVD_LINE:t.TSRVD_LINE,TSRVD_QTY:t.TSRVD_QTY,TSRVD_CUSTRMK:t.TSRVD_CUSTRMK,TSRVD_REMARK:t.TSRVD_REMARK,TSRVD_FLGSTS:t.TSRVD_FLGSTS,listFixDet:t.list_fix_det})}),M.dialog({component:fe,componentProps:{header:o,detail:n,mode:"view"}}).onOk(async t=>{T()})},c=a=>{window.open("https://joss.jatpowerindo.co.id/servicesAdmin/printInvoice/"+btoa(a),"_blank").focus()},N=a=>{const o={SRVH_DOCNO:a.SRVH_DOCNO,SRVH_ISSDT:L.formatDate(a.SRVH_ISSDT,"YYYY-MM-DD"),SRVH_CUSCD:a.MCUS_CUSCD};let n=[];a.detail.map(t=>{n.push({TSRVD_ITMCD:t.TSRVD_ITMCD,TSRVD_LINE:t.TSRVD_LINE,TSRVD_QTY:t.TSRVD_QTY,TSRVD_CUSTRMK:t.TSRVD_CUSTRMK})}),M.dialog({component:z,componentProps:{header:o,detail:n}}).onOk(async t=>{T()})},$=a=>{M.dialog({title:"Confirmation",message:"Do you want to proceed to service ?",cancel:!0,persistent:!0}).onOk(async()=>{s.value=!0,await R.put(`servicesAdmin/${btoa(a.SRVH_DOCNO)}`,{TSRVD_FLGSTS:2}).then(o=>{s.value=!1}).catch(o=>{s.value=!1})})},v=a=>{M.dialog({title:"Confirmation",message:"Are you sure want to delete this order ?",cancel:!0,persistent:!0}).onOk(async()=>{s.value=!0,await R.delete(`servicesAdmin/${btoa(a.SRVH_DOCNO)}`).then(o=>{s.value=!1}).catch(o=>{s.value=!1})})};return(a,o)=>(C(),H("div",Ee,[i("div",Fe,[Ke,i("div",xe,[e(f,{icon:"add",color:"blue",onClick:h},{default:l(()=>[e(I,null,{default:l(()=>[S("Create New Order")]),_:1})]),_:1})])]),e(ue),i("div",Ge,[i("div",Be,[e(ce,{title:"Created Order",rows:U.value,columns:b.value,"row-key":"name",loading:s.value,dense:"",pagination:{rowsPerPage:20},class:"my-sticky-header-column-table"},{"top-right":l(()=>[e(Q,{outlined:"",modelValue:O.value,"onUpdate:modelValue":o[0]||(o[0]=n=>O.value=n),options:b.value,label:"Search Columns","option-value":"name","option-label":"label","emit-value":"",dense:"","map-options":""},null,8,["modelValue","options"]),e(V,{borderless:"",dense:"",modelValue:k.value,"onUpdate:modelValue":[o[1]||(o[1]=n=>k.value=n),o[2]||(o[2]=n=>a.dataQuo())],placeholder:"Search",outlined:"",debounce:"1000"},{append:l(()=>[e(te,{name:"search"})]),_:1},8,["modelValue"])]),header:l(n=>[e(X,{props:n},{default:l(()=>[(C(!0),H(F,null,K(n.cols,t=>(C(),w(J,{key:t.name,props:n},{default:l(()=>[S(A(t.label),1)]),_:2},1032,["props"]))),128)),e(J,{"auto-width":""},{default:l(()=>[S("Action")]),_:1})]),_:2},1032,["props"])]),body:l(n=>[e(X,{props:n},{default:l(()=>[(C(!0),H(F,null,K(n.cols,t=>(C(),w(Z,{key:t.name,props:n},{default:l(()=>[S(A(t.value),1)]),_:2},1032,["props"]))),128)),e(Z,{"auto-width":""},{default:l(()=>[e(f,{flat:"",color:"orange",icon:"edit",onClick:t=>N(n.row),dense:"",disable:n.row.detail.filter(t=>t.TSRVD_FLGSTS>0).length>0},{default:l(()=>[e(I,null,{default:l(()=>[S("Edit this Order")]),_:1})]),_:2},1032,["onClick","disable"]),e(f,{flat:"",color:"indigo",icon:"print",onClick:t=>c(n.row.SRVH_DOCNO),dense:"",disable:n.row.detail.filter(t=>t.TSRVD_FLGSTS>0).length!==n.row.detail.length},{default:l(()=>[e(I,null,{default:l(()=>[S("Print this order")]),_:1})]),_:2},1032,["onClick","disable"]),e(f,{flat:"",color:"red",icon:"delete",onClick:t=>v(n.row.SRVH_DOCNO),dense:"",disable:n.row.detail.filter(t=>t.TSRVD_FLGSTS>0).length>0},{default:l(()=>[e(I,null,{default:l(()=>[S(A(n.row.detail.filter(t=>t.TSRVD_FLGSTS>0).length>0?"Cannot delete processed order":"Delete this Order"),1)]),_:2},1024)]),_:2},1032,["onClick","disable"]),e(f,{flat:"",color:"cyan",icon:"visibility",onClick:t=>D(n.row),dense:"",disable:n.row.detail.filter(t=>t.TSRVD_FLGSTS>0).length===0},{default:l(()=>[e(I,null,{default:l(()=>[S("View this Order")]),_:1})]),_:2},1032,["onClick","disable"]),e(f,{flat:"",color:"indigo",icon:"check",onClick:t=>$(n.row.SRVH_DOCNO),dense:"",disable:n.row.detail.filter(t=>t.TSRVD_FLGSTS===1).length===0||n.row.detail.filter(t=>t.TSRVD_FLGSTS>=2).length>0},{default:l(()=>[e(I,null,{default:l(()=>[S(A(n.row.detail.filter(t=>t.TSRVD_FLGSTS>0).length!==n.row.detail.length?"Please wait until all item checked":"Proceed to service"),1)]),_:2},1024)]),_:2},1032,["onClick","disable"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])])])]))}};export{tl as default};
