import{s as v,o as H,B as u,C as f,D as e,E as a,L as I,M as S,T as N,H as n,V as U,P,R as A,S as q,bc as $,U as B,O as _,I as s,Q as g,W as F,X as Q,Y as K,Z as G,am as j,aX as E}from"./index.ec303870.js";import{a as L,u as Y,Q as X,b as x,c,d as i,k as z}from"./QTable.0dd3edb8.js";import{api_web as V}from"./axios.0ac4f544.js";import{Q as W}from"./QTooltip.274ca433.js";import{_ as Z}from"./serviceOprItemAdd.7957ac77.js";const J=s("div",{class:"text-h6"},"View List Price",-1),ee=["innerHTML"],ae=["innerHTML"],le={__name:"serviceApprovalDetView",props:{idHeader:String},setup(T){const R=L(),{dialogRef:w,onDialogHide:h,onDialogOK:p,onDialogCancel:D}=Y(),m=T,b=v([]),l=v(!1);H(()=>{C()});const C=async()=>{l.value=!0,await V.get(`servicesAdmins/viewUnapproveMgrDet/${btoa(m.idHeader.SRVH_DOCNO)}`).then(o=>{l.value=!1,b.value=o.data}).catch(o=>{l.value=!1})},r=o=>{let d=0;return o.map(t=>{d+=t.TSRVF_QTY*t.TSRVF_PRC}),d},k=o=>{o.listFixDet=o.list_fix_det,R.dialog({component:Z,componentProps:{mode:"view",dataItem:o}}).onOk(async d=>{})},y=(o=!1)=>{R.dialog({title:`${o?"Approval Message Confirmation":"Rejection Message Confirmation"}`,message:`Please add message before ${o?"approve":"reject"} this service.`,cancel:!0,persistent:!0,prompt:{model:"",type:"text"}}).onOk(async d=>{l.value=!0,await V.put(`servicesAdmins/updateDetByIDHead/${btoa(m.idHeader.id)}`,{TSRVD_FLGSTS:o?1:0,TSRVD_MGRRMK:d}).then(t=>{l.value=!1,p()}).catch(t=>{l.value=!1})})};return(o,d)=>(u(),f(K,{ref_key:"dialogRef",ref:w,onHide:Q(h),"transition-show":"slide-up","transition-hide":"slide-down","full-width":""},{default:e(()=>[a(I,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:e(()=>[a(S,null,{default:e(()=>[J]),_:1}),a(S,{class:"q-pa-sm"},{default:e(()=>[a(X,{bordered:"",loading:l.value},{default:e(()=>[b.value.length===0?N((u(),f(x,{key:0,class:"q-my-sm",clickable:""},{default:e(()=>[l.value?(u(),f(c,{key:1},{default:e(()=>[n("Please wait, loading data... ")]),_:1})):(u(),f(c,{key:0},{default:e(()=>[n(" No items added ")]),_:1}))]),_:1})),[[U]]):(u(!0),P(A,{key:1},q(b.value,(t,M)=>(u(),f(x,{key:M,class:$("q-my-sm")},{default:e(()=>[a(c,{avatar:""},{default:e(()=>[a(B,{color:t.TSRVD_FLGSTS===0?"red":"primary","text-color":"white"},{default:e(()=>[n(_(M+1),1)]),_:2},1032,["color"])]),_:2},1024),a(c,null,{default:e(()=>[a(i,null,{default:e(()=>[n(_(t.TSRVD_ITMCD),1)]),_:2},1024),a(i,{caption:""},{default:e(()=>[n(" Item ")]),_:1})]),_:2},1024),a(c,null,{default:e(()=>[a(i,null,{default:e(()=>[n(_(t.TSRVD_QTY),1)]),_:2},1024),a(i,{caption:""},{default:e(()=>[n(" Qty ")]),_:1})]),_:2},1024),a(c,null,{default:e(()=>[a(i,null,{default:e(()=>[s("div",{innerHTML:t.TSRVD_REMARK},null,8,ee)]),_:2},1024),a(i,{caption:""},{default:e(()=>[n(" Tech. Remarks")]),_:1})]),_:2},1024),a(c,null,{default:e(()=>[t.TSRVD_MGRRMK?(u(),f(i,{key:0},{default:e(()=>[s("div",{innerHTML:t.TSRVD_MGRRMK},null,8,ae)]),_:2},1024)):(u(),f(i,{key:1},{default:e(()=>[a(g,{icon:"edit",flat:"",color:"primary",onClick:O=>k(t),label:"Update Remarks"},null,8,["onClick"])]),_:2},1024)),a(i,{caption:""},{default:e(()=>[n(" Mgr. Remarks")]),_:1})]),_:2},1024),a(c,null,{default:e(()=>[a(i,null,{default:e(()=>[n("Rp. "+_(r(t.list_fix_det).toLocaleString()),1)]),_:2},1024),a(i,{caption:""},{default:e(()=>[n(" Total Fix Price ")]),_:1})]),_:2},1024),a(c,{side:""},{default:e(()=>[a(g,{icon:"visibility",flat:"",color:"primary",onClick:O=>k(t)},{default:e(()=>[a(W,null,{default:e(()=>[n("View list fix items")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["loading"])]),_:1}),a(F,{align:"right"},{default:e(()=>[a(g,{label:"Approve",color:"primary",onClick:d[0]||(d[0]=t=>y(!0)),disable:l.value,loading:l.value},null,8,["disable","loading"]),a(g,{label:"Reject",color:"red",onClick:d[1]||(d[1]=t=>y()),loading:l.value},null,8,["loading"]),a(g,{label:"Cancel",color:"red",onClick:Q(D),disable:l.value,loading:l.value,flat:""},null,8,["onClick","disable","loading"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}},te={class:"q-pa-md"},oe={class:"row"},se={class:"col"},ne={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},ie={class:"text-h5 text-bold"},re={class:"text-h6 text-bold"},de={class:"text-subtitle2"},ce={class:"text-h6 text-bold"},ue=s("div",{class:"text-subtitle2"},"Resolved Items",-1),_e={class:"row"},fe={class:"col"},he={__name:"serviceApproval",setup(T){const R=L();v([{name:"SRVH_DOCNO",label:"SPK No",field:"SRVH_DOCNO",sortable:!0,align:"left"},{name:"MCUS_CUSNM",label:"Customer Name",field:"MCUS_CUSNM",sortable:!0,align:"left"},{name:"resolve",label:"Resolved Line",sortable:!0,align:"left",field:l=>l.resolve.length},{name:"unresolve",label:"Unresolved Line",sortable:!0,align:"left",field:l=>l.unresolve.length},{name:"SRVH_ISSDT",label:"Submited Date",field:"SRVH_ISSDT",sortable:!0,align:"left"}]);const w=v([]),h=v(""),p=v(!1),D=v(null);H(()=>{m(),D.value=setInterval(()=>{m()},1e4)});const m=async()=>{p.value=!0,await V.get("servicesAdmins/listUnapproveMgr").then(l=>{p.value=!1,w.value=l.data}).catch(l=>{p.value=!1})},b=l=>{R.dialog({component:le,componentProps:{idHeader:l}}).onOk(async C=>{m()})};return(l,C)=>(u(),P("div",te,[s("div",oe,[s("div",se,[a(z,{grid:"",flat:"",bordered:"","card-container-class":l.cardContainerClass,title:"Approve Service Pricing",rows:w.value,columns:l.columns,"row-key":"name",filter:h.value,"hide-header":"",pagination:{rowsPerPage:50},"rows-per-page-options":l.rowsPerPageOptions,loading:p.value},{"top-right":e(()=>[a(G,{borderless:"",dense:"",debounce:"300",modelValue:h.value,"onUpdate:modelValue":C[0]||(C[0]=r=>h.value=r),placeholder:"Search"},{append:e(()=>[a(j,{name:"search"})]),_:1},8,["modelValue"])]),item:e(r=>[s("div",ne,[a(I,{flat:"",bordered:""},{default:e(()=>[a(S,{class:$("text-center bg-green text-white")},{default:e(()=>[s("div",ie,_(r.row.SRVH_DOCNO),1)]),_:2},1024),a(E),a(S,null,{default:e(()=>[s("div",re,_(r.row.MCUS_CUSNM),1),s("div",de,_(r.row.SRVH_ISSDT),1)]),_:2},1024),a(S,null,{default:e(()=>[s("div",ce,_(r.row.resolve.length)+" of "+_(r.row.detail.length),1),ue]),_:2},1024),a(S,null,{default:e(()=>[s("div",_e,[s("div",fe,[a(g,{color:"primary",label:"View Data",onClick:k=>b(r.row)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024)])]),_:1},8,["card-container-class","rows","columns","filter","rows-per-page-options","loading"])])])]))}};export{he as default};
