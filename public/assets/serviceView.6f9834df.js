import{Q as h}from"./QTooltip.29434a9d.js";import{s as f,o as x,B as m,C as b,D as a,E as l,J as ee,K as P,I as i,P as V,L as le,Q as v,M as q,O as ae,aa as te,aW as B,R as H,H as S,aY as E,aU as F,aV as K,aZ as se,aX as A,ap as de,S as ue}from"./index.8861766e.js";import{u as oe,b as G,d as Q,Q as re,k as j,l as y,m as W,a as ce,n as Z,x as _e}from"./use-dialog-plugin-component.3217057c.js";import{Q as J,a as X}from"./use-cache.9060c599.js";import{d as L}from"./date.40b8ed37.js";import{api_web as I}from"./axios.1303807f.js";import{Q as me,a as fe,C as Se}from"./ClosePopup.5202e7c8.js";import{_ as ve}from"./serviceOprUpdateOrder.1cb30f6a.js";import"./QBadge.6e717037.js";const Ce=i("div",{class:"text-h6"},"Create Item Master",-1),De={class:"row"},Te={class:"col"},pe={class:"col q-pl-md"},Ve={class:"row q-pt-md"},Me={class:"col"},ge={class:"col q-pl-md"},he={class:"row q-pt-md"},be={class:"col"},Ie={class:"col q-pl-md"},Re={class:"row q-pt-md"},we={class:"col"},Oe={__name:"itemCreate",props:{ItemCat:String},setup(Y){const{dialogRef:M,onDialogHide:O,onDialogOK:k,onDialogCancel:U}=oe(),R=G(),n=f({MITM_ITMCD:"",MITM_ITMNM:"",MITM_STKUOM:"",MITM_ITMTYPE:1,MITM_BRAND:"",MITM_MODEL:"",MITM_SPEC:"",MITM_ITMCAT:"",MITM_COACD:"",MITM_ITMCAT:""}),c=f(!1),T=f([]),w=f([]),D=Y;x(()=>{$(),n.value.MITM_ITMCAT=D.ItemCat});const _=(C,d,t,u)=>{d(async()=>{await I.post("item/getListCoasAPI",{search:C}).then(o=>{w.value=o.data})})},N=()=>{R.dialog({title:"Confirmation",message:"Do you want to save this item ?",cancel:!0,persistent:!0}).onOk(async()=>{await I.post("item",n.value).then(C=>{k(C.data.data.value)})})},$=async()=>{c.value=!0,await I.get("item/formAPI").then(C=>{c.value=!1,T.value=C.data.uoms,w.value=C.data.coas}).catch(()=>{c.value=!1})};return(C,d)=>(m(),b(ae,{ref_key:"dialogRef",ref:M,onHide:q(O),"transition-show":"slide-up","transition-hide":"slide-down","full-width":"",persistent:""},{default:a(()=>[l(ee,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:a(()=>[l(P,null,{default:a(()=>[Ce]),_:1}),l(P,{class:"q-pa-sm"},{default:a(()=>[i("div",De,[i("div",Te,[l(V,{label:"Item Code",dense:"",modelValue:n.value.MITM_ITMCD,"onUpdate:modelValue":d[0]||(d[0]=t=>n.value.MITM_ITMCD=t),filled:""},null,8,["modelValue"])]),i("div",pe,[l(V,{label:"Item Name",dense:"",modelValue:n.value.MITM_ITMNM,"onUpdate:modelValue":d[1]||(d[1]=t=>n.value.MITM_ITMNM=t),filled:""},null,8,["modelValue"])])]),i("div",Ve,[i("div",Me,[l(Q,{dense:"",filled:"",label:"UOM",modelValue:n.value.MITM_STKUOM,"onUpdate:modelValue":d[2]||(d[2]=t=>n.value.MITM_STKUOM=t),options:T.value,behavior:"dialog","option-label":"MUOM_UOMNM","option-value":"MUOM_UOMCD","emit-value":"","map-options":"",loading:c.value},null,8,["modelValue","options","loading"])]),i("div",ge,[l(V,{label:"Item Brand",dense:"",modelValue:n.value.MITM_BRAND,"onUpdate:modelValue":d[3]||(d[3]=t=>n.value.MITM_BRAND=t),filled:""},null,8,["modelValue"])])]),i("div",he,[i("div",be,[l(V,{label:"Item Model",dense:"",modelValue:n.value.MITM_MODEL,"onUpdate:modelValue":d[4]||(d[4]=t=>n.value.MITM_MODEL=t),filled:""},null,8,["modelValue"])]),i("div",Ie,[l(V,{label:"Item Specification",dense:"",modelValue:n.value.MITM_SPEC,"onUpdate:modelValue":d[5]||(d[5]=t=>n.value.MITM_SPEC=t),filled:""},null,8,["modelValue"])])]),i("div",Re,[i("div",we,[l(Q,{dense:"",filled:"",label:"COA",modelValue:n.value.MITM_COACD,"onUpdate:modelValue":d[6]||(d[6]=t=>n.value.MITM_COACD=t),options:w.value,"use-input":"",behavior:"dialog","option-label":"MCOA_COANM","option-value":"MCOA_COACD",onFilter:d[7]||(d[7]=(t,u,o)=>_(t,u,o)),"emit-value":"","map-options":"",loading:c.value},null,8,["modelValue","options","loading"])])])]),_:1}),l(le,{align:"right"},{default:a(()=>[l(v,{label:"OK",color:"primary",onClick:d[8]||(d[8]=t=>N())}),l(v,{flat:"",label:"Cancel",color:"red",onClick:q(U)},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}},ke=i("div",{class:"text-h6"},"Create Order",-1),ye={style:{border:"1px black solid","border-radius":"10px"}},Ue=i("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[i("b",null,"Header")],-1),Ne={class:"row"},$e={class:"col"},Ae={class:"col q-pl-md"},He={class:"row items-center justify-end"},Qe={class:"row"},Ye={class:"col"},Le={style:{border:"1px black solid","border-radius":"10px",height:"35vh",overflow:"auto"}},Pe=i("legend",{style:{"margin-left":"1em",padding:"0.2em 0.8em"}},[i("b",null,"Detail Items")],-1),qe={key:0,class:"row q-pb-sm"},Ee={class:"col text-right"},z={__name:"serviceCreateOrder",props:{header:Array,detail:Array,mode:String},setup(Y){const{dialogRef:M,onDialogHide:O,onDialogOK:k,onDialogCancel:U}=oe(),R=G(),n=Y;x(async()=>{n.header&&(await $(),await C(),c.value=n.header,D.value=n.detail)});const c=f({SRVH_DOCNO:"",SRVH_ISSDT:L.formatDate(Date.now(),"YYYY-MM-DD"),SRVH_CUSCD:""}),T=f([]),w=f([]),D=f([]),_=f(!1),N=(e,s,r,g)=>{s(async()=>{g==="cust"&&await $(e),g==="item"&&await C(e)})},$=async e=>{_.value=!0,await I.post("customer/searchAPI",{searchValue:e}).then(s=>{_.value=!1,w.value=s.data.data}).catch(()=>{_.value=!1})},C=async e=>{_.value=!0,await I.post("item/searchAPI",{searchValue:e}).then(s=>{_.value=!1,T.value=s.data.data}).catch(()=>{_.value=!1})},d=()=>{D.value.push({TSRVD_ITMCD:"",TSRVD_LINE:D.value.length+1,TSRVD_QTY:1,TSRVD_CUSTRMK:""})},t=e=>{R.dialog({title:"Confirmation",message:`Do you want to delete this lines no ${e+1} ?`,cancel:!0,persistent:!0}).onOk(async()=>{D.value.splice(e,1)})},u=e=>{R.dialog({component:Oe,componentProps:{ItemCat:"SERVICE_ITEMM"}}).onOk(async s=>{await C(""),D.value[e].TSRVD_ITMCD=s.MITM_ITMNM})},o=()=>{R.dialog({title:"Confirmation",message:"Do you want to submit this data ?",cancel:!0,persistent:!0}).onOk(async()=>{_.value=!0,await I.post("servicesAdmin",{header:c.value,detail:D.value}).then(e=>{_.value=!1,k()})})};return(e,s)=>(m(),b(ae,{ref_key:"dialogRef",ref:M,onHide:q(O),"transition-show":"slide-up","transition-hide":"slide-down","full-width":"",persistent:""},{default:a(()=>[l(ee,{class:"q-dialog-plugin bg-white q-pa-sm"},{default:a(()=>[l(P,null,{default:a(()=>[ke]),_:1}),l(P,{class:"q-pa-sm"},{default:a(()=>[i("fieldset",ye,[Ue,i("div",Ne,[i("div",$e,[l(V,{label:"SPK No",readonly:"",dense:"",modelValue:c.value.SRVH_DOCNO,"onUpdate:modelValue":s[0]||(s[0]=r=>c.value.SRVH_DOCNO=r),filled:""},null,8,["modelValue"])]),i("div",Ae,[l(V,{filled:"",modelValue:c.value.SRVH_ISSDT,"onUpdate:modelValue":s[2]||(s[2]=r=>c.value.SRVH_ISSDT=r),dense:"",label:"Issue Date",loading:_.value,onClick:s[3]||(s[3]=r=>e.quotationIssueDate.qDateProxy.show()),mask:"####-##-##","fill-mask":"",hint:"Mask: YYYY-MM-DD",readonly:n.mode==="view"},{append:a(()=>[l(te,{name:"event",class:"cursor-pointer",disable:n.mode==="view"},{default:a(()=>[l(me,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[l(fe,{modelValue:c.value.SRVH_ISSDT,"onUpdate:modelValue":s[1]||(s[1]=r=>c.value.SRVH_ISSDT=r),mask:"YYYY-MM-DD"},{default:a(()=>[i("div",He,[B(l(v,{label:"Close",color:"primary",flat:""},null,512),[[Se]])])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["disable"])]),_:1},8,["modelValue","loading","readonly"])])]),i("div",Qe,[i("div",Ye,[l(Q,{dense:"",filled:"",label:"Customer Choose",modelValue:c.value.SRVH_CUSCD,"onUpdate:modelValue":s[4]||(s[4]=r=>c.value.SRVH_CUSCD=r),"use-input":"","input-debounce":"500",options:w.value,onFilter:s[5]||(s[5]=(r,g,p)=>N(r,g,p,"cust")),behavior:"dialog","option-label":"MCUS_CUSNM","option-value":"MCUS_CUSCD","emit-value":"","map-options":"",loading:_.value,readonly:n.mode==="view"},null,8,["modelValue","options","loading","readonly"])])])]),i("fieldset",Le,[Pe,n.mode!=="view"?(m(),H("div",qe,[i("div",Ee,[l(v,{flat:"",icon:"add",color:"blue",onClick:s[6]||(s[6]=r=>d())},{default:a(()=>[l(h,null,{default:a(()=>[S("Add lines")]),_:1})]),_:1})])])):E("",!0),l(re,{bordered:"",dense:""},{default:a(()=>[D.value.length>0?(m(!0),H(F,{key:0},K(D.value,(r,g)=>(m(),b(j,{key:g,class:"q-my-sm",dense:""},{default:a(()=>[l(y,{avatar:""},{default:a(()=>[l(se,{"text-color":"blue"},{default:a(()=>[S(A(g+1),1)]),_:2},1024)]),_:2},1024),l(y,null,{default:a(()=>[l(W,null,{default:a(()=>[l(Q,{dense:"",filled:"",label:"Item Name",modelValue:r.TSRVD_ITMCD,"onUpdate:modelValue":p=>r.TSRVD_ITMCD=p,"use-input":"","input-debounce":"500",options:T.value,onFilter:s[7]||(s[7]=(p,ne,ie)=>N(p,ne,ie,"item")),behavior:"dialog","option-label":"MITM_ITMNM","option-value":"MITM_ITMNM","emit-value":"","map-options":"",loading:_.value},null,8,["modelValue","onUpdate:modelValue","options","loading"])]),_:2},1024)]),_:2},1024),l(y,null,{default:a(()=>[l(V,{label:"Qty",filled:"",dense:"",modelValue:r.TSRVD_QTY,"onUpdate:modelValue":p=>r.TSRVD_QTY=p},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(y,null,{default:a(()=>[l(V,{label:"Problem",filled:"",dense:"",modelValue:r.TSRVD_CUSTRMK,"onUpdate:modelValue":p=>r.TSRVD_CUSTRMK=p},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n.mode!=="view"?(m(),b(y,{key:0,side:""},{default:a(()=>[l(v,{icon:"delete",color:"red",flat:"",onClick:p=>t(g)},{default:a(()=>[l(h,null,{default:a(()=>[S("Delete line")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):E("",!0),n.mode!=="view"?(m(),b(y,{key:1,side:""},{default:a(()=>[l(v,{icon:"library_add",color:"indigo",flat:"",onClick:p=>u(g)},{default:a(()=>[l(h,null,{default:a(()=>[S("Add new item")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):E("",!0)]),_:2},1024))),128)):B((m(),b(j,{key:1,class:"q-my-sm",clickable:""},{default:a(()=>[l(y,null,{default:a(()=>[l(W,null,{default:a(()=>[S(" No Items Added ")]),_:1})]),_:1})]),_:1})),[[de]])]),_:1})])]),_:1}),l(le,{align:"right"},{default:a(()=>[l(v,{label:"OK",color:"primary",onClick:s[8]||(s[8]=r=>o()),disable:_.value,loading:_.value},null,8,["disable","loading"]),l(v,{flat:"",label:"Cancel",color:"red",onClick:q(U),loading:_.value},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}};const Fe={class:"q-pa-md"},Ke={class:"row q-pb-md"},xe=i("div",{class:"col"},[i("span",{class:"text-h4"},"Receive Order ")],-1),Ge={class:"col text-right"},Be={class:"row q-pt-md"},je={class:"col"},We={key:1},nl={__name:"serviceView",setup(Y){const M=G(),O=f("SRVH_DOCNO"),k=f(""),U=f([]),R=f([{name:"SRVH_DOCNO",label:"SPK No",field:"SRVH_DOCNO",sortable:!0,align:"left"},{name:"MCUS_CUSNM",label:"Cust",field:"MCUS_CUSNM",sortable:!0,align:"left"},{name:"STAT",label:"Status",field:t=>d(t),sortable:!0,align:"left"},{name:"created_at",label:"Created Date",field:"created_at",sortable:!0,align:"left",format:t=>L.formatDate(new Date(t),"DD MMM YYYY")}]),n=f(!1),c=f(null);x(()=>{T(),c.value=setInterval(()=>{T()},1e4)});const T=async()=>{n.value=!0,await I.post("servicesAdmin/search",{searchBy:O.value,searchValue:k.value}).then(t=>{n.value=!1,U.value=t.data.data}).catch(t=>{n.value=!1})},w=()=>{M.dialog({component:z}).onOk(async t=>{T()})},D=t=>{const u={SRVH_DOCNO:t.SRVH_DOCNO,SRVH_ISSDT:L.formatDate(t.SRVH_ISSDT,"YYYY-MM-DD"),SRVH_CUSCD:t.MCUS_CUSCD};let o=[];t.detail.map(e=>{o.push({TSRVD_ITMCD:e.TSRVD_ITMCD,TSRVD_LINE:e.TSRVD_LINE,TSRVD_QTY:e.TSRVD_QTY,TSRVD_CUSTRMK:e.TSRVD_CUSTRMK,TSRVD_REMARK:e.TSRVD_REMARK,TSRVD_FLGSTS:e.TSRVD_FLGSTS,listFixDet:e.list_fix_det})}),M.dialog({component:ve,componentProps:{header:u,detail:o,mode:"view"}}).onOk(async e=>{T()})},_=t=>{window.open("https://joss.jatpowerindo.co.id/servicesAdmin/printInvoice/"+btoa(t),"_blank").focus()},N=t=>{const u={SRVH_DOCNO:t.SRVH_DOCNO,SRVH_ISSDT:L.formatDate(t.SRVH_ISSDT,"YYYY-MM-DD"),SRVH_CUSCD:t.MCUS_CUSCD};let o=[];t.detail.map(e=>{o.push({TSRVD_ITMCD:e.TSRVD_ITMCD,TSRVD_LINE:e.TSRVD_LINE,TSRVD_QTY:e.TSRVD_QTY,TSRVD_CUSTRMK:e.TSRVD_CUSTRMK})}),M.dialog({component:z,componentProps:{header:u,detail:o}}).onOk(async e=>{T()})},$=t=>{M.dialog({title:"Confirmation",message:"Do you want to proceed to service ?",cancel:!0,persistent:!0}).onOk(async()=>{n.value=!0,await I.put(`servicesAdmin/${btoa(t.SRVH_DOCNO)}`,{TSRVD_FLGSTS:2}).then(u=>{n.value=!1}).catch(u=>{n.value=!1})})},C=t=>{M.dialog({title:"Confirmation",message:"Are you sure want to delete this order ?",cancel:!0,persistent:!0}).onOk(async()=>{n.value=!0,await I.delete(`servicesAdmin/${btoa(t.SRVH_DOCNO)}`).then(u=>{n.value=!1}).catch(u=>{n.value=!1})})},d=t=>{const u=t.detail.filter(e=>e.TSRVD_FLGSTS===0),o=t.detail.filter(e=>e.TSRVD_FLGSTS===1);if(t.detail.filter(e=>e.TSRVD_FLGSTS===2),u.length==t.detail.length)return{color:"warning",label:"On Draft",icon:"edit"};if(o.length>0&&o.length<t.detail.length)return{color:"green",label:"On Checking Price",icon:"payments"};if(o.length>0&&o.length==t.detail.length)return{color:"primary",label:"Checking Price Done, Waiting Cust Confirmation",icon:"price_check"}};return(t,u)=>(m(),H("div",Fe,[i("div",Ke,[xe,i("div",Ge,[l(v,{icon:"add",color:"blue",onClick:w},{default:a(()=>[l(h,null,{default:a(()=>[S("Create New Order")]),_:1})]),_:1})])]),l(ue),i("div",Be,[i("div",je,[l(ce,{title:"Created Order",rows:U.value,columns:R.value,"row-key":"name",loading:n.value,dense:"",pagination:{rowsPerPage:20},class:"my-sticky-header-column-table"},{"top-right":a(()=>[l(Q,{outlined:"",modelValue:O.value,"onUpdate:modelValue":u[0]||(u[0]=o=>O.value=o),options:R.value,label:"Search Columns","option-value":"name","option-label":"label","emit-value":"",dense:"","map-options":""},null,8,["modelValue","options"]),l(V,{borderless:"",dense:"",modelValue:k.value,"onUpdate:modelValue":[u[1]||(u[1]=o=>k.value=o),u[2]||(u[2]=o=>t.dataQuo())],placeholder:"Search",outlined:"",debounce:"1000"},{append:a(()=>[l(te,{name:"search"})]),_:1},8,["modelValue"])]),header:a(o=>[l(J,{props:o},{default:a(()=>[(m(!0),H(F,null,K(o.cols,e=>(m(),b(Z,{key:e.name,props:o},{default:a(()=>[S(A(e.label),1)]),_:2},1032,["props"]))),128)),l(Z,{"auto-width":""},{default:a(()=>[S("Action")]),_:1})]),_:2},1032,["props"])]),body:a(o=>[l(J,{props:o},{default:a(()=>[(m(!0),H(F,null,K(o.cols,e=>(m(),b(X,{key:e.name,props:o},{default:a(()=>[e.name==="STAT"?(m(),b(_e,{key:0,clickable:"",color:e.value.color,"text-color":"white",icon:e.value.icon},{default:a(()=>[S(A(e.value.label),1)]),_:2},1032,["color","icon"])):(m(),H("span",We,A(e.value),1))]),_:2},1032,["props"]))),128)),l(X,{"auto-width":""},{default:a(()=>[l(v,{flat:"",color:"orange",icon:"edit",onClick:e=>N(o.row),dense:"",disable:o.row.detail.filter(e=>e.TSRVD_FLGSTS>0).length>0},{default:a(()=>[l(h,null,{default:a(()=>[S("Edit this Order")]),_:1})]),_:2},1032,["onClick","disable"]),l(v,{flat:"",color:"indigo",icon:"print",onClick:e=>_(o.row.SRVH_DOCNO),dense:"",disable:o.row.detail.filter(e=>e.TSRVD_FLGSTS>0).length!==o.row.detail.length},{default:a(()=>[l(h,null,{default:a(()=>[S("Print this order")]),_:1})]),_:2},1032,["onClick","disable"]),l(v,{flat:"",color:"red",icon:"delete",onClick:e=>C(o.row.SRVH_DOCNO),dense:"",disable:o.row.detail.filter(e=>e.TSRVD_FLGSTS>0).length>0},{default:a(()=>[l(h,null,{default:a(()=>[S(A(o.row.detail.filter(e=>e.TSRVD_FLGSTS>0).length>0?"Cannot delete processed order":"Delete this Order"),1)]),_:2},1024)]),_:2},1032,["onClick","disable"]),l(v,{flat:"",color:"cyan",icon:"visibility",onClick:e=>D(o.row),dense:"",disable:o.row.detail.filter(e=>e.TSRVD_FLGSTS>0).length===0},{default:a(()=>[l(h,null,{default:a(()=>[S("View this Order")]),_:1})]),_:2},1032,["onClick","disable"]),l(v,{flat:"",color:"indigo",icon:"check",onClick:e=>$(o.row.SRVH_DOCNO),dense:"",disable:o.row.detail.filter(e=>e.TSRVD_FLGSTS===1).length===0||o.row.detail.filter(e=>e.TSRVD_FLGSTS>=2).length>0},{default:a(()=>[l(h,null,{default:a(()=>[S(A(o.row.detail.filter(e=>e.TSRVD_FLGSTS>0).length!==o.row.detail.length?"Please wait until all item checked":"Proceed to service"),1)]),_:2},1024)]),_:2},1032,["onClick","disable"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])])])]))}};export{nl as default};
